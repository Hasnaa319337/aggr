var Ie=Object.defineProperty;var ye=(o,e,t)=>e in o?Ie(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var h=(o,e,t)=>(ye(o,typeof e!="symbol"?e+"":e,t),t);import{G as be,H as _e,I as d,J as Ce,K as b,p as ee,M as fe,N as re,O as _,l as H,r as z,u as M,Q as ae,_ as x,R as q,U as V,x as ne,d as C,X as te,Y as Se,Z as Ee,j as T,$ as Re,a0 as ke,v as oe,a1 as K,a2 as Te,a3 as Oe,a4 as we,a5 as w,a6 as Pe,a7 as Me,a8 as ce,a9 as xe,w as Ae,C as L,t as Le,V as A,aa as $e,n as $,ab as De,B as He}from"./index.5c4cb14.js";import{f as ze,h as ge,i as Fe,j as he,k as j,l as le,m as de,Z as pe,n as Be,o as Ge,q as Ne,r as W,s as D}from"./options.5c4cb14.js";import{P as je,a as We}from"./PaneHeader.5c4cb14.js";import{A as qe}from"./AlertsList.5c4cb14.js";class Ve extends be{constructor(){super();h(this,"url");h(this,"promisesOfData",{});this.url=_e("historical")}filterOutUnavailableMarkets(t){return t.filter(i=>d.state.app.historicalMarkets.indexOf(i)!==-1)}getApiUrl(t,i,s,r){const a=[t,i,(s*1e3).toString()];return r&&r.length&&a.push(encodeURIComponent(r.join("+"))),`${this.url}/${a.join("/")}`}fetch(t,i,s,r){const a=this.getApiUrl(t,i,s,r);return this.promisesOfData[a]?this.promisesOfData[a]:(this.promisesOfData[a]=fetch(a).then(async n=>{const l=n.headers.get("content-type");let u;if(l&&l.indexOf("application/json")!==-1)u=await n.json();else throw new Error(await n.text());return u.status=n.status,u}).then(n=>{if(!n||n.error)throw new Error(n&&n.error?n.error:"empty-response");if(n.format!=="point")throw new Error("Bad data");if(!n.results.length)throw new Error("No more data");return this.normalizePoints(n.results,n.columns,s,r)}).catch(n=>{throw Ce(n),n}).then(n=>(d.commit("app/TOGGLE_LOADING",!1),delete this.promisesOfData[a],n)),this.promisesOfData[a])}normalizePoints(t,i,s,r){const a={},n={};if(r=r.slice(),!t||!t.length)return t;let l;Array.isArray(t[0])?l=t[0][0]:l=+new Date(t[0].time)/1e3,r=[...r];const u=fe(s),p=d.state.settings.preferQuoteCurrencySize;for(let c=0;c<t.length;c++){if(!t[c].time&&t[c][0])t[c]={time:typeof i.time<"u"?t[c][i.time]:0,cbuy:typeof i.cbuy<"u"?t[c][i.cbuy]:0,close:typeof i.close<"u"?t[c][i.close]:0,csell:typeof i.csell<"u"?t[c][i.csell]:0,high:typeof i.high<"u"?t[c][i.high]:0,lbuy:typeof i.lbuy<"u"?t[c][i.lbuy]:0,low:typeof i.low<"u"?t[c][i.low]:0,lsell:typeof i.lsell<"u"?t[c][i.lsell]:0,market:typeof i.market<"u"?t[c][i.market]:0,open:typeof i.open<"u"?t[c][i.open]:0,vbuy:typeof i.vbuy<"u"?t[c][i.vbuy]:0,vsell:typeof i.vsell<"u"?t[c][i.vsell]:0};else{if(!a[t[c].market]){for(let m=c-1;m>=0;m--)if(t[m].market===t[c].market){a[t[c].market]=t[m];break}}if(t[c].time=b(t[c].time/1e3,s,u),!p&&(t[c].vbuy||t[c].vsell)&&t[c].close&&(t[c].vbuy=t[c].vbuy/t[c].close,t[c].vsell=t[c].vsell/t[c].close),!a[t[c].market]||a[t[c].market].time<t[c].time)a[t[c].market]=t[c];else if(a[t[c].market]!==t[c]){a[t[c].market].vbuy+=t[c].vbuy,a[t[c].market].vsell+=t[c].vsell,a[t[c].market].cbuy+=t[c].cbuy,a[t[c].market].csell+=t[c].csell,a[t[c].market].lbuy+=t[c].lbuy,a[t[c].market].lsell+=t[c].lsell,a[t[c].market].high=Math.max(t[c].high,a[t[c].market].high),a[t[c].market].low=Math.min(t[c].low,a[t[c].market].low),a[t[c].market].close=t[c].close,t.splice(c,1),c--;continue}}if(n[t[c].market]||(n[t[c].market]=t[c].close),!p&&(t[c].vbuy||t[c].vsell)&&t[c].close&&(t[c].vbuy=t[c].vbuy/t[c].close,t[c].vsell=t[c].vsell/t[c].close),t[c].time===l){const m=r.indexOf(t[c].market);r.splice(m,1)}const[f,v]=ee(t[c].market);t[c].exchange=f,t[c].pair=v}return{data:t,markets:r,from:t[0].time,to:t[t.length-1].time,initialPrices:n}}}const ue=new Ve;class Ke{constructor(){h(this,"chunks",[]);h(this,"cacheRange",{from:null,to:null})}saveChunk(e){let t;if(!this.chunks.length||this.chunks[this.chunks.length-1].to<e.from)t=this.chunks.push(e)-1;else if(this.chunks[0].from>e.to)this.chunks.unshift(e),t=0;else return console.warn("	-> couldn't push or prepend the chunk -> abort"),this.chunks[0];return t===0&&(this.cacheRange.from=e.from),t===this.chunks.length-1&&(this.cacheRange.to=e.to),e}clear(){console.log("[chartCache/this.chunks] clear this.chunks"),this.chunks.splice(0,this.chunks.length),this.cacheRange.from=this.cacheRange.to=null}trim(e){if(!this.chunks.length)return;let t=!1;for(;this.chunks[0]&&this.chunks[0].to<e;)console.debug(`[chart.cache] trim chunk (${this.chunks[0].bars.length} bars)`),this.chunks.splice(0,1),t=!0;return this.cacheRange.from=this.chunks[0].from,t}}class Qe{constructor(e,t){h(this,"isBusy",!1);h(this,"api");h(this,"alert");h(this,"priceline");h(this,"timestamp");h(this,"chart");h(this,"offset");h(this,"originalOffset");h(this,"referencePrice");h(this,"moved");h(this,"levelDragMoveHandler");h(this,"levelDragEndHandler");this.chart=e,!this.chart.isLoading&&this.initialize(t)&&this.bindEvents(t)}initialize(e){if(this.api=this.chart.getPriceApi(),!this.api)return!1;this.offset=re(e),this.originalOffset={...this.offset};const t=this.api.coordinateToPrice(this.offset.y);if(!t)return!1;this.priceline=this.api.getPriceLine(t,this.chart.chartInstance.timeScale().coordinateToLogical(this.offset.x));const i=d.state.settings.alertsClick||e.altKey;return!this.priceline&&!i?!1:(this.referencePrice=this.chart.getPrice(),this.timestamp=Date.now(),this.alert=this.getAlert(t),!0)}getMoveEvent(e){return/touch/.test(e.type)?"touchmove":"mousemove"}getEndEvent(e){return/touch/.test(e.type)?"touchend":"mouseup"}bindEvents(e){const t=this.chart.getChartCanvas();this.levelDragMoveHandler=this.onLevelDragMove.bind(this),this.levelDragEndHandler=this.onLevelDragEnd.bind(this),t.addEventListener(this.getMoveEvent(e),this.levelDragMoveHandler),t.addEventListener(this.getEndEvent(e),this.levelDragEndHandler)}getAlert(e){let t;if(this.priceline){const i=this.priceline.options();t=i.market,i.market?(t=i.market,e=i.price):this.priceline=null}return t||(t=this.chart.mainIndex),{price:e,market:t}}onLevelDragMove(e){const{x:t,y:i}=re(e),s=Math.abs(this.originalOffset.y-i)>5||Date.now()-this.timestamp>750;if(this.offset.x=t,this.offset.y=i,this.priceline){if(e.stopPropagation(),!s)return;const r=_.formatPrice(this.api.coordinateToPrice(i));let a;if(!this.moved){const n=H(d.state.settings.alertsColor);a=z([n[0],n[1],n[2],(n[3]||1)*.5])}this.priceline.applyOptions({price:r,color:a}),this.moved=!0}else s&&this.unbindEvents(e)}async onLevelDragEnd(e){const t=Math.abs(this.originalOffset.y-this.offset.y)>5||Date.now()-this.timestamp>750,i=!this.priceline&&!t&&Math.abs(this.originalOffset.x-this.offset.x)+Math.abs(this.originalOffset.y-this.offset.y)<10;d.state.settings.alerts&&(e.altKey||d.state.settings.alertsClick);const s=this.alert.market;if((this.priceline||i)&&this.chart.chartInstance.clearCrosshairPosition(),this.unbindEvents(e),!this.chart.isLoading)try{if(this.isBusy=!0,this.priceline){const r=_.alerts[this.alert.market].find(u=>u.price===this.alert.price),{price:a,title:n}=this.priceline.options(),l={active:!1,price:a,market:s,message:n};this.alert.price!==a&&t?(r&&await _.moveAlert(r.market,r.price,l,this.referencePrice),this.api.removePriceLine(this.priceline)):await _.removeAlert(this.alert)}else if(i){const r=this.chart.chartInstance.timeScale().coordinateToTime(this.offset.x),a={price:this.alert.price,market:this.alert.market,timestamp:r,active:!1};await _.createAlert(a,this.chart.getPrice())}}finally{this.isBusy=!1}}unbindEvents(e){const t=this.chart.getChartCanvas();t.removeEventListener(this.getEndEvent(e),this.levelDragEndHandler),this.levelDragEndHandler=null,t.removeEventListener(this.getMoveEvent(e),this.levelDragMoveHandler),this.levelDragMoveHandler=null}}class Ue{constructor(e,t){h(this,"isBusy",!1);h(this,"api");h(this,"chart");h(this,"a");h(this,"b");h(this,"market");h(this,"measurementComponent");h(this,"isLoading");h(this,"canvas");h(this,"height");h(this,"top");h(this,"left");h(this,"width");h(this,"onMoveHandler");h(this,"onEndHandler");h(this,"onPanHandler");this.chart=e,this.canvas=this.chart.getChartCanvas(),this.initialize(t)&&this.bindEvents(t)}initialize(e){var a;if(this.api=this.chart.getPriceApi(),!this.api)return!1;const{x:t,y:i}=M(e,!0),{top:s,left:r}=this.canvas.getBoundingClientRect();return this.top=s,this.height=this.canvas.height,this.left=r,this.width=this.canvas.width,this.a={x:Math.max(0,Math.min(this.width,t-r)),y:Math.max(0,Math.min(this.height,i-s))},this.a.price=this.api.coordinateToPrice(this.a.y),this.a.time=(a=this.chart.chartInstance.timeScale())==null?void 0:a.coordinateToTime(this.a.x),this.a.price?(this.market=this.chart.mainIndex,!0):!1}getMoveEvent(e){return/touch/.test(e.type)?"touchmove":"mousemove"}getEndEvent(e){return/touch/.test(e.type)?"touchend":"mouseup"}getClearEvent(){return/touch/.test(event.type)?"touchstart":"mousedown"}bindEvents(e){this.chart.chartInstance.applyOptions({handleScroll:!1}),this.onMoveHandler=this.onMove.bind(this),this.onEndHandler=this.onEnd.bind(this),document.body.addEventListener(this.getMoveEvent(e),this.onMoveHandler),document.body.addEventListener(this.getEndEvent(e),this.onEndHandler)}onPan(){const e=this.chart.getPriceApi(),t=this.chart.chartInstance.timeScale();t&&(this.a.x=t.timeToCoordinate(this.a.time),this.b.x=t.timeToCoordinate(this.b.time)),this.a.y=e.priceToCoordinate(this.a.price),this.b.y=e.priceToCoordinate(this.b.price),this.updateComponent()}onMove(e){var s;const{x:t,y:i}=M(e,!0);this.b={x:Math.max(0,Math.min(this.width,t-this.left)),y:Math.max(0,Math.min(this.height,i-this.top))},this.b.price=this.api.coordinateToPrice(this.b.y),this.b.time=(s=this.chart.chartInstance.timeScale())==null?void 0:s.coordinateToTime(this.b.x),this.measurementComponent?this.updateComponent():this.createComponent()}getPropsData(){const e=[this.a.x,this.b.x].sort((r,a)=>r-a),t=[this.a.y,this.b.y].sort((r,a)=>r-a),i=[this.a.price,this.b.price].sort((r,a)=>r-a),s=(this.b.price-this.a.price)/Math.abs(this.a.price)*100;return{position:{top:t[0],left:e[0],width:e[1]-e[0],height:t[1]-t[0]},low:+ae(i[0],this.market),high:+ae(i[1],this.market),percent:s}}async createComponent(){if(this.isBusy=!0,this.isLoading)return!1;this.isLoading=!0,document.body.style.cursor="progress";const e=await x(()=>import("./ChartMeasurement.5c4cb14.js"),["ChartMeasurement.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","ChartMeasurement.5c4cb14.css"]),{position:t,low:i,high:s,percent:r}=this.getPropsData();this.measurementComponent=q(e.default,{position:t,low:i,high:s,percent:r}),V(this.measurementComponent,this.canvas.parentElement);const a=this.chart.chartInstance.timeScale();a&&(this.onPanHandler=this.onPan.bind(this),a.subscribeVisibleLogicalRangeChange(this.onPanHandler)),this.isLoading=!1,document.body.style.cursor=""}updateComponent(){const{position:e,low:t,high:i,percent:s}=this.getPropsData();this.measurementComponent.position=e,this.measurementComponent.low=t,this.measurementComponent.high=i,this.measurementComponent.percent=s}onEnd(e){this.unbindEvents(e)}async unbindEvents(e){document.body.removeEventListener(this.getEndEvent(e),this.onEndHandler),this.onEndHandler=null,document.body.removeEventListener(this.getMoveEvent(e),this.onMoveHandler),this.onMoveHandler=null,this.chart.chartInstance.applyOptions({handleScroll:!0}),this.canvas.addEventListener(this.getClearEvent(),()=>{this.destroy()},{once:!0})}removeComponent(){if(this.measurementComponent.$destroy(),this.measurementComponent.$el.parentNode.removeChild(this.measurementComponent.$el),this.measurementComponent=null,this.onPanHandler){const e=this.chart.chartInstance.timeScale();e&&e.unsubscribeVisibleLogicalRangeChange(this.onPanHandler),this.onPanHandler=null}}destroy(){this.measurementComponent&&this.removeComponent(),this.isBusy=!1}}const I=[];let P=null,k=null;class Ye{constructor(e){h(this,"chart");h(this,"onPanTimeout");h(this,"legendElements");h(this,"lastCrosshairX");h(this,"activeEvent");h(this,"isSyncingCrosshairs");h(this,"clickHandler");h(this,"contextMenuHandler");h(this,"clearChartsCrosshairsHandler");h(this,"crosshairMoveHandler");h(this,"onPanHandler");h(this,"unsubscribeStore");this.chart=e}bindEvents(){this.subscribeStore(),this.onPanHandler=this.onPan.bind(this),this.chart.chartInstance.timeScale().subscribeVisibleLogicalRangeChange(this.onPanHandler);const e=this.chart.chartElement;this.clickHandler=this.onClick.bind(this),e.addEventListener(ne()?"touchstart":"mousedown",this.clickHandler),this.contextMenuHandler=this.onContextMenu.bind(this),e.addEventListener("contextmenu",this.contextMenuHandler),this.crosshairMoveHandler=this.onCrosshairMove.bind(this),this.chart.chartInstance.subscribeCrosshairMove(this.crosshairMoveHandler),this.clearChartsCrosshairsHandler=this.clearChartsCrosshairs.bind(this),e.addEventListener("mouseleave",this.clearChartsCrosshairsHandler),d.state[this.chart.paneId].showIndicators&&d.state[this.chart.paneId].showLegend&&this.bindLegend(),I.push(this.chart)}unbindEvents(){this.unsubscribeStore(),this.unbindLegend(),this.chart.chartInstance.timeScale().unsubscribeVisibleLogicalRangeChange(this.onPan);{const t=this.chart.chartElement,i=ne()?"touchstart":"mousedown";t.removeEventListener(i,this.clickHandler),this.clickHandler=null,t.removeEventListener("contextmenu",this.contextMenuHandler),this.contextMenuHandler=null}this.chart.chartInstance.unsubscribeCrosshairMove(this.crosshairMoveHandler),this.crosshairMoveHandler=null;const e=I.indexOf(this.chart);e!==-1&&I.splice(e,1)}subscribeStore(){this.unsubscribeStore=d.subscribe(e=>{switch(e.type){case this.chart.paneId+"/FLAG_INDICATOR_AS_SAVED":this.chart.saveIndicatorPreview(e.payload);break;case"settings/SET_CHART_THEME":case"settings/SET_TEXT_COLOR":this.chart.chartInstance.applyOptions(Fe(this.chart.paneId));break;case"settings/TOGGLE_NORMAMIZE_WATERMARKS":this.chart.refreshMarkets();break;case"settings/SET_TIMEZONE_OFFSET":this.chart.setTimezoneOffset(d.state.settings.timezoneOffset),this.chart.clearChart(),this.chart.renderAll();break;case"panes/SET_PANE_MARKETS":e.payload.id===this.chart.paneId&&(d.state[this.chart.paneId].hiddenMarkets={},this.chart.refreshMarkets(),this.chart.clear(),this.chart.fetch());break;case"panes/SET_PANE_ZOOM":e.payload.id===this.chart.paneId&&this.chart.updateFontSize();break;case this.chart.paneId+"/SET_TIMEFRAME":this.chart.clear(),this.chart.fetch();break;case"settings/TOGGLE_ALERTS":case this.chart.paneId+"/TOGGLE_ALERTS":case this.chart.paneId+"/TOGGLE_ALERTS_LABEL":case"settings/SET_ALERTS_COLOR":case"settings/SET_ALERTS_LINESTYLE":case"settings/SET_ALERTS_LINEWIDTH":case"app/EXCHANGE_UPDATED":case this.chart.paneId+"/TOGGLE_MARKET":this.chart.refreshMarkets(),this.chart.refreshAllIndicatorAdapters(),this.chart.renderAll();break;case this.chart.paneId+"/SET_REFRESH_RATE":this.chart.clearQueue(),this.chart.setupQueue();break;case this.chart.paneId+"/TOGGLE_LEGEND":case this.chart.paneId+"/TOGGLE_INDICATORS":d.state[this.chart.paneId].showIndicators&&d.state[this.chart.paneId].showLegend?this.bindLegend():this.unbindLegend();break;case this.chart.paneId+"/SET_GRIDLINES":this.chart.chartInstance.applyOptions(ge(this.chart.paneId));break;case this.chart.paneId+"/SET_BORDER":case this.chart.paneId+"/TOGGLE_AXIS":this.chart.chartInstance.applyOptions(ze(this.chart.paneId));break;case this.chart.paneId+"/SET_WATERMARK":case this.chart.paneId+"/TOGGLE_NORMAMIZE_WATERMARKS":this.chart.updateWatermark();break;case this.chart.paneId+"/SET_INDICATOR_OPTION":this.chart.setIndicatorOption(e.payload.id,e.payload.key,e.payload.value,e.payload.silent);break;case this.chart.paneId+"/SET_PRICE_SCALE":e.payload.priceScale&&this.chart.refreshPriceScale(e.payload.id);break;case this.chart.paneId+"/SET_INDICATOR_SCRIPT":this.chart.rebuildIndicator(e.payload.id);break;case this.chart.paneId+"/ADD_INDICATOR":this.chart.addIndicator(e.payload.id)&&(this.chart.redrawIndicator(e.payload.id),d.state[this.chart.paneId].showIndicators&&d.state[this.chart.paneId].showLegend&&this.bindLegend(e.payload.id));break;case this.chart.paneId+"/UPDATE_INDICATOR_ORDER":this.chart.moveIndicator(e.payload.id,e.payload.position);break;case this.chart.paneId+"/REMOVE_INDICATOR":this.unbindLegend(e.payload),this.chart.removeIndicator(e.payload);break;case this.chart.paneId+"/TOGGLE_FILL_GAPS_WITH_EMPTY":this.chart.toggleFillGapsWithEmpty();break;case"settings/TOGGLE_AUTO_HIDE_HEADERS":this.chart.refreshChartDimensions();break}})}onContextMenu(e){if(window.innerWidth<375)return;const t=e.currentTarget;e.preventDefault();const{x:i,y:s}=M(e,!0),{top:r,left:a}=t.getBoundingClientRect(),n=this.chart.getPriceApi(),l=this.chart.mainIndex;let u,p;if(n){const m=n.coordinateToPrice(s-r);m&&(u=_.formatPrice(m));const g=this.chart.chartInstance.timeScale(),S=n.getPriceLine(u,g?g.coordinateToLogical(i-a):null);if(S){const O=S.options();p={price:O.price,market:O.market,message:O.message}}}const c=b(Date.now()/1e3,this.chart.timeframe),f=d.state[this.chart.paneId].timeframe.toString(),v=this.chart.paneId;this.createContextMenu({value:{top:s-1,left:i-1,width:2,height:2},market:l,price:u,timeframe:f,timestamp:c,paneId:v,alert:p,getPrice:this.chart.getPrice.bind(this.chart)})}async createContextMenu(e){if(P){P.$off("cmd");for(const t in e)P[t]=e[t]}else{document.body.style.cursor="progress";const t=await x(()=>import("./ChartContextMenu.5c4cb14.js"),["ChartContextMenu.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","AlertsList.5c4cb14.js","AlertsList.5c4cb14.css"]);document.body.style.cursor="",P=q(t.default,e),V(P)}P.$on("cmd",t=>{if(this.chart[t[0]]instanceof Function)this.chart[t[0]](...t.slice(1));else throw new Error(`[chart/control] ContextMenu->chart->${t[0]} is not a function`)})}onClick(e){if(C.hasDialogOpened||C.hasDialogOpened||e instanceof MouseEvent&&e.button)return;const t=this.activeEvent&&this.activeEvent.isBusy;if(e.shiftKey)this.activeEvent=new Ue(this.chart,e);else if(d.state.settings.alerts){if(t)return;this.activeEvent=new Qe(this.chart,e)}}onCrosshairMove(e){!e||!e.point||(this.syncCrosshair(e),this.lastCrosshairX!==e.point.x&&(this.lastCrosshairX=e.point.x,this.legendElements&&this.updateLegend(e)))}onPan(e){!e||this.chart.panPrevented||this.chart.isLoading||this.chart.type!=="time"||(this.onPanTimeout&&(clearTimeout(this.onPanTimeout),this.onPanTimeout=null),this.onPanTimeout=setTimeout(()=>{this.onPanTimeout=null,this.chart.chartCache.cacheRange.from!==null&&(e=this.chart.chartInstance.timeScale().getVisibleLogicalRange(),this.chart.savePosition(e),this.chart.fetchMore(e))},500))}async bindLegend(e){if(this.legendElements||(this.legendElements={}),!e){for(const s in d.state[this.chart.paneId].indicators)this.bindLegend(s);return}await te(1);const t=this.chart.paneId+e;if(this.legendElements[t])return;const i=document.getElementById(t);i&&(this.legendElements[t]=i)}unbindLegend(e){if(!this.legendElements)return;if(!e){for(const i of this.chart.loadedIndicators)this.unbindLegend(i.id);this.legendElements=null;return}const t=this.chart.paneId+e;for(const i in this.legendElements)if(t===i){this.legendElements[i].innerText="",delete this.legendElements[i];return}}clearChartsCrosshairs(){if(this.isSyncingCrosshairs){for(let e=0;e<I.length;e++)I[e].chartInstance.setCrosshair(null,null,null);this.isSyncingCrosshairs=!1}}syncCrosshair(e){let t;if(e.point&&e.point.y){const i=this.chart.getPrice(),s=this.chart.getPriceApi();i&&s&&(t=(1-s.coordinateToPrice(e.point.y)/i)*-1)}for(let i=0;i<I.length;i++){if(I[i].paneId===this.chart.paneId)continue;const s=I[i].getPriceApi(),r=I[i].chartInstance.timeScale();let a,n;if(e.time&&r&&(a=r.timeToCoordinate(b(+e.time,I[i].timeframe,I[i].isOddTimeframe))),s){const l=I[i].getPrice();n=s.priceToCoordinate(l+l*t)}I[i].chartInstance.setCrosshair(a,n,!0),this.isSyncingCrosshairs=!0}}updateLegend(e){for(let t=0;t<this.chart.loadedIndicators.length;t++){const i=this.chart.loadedIndicators[t];if(!i.apis.length)continue;const s=this.chart.paneId+i.id;if(!this.legendElements[s]||!e.point.x)continue;let r="";for(let a=0;a<i.apis.length&&!(a>10);a++){const n=i.apis[a],l=e.seriesData.get(n);if(r.length&&(r+=" | "),!l){r+="na";continue}let u="price",p;i.options.priceFormat&&(i.options.priceFormat.type&&(u=i.options.priceFormat.type),p=i.options.priceFormat.precision);const c=u==="volume"?Se:Ee;l.value?r+=c(l.value,p):l.close&&(r+=`O: ${c(l.open,p)} H: ${c(l.high,p)} L: ${c(l.low,p)} C: ${c(l.close,p)}`)}this.legendElements[s].textContent=r}}async toggleTimeframeDropdown(e){const t={value:e.currentTarget,paneId:this.chart.paneId};if(k)k.value===e.currentTarget?k.value=null:(k.paneId=t.paneId,k.value=t.value);else{const i=await x(()=>import("./TimeframeDropdown.5c4cb14.js"),["TimeframeDropdown.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","TimeframeDropdown.5c4cb14.css"]);k=q(i.default,t),V(k)}}}const Xe={time({trade:o,timeframe:e,isOdd:t}){return b(o.timestamp/1e3,e,t)},tick({renderer:o,timeframe:e,trade:t}){return o.bar.cbuy+o.bar.csell>=e?Math.max(o.timestamp+.001,Math.round(t.timestamp/1e3)):o.timestamp},vol({renderer:o,timeframe:e,trade:t}){return o.bar.vbuy+o.bar.vsell>=e?Math.max(o.timestamp+.001,Math.round(t.timestamp/1e3)):o.timestamp},bps({renderer:o,trade:e,marketsFilters:t,timeframe:i}){const{count:s,sum:r}=Object.keys(o.sources).reduce((l,u)=>(!t[u]||o.sources[u].open===null||(l.sum+=o.sources[u].close,l.count++),l),{count:0,sum:0}),a=r/s,n=(a-o.bar.close)/o.bar.close*100*100;return!o.bar.close||Math.abs(n)>i?(o.bar.close=a,Math.max(o.timestamp+.001,Math.round(e.timestamp/1e3))):o.timestamp}};function Je(o){if(o.bar={...o.bar,vbuy:0,vsell:0,cbuy:0,csell:0,lbuy:0,lsell:0,empty:!0},typeof o.sources<"u")for(const e in o.sources)F(o.sources[e])}function F(o){return o.close!==null&&(o.open=o.close,o.high=o.close,o.low=o.close),o.vbuy=0,o.vsell=0,o.cbuy=0,o.csell=0,o.lbuy=0,o.lsell=0,o.empty=!0,o}function me(o,e){return{pair:o.pair,exchange:o.exchange,time:e||o.time,open:o.open,high:o.high,low:o.low,close:o.close,vbuy:o.vbuy,vsell:o.vsell,cbuy:o.cbuy,csell:o.csell,lbuy:o.lbuy,lsell:o.lsell}}function Ze(o,e){if(!o.length)e&&e.bar&&!e.bar.empty&&Array.prototype.push.apply(o,Object.values(e.sources).filter(t=>t.empty===!1));else if(e&&e.timestamp>o[o.length-1].time){const t=Object.values(e.sources).filter(i=>i.empty===!1);for(let i=0;i<t.length;i++){const s=t[i];s.time=e.timestamp;for(let r=o.length-1;r>=0;r--){const a=o[r];if(a.time<e.timestamp){o.splice(r+1,0,s),t.splice(i,1),i--;break}else if(a.exchange===s.exchange&&a.pair===s.pair){a.vbuy+=s.vbuy,a.vsell+=s.vsell,a.cbuy+=s.cbuy,a.csell+=s.csell,a.lbuy+=s.lbuy,a.lsell+=s.lsell,a.open=s.open,a.high=s.high,a.low=s.low,a.close=s.close,t.splice(i,1),i--;break}}}}}function et(o,e,t,i,s,r,a){o.sources[e]={pair:t,exchange:i,close:s,active:r},F(o.sources[e]),a&&st(a,e,i,t,s)}function tt(o,e){for(const t in o.bars)typeof e[t]>"u"&&delete o.bars[t]}function it(o,e){for(const t in e.initialPrices)if(o.bars[t])o.bars[t].open=o.bars[t].high=o.bars[t].low=o.bars[t].close=e.initialPrices[t];else{const[i,s]=ee(t);o.bars[t]={...F({close:e.initialPrices[t]}),pair:s,exchange:i}}}async function st(o,e,t,i,s){o.bars[e]={...F({close:s}),pair:i,exchange:t,cbuy:1,csell:1}}async function rt(o,e){const t=await T.getAllTickers();for(const i in t){const s=t[i].price;if(!s||typeof e[i]>"u")continue;const[r,a]=ee(i);o.bars[i]={time:o.time,close:s,high:s,low:s,open:s,exchange:r,pair:a}}}function at(o,e){if(o.time===e)return o.bars;for(const t in o.bars)o.bars[t].time=e;return o.time=e,o.bars}let nt=class{constructor(e,t){h(this,"paneId");h(this,"watermark");h(this,"chartCache");h(this,"chartControl");h(this,"chartInstance");h(this,"chartElement");h(this,"loadedIndicators",[]);h(this,"panPrevented");h(this,"activeRenderer");h(this,"renderedRange",{from:null,to:null});h(this,"marketsFilters",{});h(this,"marketsIndexes",[]);h(this,"mainIndex");h(this,"timezoneOffset",0);h(this,"fillGapsWithEmpty",!0);h(this,"timeframe");h(this,"isOddTimeframe");h(this,"type");h(this,"priceScales",[]);h(this,"isLoading",!1);h(this,"hasReachedEnd",!1);h(this,"isPrepending",!1);h(this,"prepend",{bars:{},time:null});h(this,"activeChunk");h(this,"queuedTrades",[]);h(this,"historicalMarkets");h(this,"seriesIndicatorsMap",{});h(this,"previousLogicalRange");h(this,"axis",{top:0,left:0,right:0,time:0});h(this,"_releaseQueueInterval");h(this,"_releasePanTimeout");h(this,"_queueHandler",this.releaseQueue.bind(this));h(this,"_refreshDecimalsHandler",this.refreshAutoDecimals.bind(this));h(this,"_promiseOfMarkets");h(this,"_promiseOfMarketsRender");h(this,"_priceIndicatorId");h(this,"_priceApi");h(this,"_alertsRendered");h(this,"_timeToRecycle");h(this,"_recycleTimeout");this.paneId=e,this.chartElement=t,this.chartCache=new Ke,this.initialize()}initialize(){this.createChart(),this.setupQueue(),this.setupRecycle(),this.setTimeframe(d.state[this.paneId].timeframe),this.setTimezoneOffset(d.state.settings.timezoneOffset),this.refreshMarkets(),this.fetch(),T.on("decimals",this._refreshDecimalsHandler),this.fillGapsWithEmpty=!!d.state[this.paneId].fillGapsWithEmpty}async refreshMarkets(){var a;if(d.state.app.isExchangesReady)this._promiseOfMarkets&&(this._promiseOfMarkets=null);else if(!this._promiseOfMarkets)this._promiseOfMarkets=Re(n=>n.app.isExchangesReady).then(this.refreshMarkets.bind(this));else return this._promiseOfMarkets;const e=d.state.panes.panes[this.paneId].markets,t=d.state.settings.normalizeWatermarks,i=[],s={},r={};for(const n of e){const[l]=n.split(":"),u=d.state.panes.marketsListeners[n];let p=n;u&&(p=ke(u.local)),r[n]=d.state.exchanges[l]&&!d.state.exchanges[l].disabled&&!d.state[this.paneId].hiddenMarkets[n],r[n]&&i.indexOf(p)===-1&&i.push(!t||!u?n:p),s[p]||(s[p]=0),s[p]++}this.marketsFilters=r,this.marketsIndexes=Object.keys(s),this.historicalMarkets=ue.filterOutUnavailableMarkets(e),this.isPrepending=this.marketsIndexes.length>1||this.type!=="time",this.mainIndex=(a=this.marketsIndexes.reduce((n,l)=>(n.push({index:l,count:this.marketsIndexes[l]}),n),[]).sort((n,l)=>l.count-n.count)[0])==null?void 0:a.index,this.updateWatermark(i),this.resetPriceScales(),this.refreshAutoDecimals(),tt(this.prepend,this.marketsFilters),this.isPrepending&&rt(this.prepend,this.marketsFilters)}setTimeframe(e){const t=e[e.length-1];t==="t"?this.type="tick":t==="b"?this.type="bps":t==="v"?this.type="vol":this.type="time",this.timeframe=parseFloat(e),this.isOddTimeframe=fe(this.timeframe),this.previousLogicalRange=null,this.updateWatermark()}setTimezoneOffset(e){const t=this.timezoneOffset;this.timezoneOffset=e/1e3;const i=this.timezoneOffset-t;this.activeRenderer&&(this.activeRenderer.localTimestamp+=i)}createChart(){console.log(`[chart/${this.paneId}/controller] create chart`);const e=oe(he(j,this.paneId),le(this.paneId),ge(this.paneId),de(this.paneId,this.chartElement.clientWidth));this.chartInstance=pe(this.chartElement,e),this.addPaneIndicators(),this.updateWatermark(),this.updateFontSize(),this.chartControl||(this.chartControl=new Ye(this)),this.chartControl.bindEvents()}removeChart(){for(console.log(`[chart/${this.paneId}/controller] remove chart`),this.chartControl.unbindEvents(),this.priceScales.splice(0,this.priceScales.length);this.loadedIndicators.length;)this.removeIndicator(this.loadedIndicators[0]);this.chartInstance&&(this.chartInstance=null,this.chartElement.innerHTML="")}getLoadedIndicator(e){for(let t=0;t<this.loadedIndicators.length;t++)if(this.loadedIndicators[t].id===e)return this.loadedIndicators[t]}setIndicatorOption(e,t,i,s=!1){const r=this.getLoadedIndicator(e);if(r&&(r.options[t]=i,!s)){if(t==="visible"){this.toggleIndicatorVisibility(r,i);return}else t==="priceFormat"&&i.auto&&setTimeout(()=>this.refreshAutoDecimals(null,e));for(let a=0;a<r.apis.length;a++)r.apis[a].applyOptions({[t]:i});t==="priceScaleId"&&this.ensurePriceScale(r.options),r.model.options[t]&&r.model.options[t].rebuild?(this.refreshIndicatorAdapter(r,this.activeRenderer),this.redrawIndicator(e)):this.optionRequiresRedraw(t)&&this.redrawIndicator(e)}}toggleIndicatorVisibility(e,t){t?(e.model?this.createIndicatorSeries(e):this.prepareIndicator(e),this.redrawIndicator(e.id)):this.removeIndicatorSeries(e)}optionRequiresRedraw(e){return/upColor|downColor|wickDownColor|wickUpColor|borderDownColor|borderUpColor|compositeOperation|src|priceScaleId/i.test(e)?!0:!/color|priceFormat|linetype|width|style/i.test(e)}rebuildIndicator(e){this.removeIndicator(this.getLoadedIndicator(e)),this.addIndicator(e)&&this.redrawIndicator(e)}getReferencedIndicators(e){return e.model.references.slice().map(t=>t.indicatorId).filter((t,i,s)=>s.indexOf(t)===i)}redrawIndicator(e,t,i){const s=this.getLoadedIndicator(e);this.clearIndicatorSeries(s);let r=[];for(const a of this.chartCache.chunks)t||i?r=r.concat(a.bars.filter(n=>(!t||n.time>=t)&&(!i||n.time<i))):r=r.concat(a.bars);this.renderBars(r,e)}getVisibleRange(){const e=this.chartInstance.timeScale().getVisibleRange();return e&&(e.from-=this.timezoneOffset,e.to-=this.timezoneOffset,e)}addPaneIndicators(){for(const e of d.state[this.paneId].indicatorOrder)this.addIndicator(e)}updateWatermark(e){if(e)if(!e.length)this.watermark="Empty";else if(d.state.settings.normalizeWatermarks)this.watermark=e.join(" | ");else{const t=e.length-3;this.watermark=e.slice(0,3).join(" + ")+(t>0?" + "+t+" other"+(t>1?"s":""):"")}this.chartInstance&&this.chartInstance.applyOptions({watermark:{text:`    ${this.watermark+" | "+K(d.state[this.paneId].timeframe)}    `,...le(this.paneId).watermark}})}updateFontSize(){if(!this.chartElement)return;const e=d.state.panes.panes[this.paneId].zoom||1,t=this.chartElement.clientWidth*.05*(d.state.settings.normalizeWatermarks?1:.5);this.chartInstance.applyOptions({layout:{fontSize:14*e},watermark:{fontSize:Math.max(16,Math.min(144,t*e))}})}addIndicator(e,t){if(this.getLoadedIndicator(e))return!0;if(t>5)return!1;const i=d.state[this.paneId].indicators[e],s=i.options||{};console.debug(`[chart/${this.paneId}/addIndicator] adding ${e}`);const r={id:e,libraryId:i.libraryId||e,options:JSON.parse(JSON.stringify(s)),script:i.script,model:null,adapter:null,apis:[]};try{this.prepareIndicator(r)}catch(a){return a.status==="indicator-required"&&!this.resolveDependency(r.id,a.serieId,t||0)&&C.confirm({title:"Referenced indicator",message:`The <code class="-filled">${r.libraryId}</code> indicator you added requires the <code class="-filled">$${a.serieId}</code> series, but it was not located among the added indicators.`,html:!0,cancel:!1}),!a.status&&!C.isDialogOpened("indicator")&&C.openIndicator(this.paneId,r.id),!1}return this.loadedIndicators.push(r),!0}resolveDependency(e,t,i){const s=d.state[this.paneId].indicators;for(const r in s)if(!(r===e||!s[r].series)&&s[r].series.indexOf(t)!==-1)return this.addIndicator(r,i+1)?(i===0&&this.addIndicator(e,i+1),!0):!1;return s[t]&&this.addIndicator(s[t].id,i+1)?(i===0&&this.addIndicator(e,i+1),!0):!1}prepareIndicator(e){try{const t=Be(e,this.seriesIndicatorsMap);d.state[this.paneId].indicatorsErrors[e.id]&&d.commit(this.paneId+"/SET_INDICATOR_ERROR",{id:e.id,error:null}),e.model=t,e.options=Object.keys(t.options).reduce((i,s)=>(i[s]=typeof e.options[s]<"u"?e.options[s]:t.options[s].default,i),e.options),d.commit(this.paneId+"/SET_INDICATOR_OPTIONS_DEFINITIONS",{id:e.id,optionsDefinitions:t.options}),e.options.visible!==!1&&this.createIndicatorSeries(e)}catch(t){if(e.options.visible!==!1)throw console.error(`[chart/${this.paneId}/prepareIndicator] transpilation failed`),console.error("	->",t),d.commit(this.paneId+"/SET_INDICATOR_ERROR",{id:e.id,error:t.message}),t}}bindIndicator(e,t){if(!(!t||typeof t.indicators[e.id]<"u"||!e.model)){if(t.indicators[e.id]=Ge(e),!this.activeRenderer||t===this.activeRenderer){for(let i=0;i<t.indicators[e.id].plotsOptions.length;i++)e.apis[i].applyOptions(t.indicators[e.id].plotsOptions[i]);this.refreshIndicatorAdapter(e,t)}return this.prepareRendererForIndicators(e,t),e}}refreshIndicatorAdapter(e,t){try{e.adapter=Ne(e.model,this.marketsFilters,e.options)}catch(i){throw this.unbindIndicator(e,t),i}}refreshAllIndicatorAdapters(){for(const e of this.loadedIndicators)this.refreshIndicatorAdapter(e,this.activeRenderer)}unbindIndicator(e,t){!t||typeof t.indicators[e.id]>"u"||delete t.indicators[e.id]}ensurePriceScale(e){const{priceScaleId:t,scaleMargins:i}=e;this.priceScales.indexOf(t)===-1&&this.priceScales.push(t);let s=d.state[this.paneId].priceScales[t];(!s||i&&(!s.scaleMargins||i.top!==s.scaleMargins.top||i.bottom!==s.scaleMargins.bottom))&&(s||(s={}),i?s.scaleMargins=i:s.scaleMargins={top:.1,bottom:.2},d.commit(this.paneId+"/SET_PRICE_SCALE",{id:t,priceScale:s})),this.refreshPriceScale(t)}resetPriceScales(){for(let e=0;e<this.priceScales.length;e++)try{this.chartInstance.priceScale(this.priceScales[e]).applyOptions({autoScale:!0})}catch{}}removeIndicator(e){typeof e=="string"&&(e=this.getLoadedIndicator(e)),e&&(this.removeIndicatorSeries(e),this.loadedIndicators.splice(this.loadedIndicators.indexOf(e),1))}moveIndicator(e,t){const i=this.loadedIndicators.findIndex(a=>a.id===e);if(i===-1){console.warn(`[${this.paneId}/moveIndicator] indicator with ID ${e} not found in loadedIndicators`);return}const[s]=this.loadedIndicators.splice(i,1),r=Math.min(t,this.loadedIndicators.length);this.loadedIndicators.splice(r,0,s);for(const a of this.loadedIndicators)this.removeIndicatorSeries(a);for(const a of this.loadedIndicators)this.createIndicatorSeries(a);this.renderAll()}clearChart(e){console.debug(`[chart/${this.paneId}/controller] clear chart (all series emptyed)`),e||this.preventPan();for(const t of this.loadedIndicators)this.clearIndicatorSeries(t);this._alertsRendered=!1,this.renderedRange.from=this.renderedRange.to=null}clearData(){console.log(`[chart/${this.paneId}/controller] clear data`),this.seriesIndicatorsMap={},this.activeRenderer=null,this.activeChunk=null,this.queuedTrades.splice(0,this.queuedTrades.length)}clearPriceLines(e){for(let t=0;t<this.loadedIndicators.length;t++)if(!(e&&e.indexOf(this.loadedIndicators[t].id)===-1)){this._priceIndicatorId===this.loadedIndicators[t].id&&(this._alertsRendered=!1);for(let i=0;i<this.loadedIndicators[t].apis.length;i++)this.loadedIndicators[t].apis[i].removeAllPriceLines()}}clear(){console.log(`[chart/${this.paneId}/controller] clear`),this.chartCache.clear(),this.clearData(),this.clearChart(),this.hasReachedEnd=!1,this.setTimeframe(d.state[this.paneId].timeframe)}getActiveChunk(){return!this.activeChunk&&this.chartCache.cacheRange.to===this.activeRenderer.timestamp?(this.activeChunk=this.chartCache.chunks[this.chartCache.chunks.length-1],this.activeChunk.active=!0):(this.activeChunk&&(this.activeChunk.active=!1),this.activeChunk=this.chartCache.saveChunk({from:this.activeRenderer.timestamp,to:this.activeRenderer.timestamp,active:!0,rendered:!0,bars:[]})),this.activeChunk}destroy(){console.log(`[chart/${this.paneId}/controller] destroy`),this.chartCache.clear(),this.clearData(),this.clearChart(),this.removeChart(),this.clearQueue(),this.clearRecycle(),T.off("decimals",this._refreshDecimalsHandler)}clearIndicatorSeries(e){e.id===this._priceIndicatorId&&(this._priceIndicatorId=null,this._priceApi=null);for(let t=0;t<e.apis.length;t++)e.apis[t].removeAllPriceLines(),e.apis[t].setData([])}setupQueue(){if(!this._releaseQueueInterval){if(!d.state[this.paneId].refreshRate){this._releaseQueueInterval=requestAnimationFrame(this._queueHandler);return}console.debug(`[chart/${this.paneId}/controller] setup queue (${Te(d.state[this.paneId].refreshRate)})`),this._releaseQueueInterval=setInterval(this._queueHandler,d.state[this.paneId].refreshRate)}}clearQueue(){this._releaseQueueInterval&&(clearInterval(this._releaseQueueInterval),cancelAnimationFrame(this._releaseQueueInterval),delete this._releaseQueueInterval,this.releaseQueue())}releaseQueue(){if(this.queuedTrades.length)try{this.renderRealtimeTrades(this.queuedTrades)}catch(e){console.log(e)}finally{this.queuedTrades.splice(0,this.queuedTrades.length)}}queueTrades(e){Array.prototype.push.apply(this.queuedTrades,e),d.state[this.paneId].refreshRate||(this._releaseQueueInterval=requestAnimationFrame(this._queueHandler))}renderRealtimeTrades(e){if(!e.length)return;let t=!1;for(let i=0;i<e.length;i++){const s=e[i],r=s.exchange+":"+s.pair;if(typeof this.marketsFilters[r]>"u")continue;let a;if(this.activeRenderer?a=Xe[this.activeRenderer.type]({renderer:this.activeRenderer,timeframe:this.timeframe,trade:s,isOdd:this.isOddTimeframe,marketsFilters:this.marketsFilters}):a=s.timestamp/1e3,!this.activeRenderer||this.activeRenderer.timestamp<a)if(this.activeRenderer){(!this.activeChunk||this.activeChunk.to<this.activeRenderer.timestamp&&this.activeChunk.bars.length>=Oe)&&this.getActiveChunk(),this.activeRenderer.bar.empty||this.updateBar(this.activeRenderer);for(const l in this.activeRenderer.sources)this.activeRenderer.sources[l].empty===!1&&this.activeChunk.bars.push(me(this.activeRenderer.sources[l],this.activeRenderer.timestamp));this.activeChunk.to=this.chartCache.cacheRange.to=this.activeRenderer.timestamp,this.renderedRange.to<this.activeRenderer.timestamp&&(this.renderedRange.to=this.activeRenderer.timestamp),this.nextBar(a,this.activeRenderer)}else this.activeRenderer=this.createRenderer(a);(!this.activeRenderer.sources[r]||typeof this.activeRenderer.sources[r].pair>"u")&&(et(this.activeRenderer,r,s.pair,s.exchange,+s.price,this.marketsFilters[r],this.isPrepending&&this.prepend),t=!0);const n=this.marketsFilters[r];if(s.liquidation){this.activeRenderer.sources[r]["l"+s.side]+=s.amount,this.activeRenderer.bar.empty=!1,n&&(this.activeRenderer.bar["l"+s.side]+=s.amount);continue}this.activeRenderer.sources[r].close=+s.price,this.activeRenderer.sources[r].empty?this.activeRenderer.sources[r].open=this.activeRenderer.sources[r].high=this.activeRenderer.sources[r].low=this.activeRenderer.sources[r].close:(this.activeRenderer.sources[r].high=Math.max(this.activeRenderer.sources[r].high,this.activeRenderer.sources[r].close),this.activeRenderer.sources[r].low=Math.min(this.activeRenderer.sources[r].low,this.activeRenderer.sources[r].close)),this.activeRenderer.sources[r]["c"+s.side]+=s.count,this.activeRenderer.sources[r]["v"+s.side]+=s.amount,this.activeRenderer.sources[r].empty=!1,n&&(this.activeRenderer.bar["v"+s.side]+=s.amount,this.activeRenderer.bar["c"+s.side]+=s.count,this.activeRenderer.bar.empty=!1)}if(!this.activeRenderer||this.activeRenderer.bar.empty||t){t&&this.renderAll();return}this.updateBar(this.activeRenderer),this.renderedRange.to<this.activeRenderer.timestamp&&(this.renderedRange.to=this.activeRenderer.timestamp)}renderBars(e,t,i){if(Ze(e,this.activeRenderer),!e.length)return;const{barCount:s,from:r,to:a,temporaryRenderer:n,computedSeries:l,indicatorsIds:u}=this.computeBars(e,t);if(this.clearPriceLines(u),this.activeRenderer){this.activeRenderer.bar={...n.bar,close:this.activeRenderer.bar.close};for(const p in n.indicators)this.activeRenderer.indicators[p]=n.indicators[p];for(const p in n.sources)this.activeRenderer.sources[p]=n.sources[p]}else this.activeRenderer=n;this.replaceData(l,i),setTimeout(this.renderAlerts.bind(this)),(!u||!u.length)&&(this.activeRenderer&&(this.activeRenderer.length=s),e.length?(this.renderedRange.from=r,this.renderedRange.to=a):this.renderedRange.from=this.renderedRange.to=null)}computeBars(e,t){let i,s=!1;if(t){const p=this.getLoadedIndicator(t);(p.options.priceScaleId==="left"||p.options.priceScaleId==="right")&&(s=!0),i=[...this.getReferencedIndicators(p),t]}const r={};let a=null,n=null,l,u=0;for(let p=0;p<=e.length;p++){const c=e[p];if(!c||!l||c.time>l.timestamp){if(l){a===null&&(a=l.timestamp),n=l.timestamp;const m=this.computeBar(l,i);for(const g in m)!s&&i&&t!==g&&i.indexOf(g)!==-1||(typeof r[g]>"u"&&(r[g]=[]),r[g].push(m[g]))}if(!c)break;if(u++,l){if(this.fillGapsWithEmpty&&l.type==="time"){const m=(c.time-l.timeframe-l.timestamp)/l.timeframe;if(m>0)for(let g=0;g<m;g++){this.incrementRendererBar(l);for(const S in r)r[S].push({time:l.localTimestamp});u++}}this.nextBar(c.time,l)}else l=this.createRenderer(c.time||this.activeRenderer.timestamp,i)}const f=c.exchange+":"+c.pair,v=this.marketsFilters[f];v&&!c.empty&&(l.bar.empty=!1,l.bar.vbuy+=c.vbuy,l.bar.vsell+=c.vsell,l.bar.cbuy+=c.cbuy,l.bar.csell+=c.csell,l.bar.lbuy+=c.lbuy,l.bar.lsell+=c.lsell),l.sources[f]=me(c),l.sources[f].empty=!1,l.sources[f].active=v}return{from:a,to:n,barCount:u,temporaryRenderer:l,computedSeries:r,indicatorsIds:i}}removeIndicatorSeries(e){if(this.chartInstance)for(let i=0;i<e.apis.length;i++)this.chartInstance.removeSeries(e.apis[i]),delete this.seriesIndicatorsMap[e.apis[i].id],e.apis.splice(i--,1);this.unbindIndicator(e,this.activeRenderer),typeof this.loadedIndicators.find(i=>i.id!==e.id&&i.options.visible!==!1&&i.options.priceScaleId===e.options.priceScaleId)>"u"&&this.priceScales.splice(this.priceScales.indexOf(e.options.priceScaleId),1)}createIndicatorSeries(e){if(!e.model)return;const t=[],i=d.state[this.paneId].priceScales[e.options.priceScaleId];for(let s=0;s<e.model.plots.length;s++){const r=e.model.plots[s],a=we("add-"+r.type+"-series"),n=W(e,e.model.plots[s],i),l=this.chartInstance[a](W(e,e.model.plots[s]));l.id=r.id,this.seriesIndicatorsMap[r.id]={indicatorId:e.id,plotIndex:s},t.push(r.id),e.apis.push(l),this.ensurePriceScale(n)}d.commit(this.paneId+"/SET_INDICATOR_SERIES",{id:e.id,series:t}),this.bindIndicator(e,this.activeRenderer)}refreshPriceScale(e){const t=d.state[this.paneId].priceScales[e];this.chartInstance.priceScale(e).applyOptions({scaleMargins:t.scaleMargins,mode:t.mode})}preventPan(){if(this.panPrevented)return;const e=100;typeof this._releasePanTimeout<"u"&&clearTimeout(this._releasePanTimeout),this.panPrevented=!0,this._releasePanTimeout=window.setTimeout(()=>{this.panPrevented=!1},e)}async renderAll(e){if(!this.chartInstance)return;if(this._promiseOfMarkets)return this._promiseOfMarketsRender||(this._promiseOfMarketsRender=this._promiseOfMarkets.then(()=>{this._promiseOfMarketsRender=null,this.renderAll(!0)})),this._promiseOfMarketsRender;const t=this.chartInstance.timeScale().scrollPosition();this.clearChart(e),this.renderBars(this.chartCache.chunks.length?this.chartCache.chunks.reduce((i,s)=>i.concat(s.bars),[]):[],null,!e),t&&this.chartInstance.timeScale().scrollToPosition(t,!1)}async renderAlerts(){if(this._alertsRendered||!d.state.settings.alerts||!d.state[this.paneId].showAlerts)return;const e=this.getPriceApi();if(e){for(const t of this.marketsIndexes){const i=await _.getAlerts(t);for(let s=0;s<i.length;s++)this.renderAlert(i[s],e)}this._alertsRendered=!0}}onAlert({timestamp:e,price:t,market:i,type:s,newPrice:r}){if(this.marketsIndexes.indexOf(i)===-1)return;const a=_.alerts[i].find(c=>c.price===t),n=this.getPriceApi();if(!n)return;const l=this.chartInstance.timeScale();let u;l&&e&&(u=l.coordinateToLogical(l.timeToCoordinate(e)));const p=n.getPriceLine(r||t,u);switch(s){case w.DELETED:p&&n.removePriceLine(p);break;case w.UPDATED:p&&n.removePriceLine(p),this.renderAlert({...a,price:r},n);break;case w.TRIGGERED:d.state.settings.alertSound&&Pe.playOnce(d.state.settings.alertSound),p&&n.removePriceLine(p),this.renderAlert(a,n);break;case w.CREATED:p&&n.removePriceLine(p),this.renderAlert({timestamp:e,price:t,market:i},n,.5);break;case w.ACTIVATED:p&&n.removePriceLine(p),this.renderAlert(a,n);break;case w.DEACTIVATED:p&&n.removePriceLine(p),this.renderAlert(a,n,.5);break}}renderAlert(e,t,i){if(!t)return;let s;if(e.timestamp){const l=b(e.timestamp,this.timeframe);s=this.chartInstance.timeScale().coordinateToLogical(this.chartInstance.timeScale().timeToCoordinate(l))}const r=d.state[this.paneId].showAlertsLabel;let a="";r&&e.message&&e.message.length<3&&(a=e.message);let n=d.state.settings.alertsColor;if(e.triggered&&(a+="✔"),i||e.triggered){const l=H(n);l[3]=(l[3]||1)*(i||.5),n=z(l)}return t.createPriceLine({market:e.market,message:e.message,index:s,price:e.price,lineWidth:d.state.settings.alertsLineWidth,lineStyle:d.state.settings.alertsLineStyle,color:n,title:a.length?a:null,axisLabelVisible:r})}replaceData(e,t){t&&this.preventPan();for(let i=this.loadedIndicators.length-1;i>=0;i--)if(this.loadedIndicators[i].options.visible!==!1)for(let s=0;s<this.loadedIndicators[i].apis.length;s++){const r=this.loadedIndicators[i].apis[s].id;if(e[r])try{this.loadedIndicators[i].apis[s].setData(e[r])}catch(a){d.commit(this.paneId+"/SET_INDICATOR_ERROR",{id:this.loadedIndicators[i].id,error:a.message}),this.setIndicatorOption(this.loadedIndicators[i].id,"visible",!1)}}}updateBar(e){this.preventPan();const t=[];for(let i=0;i<this.loadedIndicators.length;i++){if(this.loadedIndicators[i].options.visible===!1)continue;const s=this.loadedIndicators[i],r=e.indicators[s.id];if(this.loadedIndicators[i].adapter(e,r.functions,r.variables,s.apis,s.options,D),r.canRender)for(let a=0;a<s.apis.length;a++){const n=e.series[s.apis[a].id];if(n&&!n.rendered){if(s.model.plots[a].type==="line"&&!n.value||s.model.plots[a].type==="histogram"&&!n.value||(s.model.plots[a].type==="cloudarea"||s.model.plots[a].type==="brokenarea")&&n.lowerValue===null||s.model.plots[a].type==="histogram"&&!n.value)continue;t.push([s.apis[a],n])}}}for(let i=0;i<t.length;i++)t[i][0].update(t[i][1]),t[i][1].rendered=!0}computeBar(e,t){const i={};e.series={};for(let s=0;s<this.loadedIndicators.length;s++){if(t&&t.indexOf(this.loadedIndicators[s].id)===-1||this.loadedIndicators[s].options.visible===!1)continue;const r=this.loadedIndicators[s],a=e.indicators[r.id];try{r.adapter(e,a.functions,a.variables,r.apis,r.options,D)}catch(n){throw console.error(`[chart/${this.paneId}/computeBar] execution failed
	->`,n),d.commit(this.paneId+"/SET_INDICATOR_ERROR",{id:r.id,error:n.message}),new Error("execution failed")}for(let n=0;n<r.apis.length;n++){const l=e.series[r.apis[n].id];e.length<a.minLength||!l||typeof l.value<"u"&&l.value===null||typeof l.lowerValue<"u"&&l.lowerValue===null||r.model.plots[n].type==="histogram"&&l.value===0||(i[r.apis[n].id]=l)}}return i}getPriceApi(){if(this._priceApi)return this._priceApi;const e=this.loadedIndicators.find(t=>t.id==="price"||t.libraryId==="price");if(e&&e.options.visible!==!1)return this._priceIndicatorId=e.id,this._priceApi=e.apis[0],this._priceApi;for(let t=0;t<this.loadedIndicators.length;t++)for(let i=0;i<this.loadedIndicators[t].apis.length;i++){const s=this.loadedIndicators[t].apis[i];if(s.options().priceScaleId==="right")return this._priceIndicatorId=this.loadedIndicators[t].id,this._priceApi=s,this._priceApi}}createRenderer(e,t){e=b(e,this.timeframe);const i={timestamp:e,localTimestamp:e+this.timezoneOffset,timeframe:this.timeframe,type:this.type,length:1,indicators:{},sources:{},series:{},bar:{vbuy:0,vsell:0,cbuy:0,csell:0,lbuy:0,lsell:0,empty:!0}};if(this.isPrepending){const s=at(this.prepend,e);for(const r in s)i.sources[r]={...s[r],active:this.marketsFilters[r]}}this.loadedIndicators=this.loadedIndicators.sort((s,r)=>{const a=s.model?s.model.references.length:0,n=r.model?r.model.references.length:0;return a-n});for(const s of this.loadedIndicators)t&&t.indexOf(s.id)===-1||s.options.visible===!1||this.bindIndicator(s,i);return i}nextBar(e,t){if(this.fillGapsWithEmpty&&t===this.activeRenderer&&this.activeRenderer.type==="time"&&this.activeRenderer.timestamp<e-this.activeRenderer.timeframe){const i=(e-this.activeRenderer.timeframe-this.activeRenderer.timestamp)/this.activeRenderer.timeframe;for(let s=0;s<i;s++){this.incrementRendererBar(t);for(let r=0;r<this.loadedIndicators.length;r++)for(let a=0;a<this.loadedIndicators[r].apis.length;a++)this.loadedIndicators[r].apis[a].update({time:t.localTimestamp})}}this.incrementRendererBar(t),Je(t),t.timestamp=e,t.localTimestamp=e+this.timezoneOffset}incrementRendererBar(e){e.length++,e.timestamp+=e.timeframe,e.localTimestamp+=e.timeframe,e.price=null;for(let t=0;t<this.loadedIndicators.length;t++){const i=e.indicators[this.loadedIndicators[t].id];if(i){i.canRender=e.length>=i.minLength;for(let s=0;s<i.functions.length;s++){const r=i.functions[s];typeof D[r.name].next=="function"&&D[r.name].next(r)}for(let s=0;s<i.variables.length;s++){const r=i.variables[s];r.length>1&&(r.state.unshift(r.state[0]),r.state.length>r.length&&r.state.pop())}}}}prepareRendererForIndicators(e,t){let i=Object.keys(e.model.markets);e.model.sources.length&&(i=Object.keys(this.marketsFilters).concat(i).filter((s,r,a)=>a.indexOf(s)===r));for(let s=0;s<i.length;s++){t.sources[i[s]]||(t.sources[i[s]]={open:null,high:null,low:null,close:null});let r=e.model.markets[i[s]]||[];if(e.model.sources.length&&(r=e.model.sources.map(a=>a.prop).concat(r).filter((a,n,l)=>l.indexOf(a)===n)),r.length)for(let a=0;a<r.length;a++)typeof t.sources[i[s]][r[a]]>"u"&&r[a]!=="open"&&r[a]!=="high"&&r[a]!=="low"&&r[a]!=="close"&&(t.sources[i[s]][r[a]]=0)}}toggleFillGapsWithEmpty(){this.fillGapsWithEmpty=!this.fillGapsWithEmpty,this.renderAll()}refreshAutoDecimals(e,t){if(e&&e.indexOf(this.mainIndex)===-1)return;const i=Me[this.mainIndex];for(let s=0;s<this.loadedIndicators.length;s++){if(t&&t!==this.loadedIndicators[s].id)continue;let r=this.loadedIndicators[s].options.priceFormat||{type:"price"};const a=typeof i=="number"?i:typeof r.precision=="number"?r.precision:2;if(!r.auto||r.type==="volume"||r.precision===a)continue;const n={precision:a,minMove:1/Math.pow(10,a)};r={...r,...n,auto:!0},d.dispatch(this.paneId+"/setIndicatorOption",{id:this.loadedIndicators[s].id,key:"priceFormat",value:r,silent:!0});const l=d.state[this.paneId].priceScales[this.loadedIndicators[s].options.priceScaleId];d.commit(this.paneId+"/SET_PRICE_SCALE",{id:this.loadedIndicators[s].options.priceScaleId,priceScale:{...l,priceFormat:n}});for(let u=0;u<this.loadedIndicators[s].apis.length;u++)this.loadedIndicators[s].apis[u].applyOptions({priceFormat:n})}}getPrice(){return this.activeRenderer?this.activeRenderer.price?this.activeRenderer.price:(this.activeRenderer.price=+D.avg_close.update({},this.activeRenderer).toFixed(8),this.activeRenderer.price):null}getChartCanvas(){return this.chartElement.querySelector("tr:first-child td:nth-child(2) canvas:nth-child(2)")}flipChart(){const e=this.getPriceApi(),i=e.priceScale().options().invertScale;e.priceScale().applyOptions({invertScale:!i})}takeScreenshot(e){if(e.shiftKey){ce(this.chartElement.querySelector("tr:first-child td:nth-child(2) canvas"));return}const t=this.chartInstance.takeScreenshot(),i=document.createElement("canvas"),s=i.getContext("2d"),r=d.state.panes.panes[this.paneId].zoom||1,a=window.devicePixelRatio||1,n=16*r*a;let l=12*r*a;t.width*t.height<4e4&&(l=6),i.width=t.width,s.font=`${l}px Spline Sans Mono`,s.textAlign="left",s.textBaseline="top";const u=[],[p,c]=new Date().toISOString().split("T"),f=p+" "+c.split(".")[0]+" UTC",v=this.watermark,m=K(d.state[this.paneId].timeframe);t.width>500?u.push([v,m,f].join(" | ")):(u.push(f),u.push([v,m].join(" | ")));const g=Math.round(l);i.height=t.height;const S=getComputedStyle(document.documentElement),O=S.getPropertyValue("--theme-base"),B=H(O),ie=z([B[0],B[1],B[2],.75]),G=S.getPropertyValue("--theme-color-base"),ve=d.state.settings.backgroundColor;e.shiftKey||(s.fillStyle=O,s.fillRect(0,0,i.width,i.height),s.fillStyle=ve,s.fillRect(0,0,i.width,i.height)),s.fillStyle=d.state.settings.theme==="light"?"rgba(255,255,255,.2)":"rgba(0,0,0,.2)",s.fillRect(0,0,i.width,i.height),s.drawImage(t,0,0),s.fillStyle=G,s.font=`${l}px Spline Sans Mono`,s.textAlign="left",s.textBaseline="top";let E=0;for(let y=0;y<u.length;y++)s.strokeStyle=ie,s.lineWidth=4*a,s.lineJoin="round",s.strokeText(u[y],n,n+E),s.fillText(u[y],n,n+E),E+=g*1.2*(y+1);E+=n*2,d.state[this.paneId].showIndicators&&Object.values(d.state[this.paneId].indicators).forEach(y=>{const N=y.options;if(N.visible===!1)return;let R=N.color||N.upColor||G;try{R=H(R),typeof R[3]<"u"&&(R[3]=1),R=z(R)}catch{}const se=y.displayName||y.name;s.fillStyle=G,s.strokeStyle=ie,s.lineWidth=4*a,s.fillStyle=R,s.lineJoin="round",s.strokeText(se,n,E),s.fillText(se,n,E),E+=g*1.2}),ce(i)}restart(){this.destroy(),this.initialize()}fetch(e){e||(this.hasReachedEnd=!1);const t=this.chartCache.cacheRange&&this.chartCache.cacheRange.from;if(!this.historicalMarkets.length)return;const i=+d.state[this.paneId].timeframe;if(!i){this.hasReachedEnd=!0;return}if(d.state.app.apiSupportedTimeframes.indexOf(i.toString())===-1)return;const s=this.getVisibleRange();let r;if(e)r=e;else{let u;t?u=this.chartCache.cacheRange.from:s&&s.from?u=s.from+d.state.settings.timezoneOffset/1e3:u=Date.now()/1e3,r={from:u-i*20,to:u}}r.from=b(Math.round(r.from),i),r.to=b(Math.round(r.to),i)+i,this.chartCache.cacheRange.from&&(r.to=Math.min(b(this.chartCache.cacheRange.from,i),r.to));const a=Math.floor((r.to-r.from)/i),n=112,l=xe(a*this.historicalMarkets.length*n);return d.dispatch("app/showNotice",{id:"fetching-"+this.paneId,timeout:15e3,title:`Fetching ${a*this.historicalMarkets.length} bars (~${l})`,type:"info"}),this.isLoading=!0,ue.fetch(r.from*1e3,r.to*1e3,i,this.historicalMarkets).then(u=>this.onHistorical(u)).catch(u=>{console.error(u),this.hasReachedEnd=!0}).then(()=>{d.dispatch("app/hideNotice","fetching-"+this.paneId),setTimeout(()=>{this.isLoading=!1,this.fetchMore(this.chartInstance.timeScale().getVisibleLogicalRange())},200)})}onHistorical(e){const t={from:e.from,to:e.to,bars:e.data};this.chartCache.saveChunk(t),this.isPrepending&&it(this.prepend,e),this.renderAll(!0)}async fetchMore(e){const t=`${e.from},${e.to}`;if(this.isLoading||this.hasReachedEnd||!e||e.from>0||this.previousLogicalRange&&this.previousLogicalRange===t)return;this.previousLogicalRange=t;let i=0;if(this.activeRenderer)for(const a in this.activeRenderer.indicators)this.activeRenderer.indicators[a].minLength&&(i=Math.max(i,this.activeRenderer.indicators[a].minLength));const s=Math.round(Math.min(Math.abs(e.from)+i,500))+1;if(!s)return;const r={from:this.chartCache.cacheRange.from-s*d.state[this.paneId].timeframe,to:this.chartCache.cacheRange.from-1};await this.fetch(r)}savePosition(e){d.commit(this.paneId+"/SET_BAR_SPACING",this.getBarSpacing(e))}getBarSpacing(e){return e?this.getChartCanvas().clientWidth/(e.to-e.from):j.timeScale.barSpacing}trimChart(){if(Date.now()>this._timeToRecycle){const e=this.getVisibleRange();let t;e&&(t=e.from-(e.to-e.from)*2),this.chartCache.trim(t)&&this.renderAll(),this.setTimeToRecycle()}this._recycleTimeout=setTimeout(this.trimChart.bind(this),1e3*60*15)}setupRecycle(){this._recycleTimeout=setTimeout(this.trimChart.bind(this),1e3*60*3),this.setTimeToRecycle()}clearRecycle(){clearTimeout(this._recycleTimeout)}setTimeToRecycle(){const e=Date.now();if(this.type==="time"){const i=this.getChartCanvas().clientWidth,s=this.getBarSpacing(this.chartInstance.timeScale().getVisibleLogicalRange());this._timeToRecycle=e+Math.min(1e3*60*60*24,this.timeframe*1e3*(i/s)/2)}this._timeToRecycle=e+9e5}async createAlertAtPrice(e,t){if(!d.state.settings.alerts){if(!await C.confirm({title:"Alerts are disabled",message:"Enable alerts ?",ok:"Yes please"}))return;d.commit("settings/TOGGLE_ALERTS",!0)}const i=this.mainIndex,s={price:e,market:i,timestamp:t,active:!1};_.createAlert(s,this.getPrice())}async refreshChartDimensions(){if(!this.chartInstance)return;let e=0;d.state.settings.autoHideHeaders||(e=1.375*(d.state.panes.panes[this.paneId].zoom||1)*16);const t=this.chartElement.parentElement;this.chartInstance.resize(t.clientWidth,t.clientHeight-e)}async saveIndicatorPreview(e){const t=oe(he(j,this.paneId),de(this.paneId,500),{timeScale:{visible:!1,barSpacing:4,rightOffset:Math.ceil(6.25)},rightPriceScale:{visible:!1},leftPriceScale:{visible:!1}}),i=document.createElement("div");i.style.width="500px",i.style.height="100px",i.style.position="fixed",i.style.visibility="hidden",document.body.appendChild(i);const s=pe(i,t),r={};for(const p of this.loadedIndicators)for(let c=0;c<p.apis.length;c++){const f=p.apis[c],{id:v}=f;r[v]={original:f};const m=f.seriesType(),g=W(p,p.model.plots[c]);r[v].copy=s[`add${m}Series`](g),r[v].copy.id=v,r[v].visible=p.id===e,p.apis[c]=r[v].copy}const{computedSeries:a}=this.computeBars(this.chartCache.chunks.length?this.chartCache.chunks.reduce((p,c)=>p.concat(c.bars),[]):[]);for(const p of this.loadedIndicators)for(let c=0;c<p.apis.length;c++){const{id:f}=p.apis[c];p.apis[c]=r[f].original}for(const p in a)r[p].copy.setData(a[p]);await te(1);for(const p in r)r[p].visible||r[p].copy.applyOptions({visible:!1});const n=s.takeScreenshot(),l=await new Promise(p=>n.toBlob(c=>p(c))),{libraryId:u}=d.state[this.paneId].indicators[e];Ae.saveIndicatorPreview(u,l);for(const p in r)s.removeSeries(r[p].copy);s.remove(),document.body.removeChild(i)}toggleTimeframeDropdown(e){return this.chartControl.toggleTimeframeDropdown(e)}getAxisSize(){const e=d.state[this.paneId],t={top:0,left:0,right:0,time:0};return e.showLeftScale&&(t.left=this.chartElement.querySelector("tr:first-child td:first-child canvas").clientWidth),e.showRightScale&&(t.right=this.chartElement.querySelector("tr:first-child td:last-child canvas").clientWidth),e.showTimeScale&&(t.time=this.chartElement.querySelector("tr:last-child td:nth-child(2) canvas").clientHeight),this.axis=t,this.axis}};var ot=Object.defineProperty,ct=Object.getOwnPropertyDescriptor,ht=(o,e,t,i)=>{for(var s=i>1?void 0:i?ct(e,t):e,r=o.length-1,a;r>=0;r--)(a=o[r])&&(s=(i?a(e,t,s):a(s))||s);return i&&s&&ot(e,t,s),s};let Q=class extends A{constructor(){super(...arguments);h(this,"paneId");h(this,"priceScaleId");h(this,"priceScale");h(this,"top",null);h(this,"bottom",null);h(this,"roundedTop",null);h(this,"roundedBottom",null);h(this,"currentMoveId",null);h(this,"currentSide",null);h(this,"currentOrigin",null);h(this,"currentContainerHeight",null);h(this,"modes",{0:"Linear",1:"Logarithimic",2:"Percent",3:"Indexed to 100"})}created(){this.getSize()}beforeDestroy(){this.release()}getSize(){this.roundedTop=this.top=this.priceScale.scaleMargins.top*100,this.roundedBottom=this.bottom=this.priceScale.scaleMargins.bottom*100}handleResize(e,t){if(this.currentMoveId){this.release();return}this.start(t,M(e).y),document.addEventListener("mousemove",this.resize),document.addEventListener("mouseup",this.release),document.addEventListener("touchmove",this.resize),document.addEventListener("touchend",this.release)}resize(e){const t=this.getPercentMove(e);t&&(this[this.currentSide]+=t*(this.currentSide==="top"?1:-1),this.updateScaleMargins(e))}handleMove(e){if(this.currentMoveId){this.release();return}this.start("both",M(e).y),document.addEventListener("mousemove",this.move),document.addEventListener("mouseup",this.release),document.addEventListener("touchmove",this.move),document.addEventListener("touchend",this.release)}move(e){const t=this.getPercentMove(e);t&&(this.top+=t,this.bottom-=t,this.updateScaleMargins(e))}release(){this.currentSide&&(this.currentSide!=="both"?(document.removeEventListener("mousemove",this.resize),document.removeEventListener("touchmove",this.resize)):(document.removeEventListener("mousemove",this.move),document.removeEventListener("touchmove",this.move)),document.removeEventListener("mouseup",this.release),document.removeEventListener("touchend",this.release),this.currentMoveId=null,this.currentSide=null,this.top=this.roundedTop,this.bottom=this.roundedBottom)}updateScaleMargins(e){const t=Math.round(this.top),i=Math.round(this.bottom);this.roundedTop=Math.max(0,Math.min(100-i,t)),this.roundedBottom=Math.max(0,Math.min(i,100-t));const s={top:this.roundedTop/100,bottom:this.roundedBottom/100};this.priceScale.scaleMargins.top===s.top&&this.priceScale.scaleMargins.bottom===s.bottom||this.$emit("update",{id:this.currentMoveId,side:this.currentSide,value:s,syncable:e.type!=="touchmove"&&!e.shiftKey})}updateMode(e){this.priceScale.mode=+e,this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:this.priceScaleId,priceScale:this.priceScale})}getContainerHeight(){return parseFloat(this.$el.parentElement.clientHeight)}getPercentMove(e){const t=M(e),i=(t.y-this.currentOrigin)/this.currentContainerHeight*100;return i?(this.currentOrigin=t.y,i):null}start(e,t){this.currentMoveId=$e(8),this.currentSide=e,this.currentOrigin=t,this.currentContainerHeight=this.getContainerHeight()}};Q=ht([L({name:"ChartPriceScale",components:{DropdownButton:Le},props:{paneId:{required:!0},priceScaleId:{required:!0},priceScale:{required:!0}},watch:{"priceScale.scaleMargins.top":function(){this.currentMoveId||this.getSize()},"priceScale.scaleMargins.bottom":function(){this.currentMoveId||this.getSize()}}})],Q);var lt=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{directives:[{name:"tippy",rawName:"v-tippy",value:{followCursor:!0},expression:"{ followCursor: true }"}],staticClass:"chart-pricescale",class:{"-active":!!e.currentSide},style:{top:e.roundedTop+"%",bottom:e.roundedBottom+"%"},attrs:{title:`<code>${e.priceScale.scaleMargins.top}</code><br><code>${e.priceScale.scaleMargins.bottom}</code>`}},[t("div",{staticClass:"chart-pricescale__content"},[t("div",{staticClass:"chart-pricescale__title pane-overlay",on:{mousedown:e.handleMove,touchstart:e.handleMove}},[t("i",{staticClass:"icon-move mr8"}),t("code",[e._v(e._s(e.priceScale.indicators.join(", ")))]),e.priceScaleId==="left"||e.priceScaleId==="right"?t("code",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"ml4",attrs:{title:`using ${e.priceScaleId} scale`}},[e._v(" "+e._s(e.priceScaleId==="left"?"← LEFT":"→ RIGHT")+" ")]):e._e(),t("dropdown-button",{staticClass:"chart-pricescale__mode -small ml8 text-bold",attrs:{options:e.modes,placeholder:"linear","button-class":"badge -outline"},on:{input:function(i){return e.updateMode(i)}},model:{value:e.priceScale.mode,callback:function(i){e.$set(e.priceScale,"mode",i)},expression:"priceScale.mode"}})],1),t("div",{staticClass:"chart-pricescale__size pane-overlay",domProps:{textContent:e._s(100-e.roundedTop-e.roundedBottom+"%")}})]),t("div",{staticClass:"chart-pricescale__boundary -top",class:{"-active":e.currentSide==="top"},on:{mousedown:function(i){return e.handleResize(i,"top")},touchstart:function(i){return e.handleResize(i,"top")}}}),t("div",{staticClass:"chart-pricescale__boundary -bottom",class:{"-active":e.currentSide==="bottom"},on:{mousedown:function(i){return e.handleResize(i,"bottom")},touchstart:function(i){return e.handleResize(i,"bottom")}}})])},dt=[],pt=$(Q,lt,dt,!1,null,null,null,null);const ut=pt.exports;var mt=Object.defineProperty,ft=Object.getOwnPropertyDescriptor,gt=(o,e,t,i)=>{for(var s=i>1?void 0:i?ft(e,t):e,r=o.length-1,a;r>=0;r--)(a=o[r])&&(s=(i?a(e,t,s):a(s))||s);return i&&s&&mt(e,t,s),s};let U=class extends A{constructor(){super(...arguments);h(this,"paneId");h(this,"layouting");h(this,"unsyncableMoveId");h(this,"axis");h(this,"activePriceScales");h(this,"_originalActivePriceScales");h(this,"_handleEscKey")}created(){this.getActivePriceScales()}mounted(){document.body.classList.add("-unselectable"),this.bindEscKey()}beforeDestroy(){document.body.classList.remove("-unselectable"),this._handleEscKey&&document.removeEventListener("keydown",this._handleEscKey)}getActivePriceScales(){const e=this.$store.state[this.paneId].indicators;this.activePriceScales=Object.keys(e).reduce((t,i)=>{if(typeof this.layouting=="string"&&i!==this.layouting)return t;const s=e[i].options.priceScaleId;return t[s]||(t[s]=this.$store.state[this.paneId].priceScales[s],t[s].indicators=[]),t[s].indicators.push(e[i].name),t},{}),this._originalActivePriceScales=JSON.parse(JSON.stringify(this.activePriceScales))}updatePriceScaleScaleMargins(e,t){t.syncable&&this.unsyncableMoveId!==t.id&&(this.syncMoveWithOthers(e,t.side,t.value)||(this.unsyncableMoveId=t.id)),this.activePriceScales[e].scaleMargins=t.value,this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:e,priceScale:this.activePriceScales[e]})}syncMoveWithOthers(e,t,i){const s=this.activePriceScales[e].scaleMargins;let r=!1;for(const a in this.activePriceScales){if(e===a)continue;const n=this.activePriceScales[a].scaleMargins;n.top===s.top&&n.bottom===s.bottom&&(A.set(this.activePriceScales[a],"scaleMargins",i),this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:a,priceScale:this.activePriceScales[a]}),r=!0)}return r}cancel(){for(const e in this._originalActivePriceScales)this.$store.commit(this.paneId+"/SET_PRICE_SCALE",{id:e,priceScale:this._originalActivePriceScales[e]});this.$store.commit(this.paneId+"/TOGGLE_LAYOUTING")}close(){this.$store.commit(this.paneId+"/TOGGLE_LAYOUTING")}bindEscKey(){this._handleEscKey||(this._handleEscKey=e=>{e.key==="Escape"&&this.close()},document.addEventListener("keydown",this._handleEscKey))}};U=gt([L({components:{ChartPriceScale:ut},name:"ChartLayout",props:{paneId:{required:!0},axis:{required:!0},layouting:{required:!0}}})],U);var vt=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"chart-layout",style:{left:e.axis.left+"px",right:e.axis.right+"px",bottom:e.axis.time+"px"},on:{dblclick:e.close}},[t("div",{staticClass:"chart-layout__controls"},[t("button",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"bottom",boundary:"window"},expression:"{ placement: 'bottom', boundary: 'window' }"}],staticClass:"btn -text",attrs:{title:"Revert back to original positions"},on:{click:e.cancel}},[t("i",{staticClass:"icon-eraser"})]),t("button",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"bottom",boundary:"window"},expression:"{ placement: 'bottom', boundary: 'window' }"}],staticClass:"btn -text",attrs:{title:"Save positions"},on:{click:e.close}},[t("i",{staticClass:"icon-check"})])]),e._l(e.activePriceScales,function(i,s){return t("chart-price-scale",{key:s,staticClass:"chart-layout__item",attrs:{paneId:e.paneId,priceScaleId:s,priceScale:i},on:{update:function(r){return e.updatePriceScaleScaleMargins(s,r)}}})})],2)},It=[],yt=$(U,vt,It,!1,null,null,null,null);const bt=yt.exports;var _t=Object.defineProperty,Ct=Object.getOwnPropertyDescriptor,St=(o,e,t,i)=>{for(var s=i>1?void 0:i?Ct(e,t):e,r=o.length-1,a;r>=0;r--)(a=o[r])&&(s=(i?a(e,t,s):a(s))||s);return i&&s&&_t(e,t,s),s};let Y=class extends A{constructor(){super(...arguments);h(this,"paneId");h(this,"indicatorId")}get indicator(){return this.$store.state[this.paneId].indicators[this.indicatorId]}get showLegend(){return this.$store.state[this.paneId].showLegend}get name(){return this.indicator.displayName?this.indicator.displayName:this.indicator.name?this.indicator.name:this.indicatorId}get visible(){return!this.indicator.options||typeof this.indicator.options.visible>"u"?!0:this.indicator.options.visible}get error(){return this.$store.state[this.paneId].indicatorsErrors[this.indicatorId]}onClick(t){if(t.shiftKey){this.$emit("action",{actionName:"resize",indicatorId:this.indicatorId});return}this.$emit("action",{indicatorId:this.indicatorId})}toggleVisibility(){this.$nextTick(()=>{this.$store.dispatch(this.paneId+"/toggleSerieVisibility",this.indicatorId)})}};Y=St([L({name:"IndicatorControl",props:{paneId:{required:!0},indicatorId:{required:!0}}})],Y);var Et=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"indicator",class:{"-error":!!e.error,"-disabled":!e.visible}},[t("button",{staticClass:"indicator__name pane-overlay",attrs:{type:"button"},on:{click:e.onClick}},[e._v(" "+e._s(e.name)+" ")]),t("div",{staticClass:"indicator__controls"},[t("button",{staticClass:"btn",attrs:{title:e.visible?"Hide":"Show"},on:{click:e.toggleVisibility}},[t("i",{class:{"icon-visible":!e.visible,"icon-hidden":e.visible}})]),t("button",{staticClass:"btn",attrs:{title:"Menu"},on:{click:function(i){return e.$emit("action",{indicatorId:e.indicatorId,actionName:"remove",event:i})}}},[t("i",{staticClass:"icon-cross"})]),t("button",{staticClass:"btn",attrs:{title:"Menu"},on:{click:function(i){return e.$emit("action",{indicatorId:e.indicatorId,actionName:"menu",event:i})}}},[t("i",{staticClass:"icon-more"})])]),t("div",{staticClass:"indicator__legend pane-overlay",attrs:{id:e.paneId+e.indicator.id}}),e.error?t("div",[t("i",{staticClass:"icon-warning ml4 mr8"}),e._v(" "+e._s(e.error)+" ")]):e._e()])},Rt=[],kt=$(Y,Et,Rt,!1,null,"bdedeea6",null,null);const Tt=kt.exports;var Ot=Object.defineProperty,wt=Object.getOwnPropertyDescriptor,Pt=(o,e,t,i)=>{for(var s=i>1?void 0:i?wt(e,t):e,r=o.length-1,a;r>=0;r--)(a=o[r])&&(s=(i?a(e,t,s):a(s))||s);return i&&s&&Ot(e,t,s),s};let X=class extends A{constructor(){super(...arguments);h(this,"paneId");h(this,"value");h(this,"dropdownTrigger",null);h(this,"selectedIndicator",null);h(this,"selectedIndicatorIsFront",null);h(this,"sorting");h(this,"$refs")}get indicators(){return this.$store.state[this.paneId].indicators}get indicatorOrder(){return this.$store.state[this.paneId].indicatorOrder}get label(){const t=Object.values(this.indicators).length;return`${t} indicator${t>1?"s":""}`}toggleOverlay(){this.$emit("input",!this.value)}toggleDropdown(t,i){if(t&&(!this.dropdownTrigger||!this.selectedIndicator||this.selectedIndicator!==i)){const s=t.currentTarget;this.dropdownTrigger=s,this.selectedIndicator=i,this.selectedIndicatorIsFront=this.indicatorOrder.indexOf(i)===this.indicatorOrder.length-1}else this.dropdownTrigger=null,this.selectedIndicator=null}async editIndicator(t){C.open((await x(()=>import("./IndicatorDialog.5c4cb14.js"),["IndicatorDialog.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","Tab.5c4cb14.js","Tab.5c4cb14.css","options.5c4cb14.js","IndicatorDialog.5c4cb14.css"])).default,{paneId:this.paneId,indicatorId:t},"indicator"),this.dropdownTrigger=null}removeIndicator(t){this.$store.dispatch(this.paneId+"/removeIndicator",{id:t})}resizeIndicator(t){this.$store.commit(this.paneId+"/TOGGLE_LAYOUTING",t)}duplicateIndicator(t){this.$store.dispatch(this.paneId+"/duplicateIndicator",t)}downloadIndicator(t){this.$store.dispatch(this.paneId+"/downloadIndicator",t)}async addIndicator(){C.open((await x(()=>import("./IndicatorLibraryDialog.5c4cb14.js").then(t=>t.I),["IndicatorLibraryDialog.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","Tab.5c4cb14.js","Tab.5c4cb14.css","IndicatorLibraryDialog.5c4cb14.css"])).default,{},"indicator-library")}onClickIndicator({indicatorId:t,actionName:i,event:s}){if(!(this.sorting&&this.sorting.moved)){switch(i){case"menu":return this.toggleDropdown(s,t);case"remove":return this.removeIndicator(t);case"resize":return this.resizeIndicator(t)}return this.editIndicator(t)}}bindSort(t,i){if(this.sorting)return;const s=Object.keys(this.indicators);let r=this.indicatorOrder.indexOf(t);r===-1&&(r=s.indexOf(t));const a=i.currentTarget,n=i.clientY;this.sorting={id:t,height:a.clientHeight,startY:n,maxPosition:s.length-1,oldPosition:r,newPosition:r},document.addEventListener("mousemove",this.handleSort),document.addEventListener("mouseup",this.unbindSort)}handleSort(t){if(!this.sorting)return;const i=t.clientY-this.sorting.startY;this.sorting.moved||(this.sorting.moved=Math.abs(i)>3);const s=Math.max(0,Math.min(this.sorting.maxPosition,this.sorting.oldPosition+Math.round(i/this.sorting.height)));s!==this.sorting.newPosition&&(this.sorting.newPosition=s,this.setIndicatorOrder(this.sorting.id,this.sorting.newPosition))}setIndicatorOrder(t,i){this.$store.commit(`${this.paneId}/UPDATE_INDICATOR_ORDER`,{id:t,position:i})}async unbindSort(){this.sorting&&(document.removeEventListener("mousemove",this.handleSort),document.removeEventListener("mouseup",this.unbindSort),await this.$nextTick(),setTimeout(()=>{this.sorting=null}))}};X=Pt([L({name:"IndicatorsOverlay",components:{IndicatorControl:Tt},props:{paneId:{type:String},value:{type:Boolean,required:!0}}})],X);var Mt=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"chart-overlay__panel indicators-overlay"},[e.value?t("div",{staticClass:"chart-overlay__content"},[t("dropdown",{model:{value:e.dropdownTrigger,callback:function(i){e.dropdownTrigger=i},expression:"dropdownTrigger"}},[t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(i){return e.editIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-edit"}),t("span",[e._v("Edit")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(i){return e.resizeIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-resize-height"}),t("span",[e._v("Resize")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(i){return e.duplicateIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-copy-paste"}),t("span",[e._v("Duplicate")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(i){return e.downloadIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-download"}),t("span",[e._v("Download")])]),e.selectedIndicatorIsFront?t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(i){return e.setIndicatorOrder(e.selectedIndicator,0)}}},[t("i",{staticClass:"icon-up"}),t("span",[e._v("Send to back")])]):t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(i){return e.setIndicatorOrder(e.selectedIndicator,e.indicatorOrder.length-1)}}},[t("i",{staticClass:"icon-down -lower"}),t("span",[e._v("Bring to front")])]),t("div",{staticClass:"dropdown-divider"}),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(i){return e.removeIndicator(e.selectedIndicator)}}},[t("i",{staticClass:"icon-trash"}),t("span",[e._v("Remove")])])]),e._l(e.indicatorOrder,function(i){return t("IndicatorControl",{key:i,attrs:{"indicator-id":i,"pane-id":e.paneId},on:{action:e.onClickIndicator},nativeOn:{mousedown:function(s){return e.bindSort(i,s)}}})})],2):e._e(),t("div",{staticClass:"chart-overlay__head pane-overlay",on:{click:e.toggleOverlay}},[t("span",{staticClass:"chart-overlay__title"},[e._v(" "+e._s(e.label)+" ")]),t("button",{staticClass:"btn badge -text",attrs:{type:"button"},on:{click:function(i){return i.stopPropagation(),e.addIndicator.apply(null,arguments)}}},[t("i",{staticClass:"icon-plus"})])])])},xt=[],At=$(X,Mt,xt,!1,null,null,null,null);const Lt=At.exports;var $t=Object.defineProperty,Dt=Object.getOwnPropertyDescriptor,Ht=(o,e,t,i)=>{for(var s=i>1?void 0:i?Dt(e,t):e,r=o.length-1,a;r>=0;r--)(a=o[r])&&(s=(i?a(e,t,s):a(s))||s);return i&&s&&$t(e,t,s),s};let J=class extends A{constructor(){super(...arguments);h(this,"paneId");h(this,"showOverlay",!1)}get markets(){return this.$store.state.panes.panes[this.paneId].markets}get hiddenMarkets(){return this.$store.state[this.paneId].hiddenMarkets}get visibleMarkets(){return this.markets.filter(t=>!this.hiddenMarkets[t]).length}get label(){const t=this.visibleMarkets;return`${t} market${t>1?"s":""}`}searchMarkets(t){this.$store.dispatch("app/showSearch",{paneId:this.paneId}),t.stopPropagation()}toggleMarket(t,i){this.$store.dispatch(this.paneId+"/toggleMarkets",{id:i,inverse:t.shiftKey})}toggleMarkets(t){this.$store.dispatch(this.paneId+"/toggleMarkets",{type:t})}};J=Ht([L({name:"MarketsOverlay",props:{paneId:{type:String}}})],J);var zt=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"chart-overlay__panel markets-overlay"},[e.showOverlay?t("div",{staticClass:"chart-overlay__content pane-overlay"},[t("div",{staticClass:"column"},[t("a",{staticClass:"btn -text",attrs:{href:"javascript:void(0)"},on:{click:function(i){return e.toggleMarkets("perp")}}},[e._v("perp")]),t("a",{staticClass:"btn -text",attrs:{href:"javascript:void(0)"},on:{click:function(i){return e.toggleMarkets("spot")}}},[e._v("spot")]),t("a",{staticClass:"btn -text",attrs:{href:"javascript:void(0)"},on:{click:function(i){return e.toggleMarkets("all")}}},[e._v("all")])]),t("div",{staticClass:"mx4 mt0"},e._l(e.markets,function(i){return t("div",{key:i,on:{click:function(s){return e.toggleMarket(s,i)}}},[t("label",{staticClass:"checkbox-control -extra-small mb4"},[t("input",{staticClass:"form-control",attrs:{type:"checkbox"},domProps:{checked:!e.hiddenMarkets[i]},on:{click:function(s){s.stopPropagation(),s.preventDefault()}}}),t("div"),t("span",[e._v(e._s(i))])])])}),0)]):e._e(),t("div",{staticClass:"chart-overlay__head pane-overlay",on:{click:function(i){e.showOverlay=!e.showOverlay}}},[t("div",{staticClass:"chart-overlay__title"},[e._v(" "+e._s(e.label)+" ")]),t("button",{staticClass:"btn badge -text",attrs:{type:"button"},on:{click:e.searchMarkets}},[t("i",{staticClass:"icon-plus"})])])])},Ft=[],Bt=$(J,zt,Ft,!1,null,null,null,null);const Gt=Bt.exports;var Nt=Object.defineProperty,jt=Object.getOwnPropertyDescriptor,Wt=(o,e,t,i)=>{for(var s=i>1?void 0:i?jt(e,t):e,r=o.length-1,a;r>=0;r--)(a=o[r])&&(s=(i?a(e,t,s):a(s))||s);return i&&s&&Nt(e,t,s),s};let Z=class extends De(je){constructor(){super(...arguments);h(this,"axis",{top:0,left:0,right:0,time:0});h(this,"chart");h(this,"$refs")}get layouting(){return this.refreshAxisSize(),this.$store.state[this.paneId].layouting}get overlayLeft(){return this.axis.left}get overlayTop(){return this.axis.top}get favoriteTimeframes(){return this.$store.state.settings.favoriteTimeframes}get timeframe(){return this.$store.state[this.paneId].timeframe}get isKnownTimeframe(){return Object.keys(this.favoriteTimeframes).indexOf(this.timeframe)!==-1}get showIndicators(){return this.$store.state[this.paneId].showIndicators}set showIndicators(e){this.$store.commit(`${this.paneId}/TOGGLE_INDICATORS`,e)}get timeframeForHuman(){return this.timeframe?K(this.timeframe):"ERR"}mounted(){this.chart=new nt(this.paneId,this.$refs.chartContainer),this.bindAggregator(),this.showIndicators&&this.$parent.$el.clientHeight>420&&(this.showIndicators=!0)}destroyChart(){this.unbindAggregator(),this.chart.destroy()}beforeDestroy(){this.destroyChart()}onTrades(e){this.chart.queueTrades(e)}onAlert(e){this.chart.onAlert(e)}bindAggregator(){T.on("trades",this.onTrades),T.on("alert",this.onAlert)}unbindAggregator(){T.off("trades",this.onTrades),T.off("alert",this.onAlert)}renderChart(){this.chart.renderAll()}onResize(){this.chart&&(this.chart.refreshChartDimensions(),this.chart.updateFontSize(),this.refreshAxisSize())}async refreshAxisSize(){this.$refs.chartContainer&&(await te(100),this.axis=this.chart.getAxisSize())}toggleLayout(){this.$store.commit(this.paneId+"/TOGGLE_LAYOUTING")}async toggleTimeframeDropdown(e,t){t.isLoading=!0,await this.chart.toggleTimeframeDropdown(e),t.isLoading=!1}restart(){this.chart.restart()}takeScreenshot(e){this.chart.takeScreenshot(e)}selectTimeframe(e,t){if(t===this.timeframe){this.toggleTimeframeDropdown(e,this.$refs.timeframeButton);return}this.$store.dispatch(`${this.paneId}/setTimeframe`,t)}};Z=Wt([L({name:"Chart",components:{ChartLayout:bt,PaneHeader:We,IndicatorsOverlay:Lt,MarketsOverlay:Gt,AlertsList:qe,Btn:He}})],Z);var qt=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"pane-chart"},[t("pane-header",{ref:"paneHeader",attrs:{paneId:e.paneId,settings:()=>x(()=>import("./ChartDialog.5c4cb14.js"),["ChartDialog.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","paneDialogMixin.5c4cb14.js","ToggableGroup.5c4cb14.js","ToggableGroup.5c4cb14.css","AlertsSettings.5c4cb14.js"])},scopedSlots:e._u([{key:"menu",fn:function(){return[t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.toggleLayout}},[t("i",{staticClass:"icon-resize-height"}),t("span",[e._v("Arrange")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.restart}},[t("i",{staticClass:"icon-refresh"}),t("span",[e._v("Restart")])]),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:e.takeScreenshot}},[t("i",{staticClass:"icon-add-photo"}),t("span",[e._v("Snapshot")])])]},proxy:!0}])},[e._l(e.favoriteTimeframes,function(i,s){return t("button",{key:s,staticClass:"btn pane-chart__timeframe -text -cases",class:[e.timeframeForHuman===i&&"pane-header__highlight"],attrs:{title:"Maintain shift key to change timeframe on all panes"},on:{click:function(r){return e.selectTimeframe(r,s)}}},[t("span",[e._v(e._s(i))])])}),t("Btn",{ref:"timeframeButton",staticClass:"-arrow -cases pane-header__highlight pane-chart__timeframe-selector",on:{click:function(i){return e.toggleTimeframeDropdown(i,e.$refs.timeframeButton)}}},[e._v(" "+e._s(e.isKnownTimeframe?"":e.timeframeForHuman)+" ")]),t("hr")],2),t("div",{staticClass:"chart-overlay hide-scrollbar",style:{left:e.overlayLeft+"px"}},[t("indicators-overlay",{attrs:{"pane-id":e.paneId},model:{value:e.showIndicators,callback:function(i){e.showIndicators=i},expression:"showIndicators"}}),t("markets-overlay",{attrs:{"pane-id":e.paneId}})],1),t("div",{ref:"chartContainer",staticClass:"chart__container"},[e.layouting?t("chart-layout",{attrs:{"pane-id":e.paneId,layouting:e.layouting,axis:e.axis}}):e._e()],1)],1)},Vt=[],Kt=$(Z,qt,Vt,!1,null,"58dfa503",null,null);const ri=Kt.exports;export{ri as default};
