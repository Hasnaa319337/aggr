var S=Object.defineProperty;var C=(d,e,t)=>e in d?S(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var n=(d,e,t)=>(C(d,typeof e!="symbol"?e+"":e,t),t);import{w as g,F as w,I as h,C as x,V as M,a0 as y,Y as _,n as $,a6 as T,ac as G,Q as P,m as q,l as I,q as L,ab as O,j as b,p as D,S as R,_ as H}from"./index.5c4cb14.js";import{P as U,a as F}from"./PaneHeader.5c4cb14.js";class N{constructor(){n(this,"cache",{});n(this,"promisesOfGifs",{});setTimeout(this.cleanExpiredGifs.bind(this),6e4+Math.random()*6e4)}async cleanExpiredGifs(){const e=await g.getGifsKeywords(),t=Date.now();for(const s of e){if(this.cache[s])continue;const a=w(s),i=await g.getGifs(a);(!i||t-i.timestamp>=1e3*60*60*24*7)&&this.deleteGifs(s)}}forgetGifs(e){this.cache[e]&&(h.dispatch("app/showNotice",{title:"Forgeting "+this.cache[e].length+' gifs about "'+e+'"',type:"info"}),delete this.cache[e])}async deleteGifs(e){const t=w(e);await g.deleteGifs(t),h.dispatch("app/showNotice",{title:'Removed gifs about "'+e+'"',type:"info"})}async getGifs(e,t){if(!e)return;if(this.cache[e])return this.cache[e];if(this.promisesOfGifs[e])return this.promisesOfGifs[e];const s=w(e);return this.promisesOfGifs[e]=g.getGifs(s).then(a=>(delete this.promisesOfGifs[e],a&&Date.now()-a.timestamp<1e3*60*60*24*7?(this.cache[e]=a.data,a.data):this.fetchGifByKeyword(e,t))),this.promisesOfGifs[e]}async fetchGifByKeyword(e,t){if(!e)return;const s=w(e);return fetch("https://api.giphy.com/v1/gifs/search?q="+e+"&rating=r&limit=100&api_key=b5Y5CZcpj9spa0xEfskQxGGnhChYt3hi").then(a=>a.json()).then(async a=>{if(!(!a.data||!a.data.length)){this.cache[e]=[];for(const i of a.data)this.cache[e].push(i.images.downsized.url);return t&&h.dispatch("app/showNotice",{title:"Fetched "+this.cache[e].length+" "+e+" gifs",type:"success"}),await g.saveGifs({slug:s,keyword:e,timestamp:Date.now(),data:this.cache[e]}),this.cache[e]}}).finally(()=>{delete this.promisesOfGifs[e]})}}const p=new N;var k=Object.defineProperty,j=Object.getOwnPropertyDescriptor,V=(d,e,t,s)=>{for(var a=s>1?void 0:s?j(e,t):e,i=d.length-1,o;i>=0;i--)(o=d[i])&&(a=(s?o(e,t,a):o(a))||a);return s&&a&&k(e,t,a),a};let A=class extends M{constructor(){super(...arguments);n(this,"paneId");n(this,"showMore",!1)}get exchangesReady(){return this.$store.state.app.isExchangesReady}get paneMarkets(){return this.$store.state.panes.panes[this.paneId].markets}get paneMarketStringified(){return this.paneMarkets.join(`
`)}get pairs(){const t=this.$store.state.settings.searchTypes.mergeUsdt;return this.paneMarkets.reduce((s,a)=>{const i=this.$store.state.panes.marketsListeners[a];let o=i?i.local:a;return t&&(o=y(o)),s.indexOf(o)===-1&&s.push(o),s},[])}get tradesThresholds(){return this.$store.state[this.paneId].thresholds}get liquidationsThresholds(){return this.$store.state[this.paneId].liquidations}get showTrades(){return this.$store.state[this.paneId].showTrades}get showLiquidations(){return this.$store.state[this.paneId].showLiquidations}get filterRecap(){const t=this.tradesThresholds[0].amount,s=this.liquidationsThresholds[0].amount;return this.showTrades&&this.showLiquidations?`Waiting for trades or liquidations > ${_(t)} / ${_(s)}`:this.showTrades?`Waiting for trades > ${_(t)}`:`Waiting for liquidations > ${_(s)}`}toggleShowMore(){this.showMore=!this.showMore;const t=document.activeElement;t&&t.blur()}};A=V([x({name:"TradesPlaceholder",props:{paneId:{type:String,required:!0}}})],A);var z=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"trades-placeholder hide-scrollbar"},[t("p",{staticClass:"trades-placeholder__dimmed"},[e._v(e._s(e.filterRecap))]),e.exchangesReady?[e.showMore?t("pre",{domProps:{textContent:e._s(e.paneMarketStringified)}}):t("div",{staticClass:"pl16 pr16"},e._l(e.pairs,function(s,a){return t("button",{key:a,staticClass:"btn mx4 -small",attrs:{disabled:""}},[e._v(" "+e._s(s)+" ")])}),0),t("button",{staticClass:"mt8 btn -text trades-placeholder__dimmed -small",on:{click:e.toggleShowMore}},[e._v(" "+e._s(e.showMore?"Show less":"Show more")+" ")])]:t("p",[e._v("...")])],2)},W=[],Q=$(A,z,W,!1,null,null,null,null);const X=Q.exports;class Y{constructor(e,t,s){n(this,"paneId");n(this,"containerElement");n(this,"count");n(this,"maxCount");n(this,"maxLevel");n(this,"showGifs");n(this,"showTrades");n(this,"showLiquidations");n(this,"showLogos");n(this,"showPairs");n(this,"showPrices");n(this,"showTimeAgo");n(this,"slippageMode");n(this,"paneMarkets");n(this,"tradesAudios");n(this,"tradesColors");n(this,"minimumTradeAmount");n(this,"significantTradeAmount");n(this,"maximumTradeAmount");n(this,"liquidationsAudios");n(this,"liquidationsColors");n(this,"minimumLiquidationAmount");n(this,"significantLiquidationAmount");n(this,"maximumLiquidationAmount");n(this,"audioThreshold");n(this,"lastSide");n(this,"lastTimestamp");n(this,"timeUpdateInterval");n(this,"marketsMultipliers");this.paneId=e,this.containerElement=t,this.count=0,this.maxCount=s,this.cachePreferences(),this.cachePaneMarkets(),this.loadGifs(),this.prepareColors(),this.cacheAudio()}processTrades(e){let t="";for(let s=0;s<e.length;s++){const a=e[s].exchange+":"+e[s].pair;if(!this.paneMarkets[a])continue;const i=e[s];typeof this.marketsMultipliers[a]<"u"&&(i.amount/=this.marketsMultipliers[a]),!i.liquidation&&this.showTrades?i.amount>=this.minimumTradeAmount&&i.amount<this.maximumTradeAmount?t+=this.showTrade(i,a,this.tradesColors,this.tradesAudios,this.significantTradeAmount):i.amount>this.audioThreshold&&i.amount<this.maximumTradeAmount&&this.tradesAudios[0][i.side](T,i.amount/this.significantTradeAmount):i.liquidation&&this.showLiquidations&&(i.amount>=this.minimumLiquidationAmount&&i.amount<this.maximumLiquidationAmount?t+=this.showTrade(i,a,this.liquidationsColors,this.liquidationsAudios,this.significantLiquidationAmount):i.amount>this.audioThreshold&&i.amount<this.maximumLiquidationAmount&&this.liquidationsAudios[0][i.side](T,i.amount/this.significantLiquidationAmount))}return t.length?(this.containerElement.insertAdjacentHTML("afterbegin",t),this.trim(),!0):!1}processTradesSilent(e){const t=this.audioThreshold,s=this.showGifs;this.audioThreshold=1/0,this.showGifs=!1,this.processTrades(e),this.audioThreshold=t,this.showGifs=s}getTradeInlineStyles(e,t,s){const a=(Math.max(e.amount,t.from)-t.from)/t.range,i=Math.min(1,e.amount/s),o=t[e.side];let r="";if(this.showGifs&&t[e.side].gif){const m=t[e.side].gif;p.cache[m]&&(r=`background-image:url('${p.cache[m][Math.floor(Math.random()*(p.cache[m].length-1))]}')`)}const u=o[(a<.5?"from":"to")+"Luminance"],l=G(o.from,o.to,a);let c;return u>(r?.15:.33)?c="rgba(0, 0, 0, "+Math.min(1,.33+i)+")":c="rgba(255, 255, 255, "+Math.min(1,.33+i)+")",`background-color:rgb(${l[0]}, ${l[1]}, ${l[2]});color:${c};${r}`}showTrade(e,t,s,a,i){let o=this.maxLevel,r=s[o];for(o=0;o<s.length;o++)if(e.amount<s[o].to){r=s[o];break}return o<s.length&&e.amount>this.audioThreshold&&a[o][e.side](T,e.amount/i),this.count++,this.renderRow(e,t,r,i)}renderRow(e,t,s,a){let i="",o="";if(e.timestamp!==this.lastTimestamp&&(i=" -timestamp",this.lastTimestamp=e.timestamp,!this.showTimeAgo)){const v=new Date(+e.timestamp),f=v.getMinutes();o=`${v.getHours()}:${f<10?"0":""}${f}`,i+=" -fixed"}let r="";this.slippageMode&&e.slippage&&(r=`<small>${e.slippage>0?"+":""}${e.slippage}${this.slippageMode==="bps"?" bps":""}</small>`);let u="";this.showLogos||(u=e.exchange.replace("_"," "));let l="";const c=e.side;(e.liquidation||c!==this.lastSide)&&(l=" icon-side",this.lastSide=c);let m="";return this.showPairs&&(m=`<div class="trade__pair">${e.pair.replace("_"," ")}</div>`),`<li class="trade -${e.exchange} -${e.side} -level-${s.level}${e.liquidation?" -liquidation":""}" title="${e.exchange}:${e.pair}" style="${this.getTradeInlineStyles(e,s,a)}">
    <div class="trade__side${l}"></div>
    <div class="trade__exchange">${u}</div>
    ${m}
    ${this.showPrices?`<div class="trade__price">${P(e.price,t)}${r}</div>`:""}
    <div class="trade__amount">
    <span class="trade__amount__quote">
        â€‰
        <span class="icon-quote"></span>
        <span>${_(e.size*e.price)}</span>
        â€‰
      </span>
      <span class="trade__amount__base">
        <span class="icon-base"></span>
        <span>${Math.round(e.size*1e6)/1e6}</span>
      </span>
    </div>
    <div class="trade__time ${i}" data-timestamp="${e.timestamp.toString()}">${o}</div>
    </li>`}getTradesThesholds(){return h.state[this.paneId].thresholds}getLiquidationsThresholds(){return h.state[this.paneId].liquidations}async loadGifs(){this.loadThresholdsGifs(this.getTradesThesholds()),this.loadThresholdsGifs(this.getLiquidationsThresholds())}async loadThresholdsGifs(e){for(const t of e)t.buyGif&&p.getGifs(t.buyGif),t.sellGif&&p.getGifs(t.sellGif)}prepareColors(){const e=this.getTradesThesholds(),t=this.getLiquidationsThresholds(),s=q();this.tradesColors=this.prepareColorsThresholds(e,s),this.liquidationsColors=this.prepareColorsThresholds(t,s),this.maxLevel=e.length-1,this.minimumTradeAmount=e[0].amount,this.significantTradeAmount=e[1].amount,e[e.length-1].max?this.maximumTradeAmount=e[e.length-1].amount:this.maximumTradeAmount=1/0,this.minimumLiquidationAmount=t[0].amount,this.significantLiquidationAmount=t[1].amount,t[t.length-1].max?this.maximumLiquidationAmount=t[t.length-1].amount:this.maximumLiquidationAmount=1/0}prepareColorsThresholds(e,t){const s=[],a=e.length;for(let i=0;i<a;i++){if(i===a-1){s.push({...s[s.length-1],max:1/0});break}const o=I(e[i].buyColor,t),r=I(e[i+1].buyColor,t),u=I(e[i].sellColor,t),l=I(e[i+1].sellColor,t);s.push({from:e[i].amount,to:e[i+1].amount,range:e[i+1].amount-e[i].amount,level:Math.floor(i/(a-1)*4),max:i===a-1&&e[i+1].max,buy:{from:o,to:r,fromLuminance:L(o,t),toLuminance:L(r,t),gif:e[i].buyGif},sell:{from:u,to:l,fromLuminance:L(u,t),toLuminance:L(l,t),gif:e[i].sellGif}})}return s}async cacheAudio(e=!0){const t=h.state[this.paneId].audioThreshold;if(!h.state.settings.useAudio||h.state[this.paneId].muted||h.state[this.paneId].audioVolume===0){this.audioThreshold=1/0;return}if(t?typeof t=="string"&&/\d\s*%$/.test(t)?this.audioThreshold=this.minimumTradeAmount*(parseFloat(t)/100):this.audioThreshold=+t:this.audioThreshold=this.minimumTradeAmount*.1,!this.tradesAudios||e){const s=h.state[this.paneId].audioPitch;this.tradesAudios=await this.cacheAudioThresholds(this.getTradesThesholds(),s),this.liquidationsAudios=await this.cacheAudioThresholds(this.getLiquidationsThresholds(),s)}}async cacheAudioThresholds(e,t){const s=[];for(let a=0;a<e.length;a++)s.push({buy:await T.buildAudioFunction(e[a].buyAudio,"buy",t),sell:await T.buildAudioFunction(e[a].sellAudio,"sell",t)});return s}cachePreferences(){this.slippageMode=h.state.settings.calculateSlippage,this.showTrades=h.state[this.paneId].showTrades,this.showLiquidations=h.state[this.paneId].showLiquidations,this.showGifs=!h.state.settings.disableAnimations,this.showLogos=h.state[this.paneId].showLogos,this.showPairs=h.state[this.paneId].showPairs,this.showPrices=h.state[this.paneId].showPrices,this.showTimeAgo=h.state[this.paneId].showTimeAgo,this.showTimeAgo&&!this.timeUpdateInterval?this.setupTimeUpdateInterval():!this.showTimeAgo&&this.timeUpdateInterval&&(clearInterval(this.timeUpdateInterval),this.timeUpdateInterval=null)}cachePaneMarkets(){this.marketsMultipliers={},this.paneMarkets=h.state.panes.panes[this.paneId].markets.reduce((e,t)=>{const[s]=t.split(":");if(!h.state.app.activeExchanges[s])return e[t]=!1,e;const a=h.state[this.paneId].multipliers[t];return typeof a<"u"&&(this.marketsMultipliers[t]=a),e[t]=!0,e},{})}setupTimeUpdateInterval(){let e;const t=s=>s<6e4?Math.floor(s/1e3)+"s":s<36e5?Math.floor(s/6e4)+"m":Math.floor(s/36e5)+"h";this.timeUpdateInterval=setInterval(()=>{const s=this.containerElement.getElementsByClassName("-timestamp"),a=s.length;if(!a)return;e=Date.now();const i=e/1e3%60<1;let o;for(let r=0;r<a&&!(typeof s[r]>"u");r++){const u=e-s[r].getAttribute("data-timestamp"),l=t(u);if(l===o&&l){s[r-1].textContent="",s[r-1].className="trade__time";continue}if(l!=s[r].textContent&&(s[r].textContent=l,!i&&l[l.length-1]!=="s"))break;o=l}},1e3)}setMaxCount(e){this.maxCount=e}trim(){for(;this.count>this.maxCount;)this.containerElement.removeChild(this.containerElement.lastChild),this.count--}clear(){this.containerElement.innerHTML="",this.count=0}destroy(){clearInterval(this.timeUpdateInterval)}}var B=Object.defineProperty,K=Object.getOwnPropertyDescriptor,Z=(d,e,t,s)=>{for(var a=s>1?void 0:s?K(e,t):e,i=d.length-1,o;i>=0;i--)(o=d[i])&&(a=(s?o(e,t,a):o(a))||a);return s&&a&&B(e,t,a),a};let E=class extends O(U){constructor(){super(...arguments);n(this,"showPlaceholder",!0);n(this,"sliderDropdownTrigger",null);n(this,"feed");n(this,"$refs")}get market(){return this.pane.markets[0]}get showLogos(){return this.$store.state[this.paneId].showLogos}get monochromeLogos(){return this.$store.state[this.paneId].monochromeLogos}get thresholdsMultipler(){return this.$store.state[this.paneId].thresholdsMultipler}get gradient(){return[this.$store.state[this.paneId].thresholds[0].buyColor,this.$store.state[this.paneId].thresholds[this.$store.state[this.paneId].thresholds.length-1].buyColor]}created(){b.on("trades",this.onTrades),this._onStoreMutation=this.$store.subscribe(t=>{switch(t.type){case"app/EXCHANGE_UPDATED":case"settings/TOGGLE_SLIPPAGE":case this.paneId+"/TOGGLE_PREFERENCE":this.feed.cachePreferences(),this.refreshList();break;case this.paneId+"/SET_MAX_ROWS":this.feed.setMaxCount(t.payload);break;case"panes/SET_PANE_MARKETS":case this.paneId+"/SET_THRESHOLD_MULTIPLIER":(t.type!=="panes/SET_PANE_MARKETS"||t.payload.id===this.paneId)&&(this.feed.cachePaneMarkets(),this.refreshList());break;case this.paneId+"/SET_THRESHOLD_GIF":p.getGifs(t.payload.value,!0),this.feed.prepareColors(),this.refreshList();break;case this.paneId+"/SET_THRESHOLD_AUDIO":case this.paneId+"/SET_AUDIO_VOLUME":case this.paneId+"/SET_AUDIO_PITCH":case"settings/SET_AUDIO_VOLUME":case"settings/TOGGLE_AUDIO":this.feed.cacheAudio();break;case this.paneId+"/SET_AUDIO_THRESHOLD":case this.paneId+"/TOGGLE_MUTED":this.feed.cacheAudio(!1);break;case"settings/SET_BACKGROUND_COLOR":case this.paneId+"/SET_THRESHOLD_COLOR":case this.paneId+"/SET_THRESHOLD_AMOUNT":case this.paneId+"/SET_THRESHOLDS_MULTIPLER":case this.paneId+"/TOGGLE_THRESHOLD_MAX":case this.paneId+"/DELETE_THRESHOLD":case this.paneId+"/ADD_THRESHOLD":this.feed.prepareColors(),this.refreshList(),(t.type===this.paneId+"/DELETE_THRESHOLD"||this.paneId+"/ADD_THRESHOLD")&&this.feed.cacheAudio();break}})}mounted(){this.feed=new Y(this.paneId,this.$refs.tradesContainer,this.$store.state[this.paneId].maxRows)}beforeDestroy(){b.off("trades",this.onTrades),this.feed&&this.feed.destroy()}onTrades(t){this.feed.processTrades(t)===this.showPlaceholder&&(this.showPlaceholder=!1)}refreshList(){var a;const t=this.$el.getElementsByClassName("trade"),s=[];for(const i of t){const[o,r]=D(i.getAttribute("title")),u=i.querySelector(".trade__time").getAttribute("data-timestamp"),l=parseFloat((a=i.querySelector(".trade__price"))==null?void 0:a.innerText)||0,c=parseFloat(i.querySelector(".trade__amount__base").innerText)||0,m=i.classList.contains("-buy")?"buy":"sell",v=c*(this.$store.state.settings.preferQuoteCurrencySize?l:1),f={timestamp:u,exchange:o,pair:r,price:l,amount:v,size:c,side:m};i.classList.contains("-liquidation")&&(f.liquidation=!0),s.push(f)}this.feed.clear(),this.feed.processTradesSilent(s)}upgradeToLite(){this.$store.dispatch(`${this.paneId}/upgradeToLite`)}};E=Z([x({components:{PaneHeader:F,TradesPlaceholder:X,Slider:R},name:"Trades"})],E);var J=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"pane-trades"},[t("pane-header",{ref:"paneHeader",attrs:{paneId:e.paneId,settings:()=>H(()=>import("./TradesDialog.5c4cb14.js"),["TradesDialog.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","paneDialogMixin.5c4cb14.js","TradesDialog.5c4cb14.css"])},scopedSlots:e._u([{key:"menu",fn:function(){return[t("button",{directives:[{name:"tippy",rawName:"v-tippy",value:{placement:"left",boundary:"window",followCursor:!0,distance:32},expression:`{
          placement: 'left',
          boundary: 'window',
          followCursor: true,
          distance: 32
        }`}],staticClass:"dropdown-item",attrs:{type:"button",title:"âœ¨ Upgrade to the canvas based feed for better performance âœ¨"},on:{click:e.upgradeToLite}},[e._v(" ðŸš€ "),t("span",{staticClass:"ml8"},[e._v("Upgrade")])])]},proxy:!0}])},[t("hr"),t("dropdown",{attrs:{interactive:"","no-scroll":""},model:{value:e.sliderDropdownTrigger,callback:function(s){e.sliderDropdownTrigger=s},expression:"sliderDropdownTrigger"}},[t("slider",{staticStyle:{width:"100px"},attrs:{min:0,max:10,step:.01,label:"","show-completion":!1,gradient:e.gradient,value:e.thresholdsMultipler,log:""},on:{input:function(s){return e.$store.commit(e.paneId+"/SET_THRESHOLDS_MULTIPLER",{value:s,market:e.market})},reset:function(s){return e.$store.commit(e.paneId+"/SET_THRESHOLDS_MULTIPLER",{value:1,market:e.market})}}})],1),t("button",{staticClass:"btn",on:{click:function(s){e.sliderDropdownTrigger=e.sliderDropdownTrigger?null:s.currentTarget}}},[t("i",{staticClass:"icon-gauge"})])],1),t("div",{ref:"tradesContainer",staticClass:"trades-list",class:["hide-scrollbar",this.showLogos&&"-logos",!this.monochromeLogos&&"-logos-colors"]}),e.showPlaceholder?t("trades-placeholder",{attrs:{paneId:e.paneId}}):e._e()],1)},ee=[],te=$(E,J,ee,!1,null,null,null,null);const re=te.exports;export{re as default};
