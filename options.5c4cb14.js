import{l as ie,r as se,al as ee,am as et,an as Ot,aa as ne,E as he,I as O,v as Ms,ao as re}from"./index.5c4cb14.js";function y(e){var t=e.width,i=e.height;if(t<0)throw new Error("Negative width is not allowed for Size");if(i<0)throw new Error("Negative height is not allowed for Size");return{width:t,height:i}}function Y(e,t){return e.width===t.width&&e.height===t.height}var oe=function(){function e(t){var i=this;this._resolutionListener=function(){return i._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=t,this._installResolutionListener()}return e.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(e.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),e.prototype.subscribe=function(t){var i=this,s={next:t};return this._observers.push(s),{unsubscribe:function(){i._observers=i._observers.filter(function(n){return n!==s})}}},e.prototype._installResolutionListener=function(){if(this._resolutionMediaQueryList!==null)throw new Error("Resolution listener is already installed");var t=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(t,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},e.prototype._uninstallResolutionListener=function(){this._resolutionMediaQueryList!==null&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},e.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},e.prototype._onResolutionChanged=function(){var t=this;this._observers.forEach(function(i){return i.next(t._window.devicePixelRatio)}),this._reinstallResolutionListener()},e}();function le(e){return new oe(e)}var ae=function(){function e(t,i,s){var n;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=t,this._canvasElementClientSize=y({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=i??function(h){return h},this._allowResizeObserver=(n=s==null?void 0:s.allowResizeObserver)!==null&&n!==void 0?n:!0,this._chooseAndInitObserver()}return e.prototype.dispose=function(){var t,i;if(this._canvasElement===null)throw new Error("Object is disposed");(t=this._canvasElementResizeObserver)===null||t===void 0||t.disconnect(),this._canvasElementResizeObserver=null,(i=this._devicePixelRatioObservable)===null||i===void 0||i.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(e.prototype,"canvasElement",{get:function(){if(this._canvasElement===null)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bitmapSize",{get:function(){return y({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),e.prototype.resizeCanvasElement=function(t){this._canvasElementClientSize=y(t),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},e.prototype.subscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners.push(t)},e.prototype.unsubscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter(function(i){return i!==t})},Object.defineProperty(e.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),e.prototype.subscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners.push(t)},e.prototype.unsubscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter(function(i){return i!==t})},e.prototype.applySuggestedBitmapSize=function(){if(this._suggestedBitmapSize!==null){var t=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(t),this._emitSuggestedBitmapSizeChanged(t,this._suggestedBitmapSize)}},e.prototype._resizeBitmap=function(t){var i=this.bitmapSize;Y(i,t)||(this.canvasElement.width=t.width,this.canvasElement.height=t.height,this._emitBitmapSizeChanged(i,t))},e.prototype._emitBitmapSizeChanged=function(t,i){var s=this;this._bitmapSizeChangedListeners.forEach(function(n){return n.call(s,t,i)})},e.prototype._suggestNewBitmapSize=function(t){var i=this._suggestedBitmapSize,s=y(this._transformBitmapSize(t,this._canvasElementClientSize)),n=Y(this.bitmapSize,s)?null:s;i===null&&n===null||i!==null&&n!==null&&Y(i,n)||(this._suggestedBitmapSize=n,this._emitSuggestedBitmapSizeChanged(i,n))},e.prototype._emitSuggestedBitmapSizeChanged=function(t,i){var s=this;this._suggestedBitmapSizeChangedListeners.forEach(function(n){return n.call(s,t,i)})},e.prototype._chooseAndInitObserver=function(){var t=this;if(!this._allowResizeObserver){this._initDevicePixelRatioObservable();return}ue().then(function(i){return i?t._initResizeObserver():t._initDevicePixelRatioObservable()})},e.prototype._initDevicePixelRatioObservable=function(){var t=this;if(this._canvasElement!==null){var i=zi(this._canvasElement);if(i===null)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=le(i),this._devicePixelRatioObservable.subscribe(function(){return t._invalidateBitmapSize()}),this._invalidateBitmapSize()}},e.prototype._invalidateBitmapSize=function(){var t,i;if(this._canvasElement!==null){var s=zi(this._canvasElement);if(s!==null){var n=(i=(t=this._devicePixelRatioObservable)===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:s.devicePixelRatio,h=this._canvasElement.getClientRects(),r=h[0]!==void 0?de(h[0],n):y({width:this._canvasElementClientSize.width*n,height:this._canvasElementClientSize.height*n});this._suggestNewBitmapSize(r)}}},e.prototype._initResizeObserver=function(){var t=this;this._canvasElement!==null&&(this._canvasElementResizeObserver=new ResizeObserver(function(i){var s=i.find(function(r){return r.target===t._canvasElement});if(!(!s||!s.devicePixelContentBoxSize||!s.devicePixelContentBoxSize[0])){var n=s.devicePixelContentBoxSize[0],h=y({width:n.inlineSize,height:n.blockSize});t._suggestNewBitmapSize(h)}}),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},e}();function ce(e,t){if(t.type==="device-pixel-content-box")return new ae(e,t.transform,t.options);throw new Error("Unsupported binding target")}function zi(e){return e.ownerDocument.defaultView}function ue(){return new Promise(function(e){var t=new ResizeObserver(function(i){e(i.every(function(s){return"devicePixelContentBoxSize"in s})),t.disconnect()});t.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1})}function de(e,t){return y({width:Math.round(e.left*t+e.width*t)-Math.round(e.left*t),height:Math.round(e.top*t+e.height*t)-Math.round(e.top*t)})}var fe=function(){function e(t,i,s){if(i.width===0||i.height===0)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=i,s.width===0||s.height===0)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=s,this._context=t}return e.prototype.useMediaCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),t({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},e.prototype.useBitmapCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),t({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(e.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),e}();function D(e,t){var i=e.canvasElementClientSize;if(i.width===0||i.height===0)return null;var s=e.bitmapSize;if(s.width===0||s.height===0)return null;var n=e.canvasElement.getContext("2d",t);return n===null?null:new fe(n,i,s)}/*!
 * @license
 * TradingView Lightweight Charts™ v4.1.0-dev+202402132339
 * Copyright (c) 2024 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */var Rt,Ri;function j(e,t){const i={0:[],1:[e.lineWidth,e.lineWidth],2:[2*e.lineWidth,2*e.lineWidth],3:[6*e.lineWidth,6*e.lineWidth],4:[e.lineWidth,4*e.lineWidth]}[t];e.setLineDash(i)}function _s(e,t,i,s){e.beginPath();const n=e.lineWidth%2?.5:0;e.moveTo(i,t+n),e.lineTo(s,t+n),e.stroke()}function J(e,t){if(!e)throw new Error("Assertion failed"+(t?": "+t:""))}function P(e){if(e===void 0)throw new Error("Value is undefined");return e}function g(e){if(e===null)throw new Error("Value is null");return e}function lt(e){return g(P(e))}(function(e){e[e.Simple=0]="Simple",e[e.WithSteps=1]="WithSteps",e[e.Curved=2]="Curved"})(Rt||(Rt={})),function(e){e[e.Solid=0]="Solid",e[e.Dotted=1]="Dotted",e[e.Dashed=2]="Dashed",e[e.LargeDashed=3]="LargeDashed",e[e.SparseDotted=4]="SparseDotted"}(Ri||(Ri={}));const ki={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function L(e){return e<0?0:e>255?255:Math.round(e)||0}function Vs(e){return e<=0||e>0?e<0?0:e>1?1:Math.round(1e4*e)/1e4:0}const pe=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,me=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,ge=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,be=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function kt(e){(e=e.toLowerCase())in ki&&(e=ki[e]);{const t=be.exec(e)||ge.exec(e);if(t)return[L(parseInt(t[1],10)),L(parseInt(t[2],10)),L(parseInt(t[3],10)),Vs(t.length<5?1:parseFloat(t[4]))]}{const t=me.exec(e);if(t)return[L(parseInt(t[1],16)),L(parseInt(t[2],16)),L(parseInt(t[3],16)),1]}{const t=pe.exec(e);if(t)return[L(17*parseInt(t[1],16)),L(17*parseInt(t[2],16)),L(17*parseInt(t[3],16)),1]}throw new Error(`Cannot parse color: ${e}`)}function Nt(e){const t=kt(e);return{t:`rgb(${t[0]}, ${t[1]}, ${t[2]})`,i:(i=t,.199*i[0]+.687*i[1]+.114*i[2]>160?"black":"white")};var i}class _{constructor(){this.h=[]}l(t,i,s){const n={o:t,_:i,u:s===!0};this.h.push(n)}p(t){const i=this.h.findIndex(s=>t===s.o);i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter(i=>i._!==t)}m(t,i,s){const n=[...this.h];this.h=this.h.filter(h=>!h.u),n.forEach(h=>h.o(t,i,s))}M(){return this.h.length>0}S(){this.h=[]}}function B(e,...t){for(const i of t)for(const s in i)i[s]!==void 0&&(typeof i[s]!="object"||e[s]===void 0?e[s]=i[s]:B(e[s],i[s]));return e}function F(e){return typeof e=="number"&&isFinite(e)}function mt(e){return typeof e=="number"&&e%1==0}function mi(e){return typeof e=="string"}function Ct(e){return typeof e=="boolean"}function A(e){const t=e;if(!t||typeof t!="object")return t;let i,s,n;for(s in i=Array.isArray(t)?[]:{},t)t.hasOwnProperty(s)&&(n=t[s],i[s]=n&&typeof n=="object"?A(n):n);return i}function ve(e){return e!==null}function U(e){return e===null?void 0:e}const gi="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function it(e,t,i){return t===void 0&&(t=gi),`${i=i!==void 0?`${i} `:""}${e}px ${t}`}class we{constructor(t){this.k={C:1,T:5,P:NaN,R:"",D:"",A:"",B:"",L:0,N:0,O:0,I:0,V:0},this.F=t}W(){const t=this.k,i=this.j(),s=this.$();return t.P===i&&t.D===s||(t.P=i,t.D=s,t.R=it(i,s),t.I=2.5/12*i,t.L=t.I,t.N=i/12*t.T,t.O=i/12*t.T,t.V=0),t.A=this.H(),t.B=this.U(),this.k}H(){return this.F.W().layout.textColor}U(){return this.F.Y()}j(){return this.F.W().layout.fontSize}$(){return this.F.W().layout.fontFamily}}class vt{constructor(){this.q=[]}X(t){this.q=t}Z(t,i,s){this.q.forEach(n=>{n.Z(t,i,s)})}}class G{Z(t,i,s){t.useMediaCoordinateSpace(n=>this.K(n,i,s))}G(t,i,s){t.useMediaCoordinateSpace(n=>this.J(n,i,s))}J(t,i,s){}}class Se extends G{constructor(){super(...arguments),this.tt=null}it(t){this.tt=t}K({context:t}){if(this.tt===null||this.tt.nt===null)return;const i=this.tt.nt,s=this.tt,n=h=>{t.beginPath();for(let r=i.to-1;r>=i.from;--r){const o=s.st[r];t.moveTo(o.et,o.rt),t.arc(o.et,o.rt,h,0,2*Math.PI)}t.fill()};s.ht>0&&(t.fillStyle=s.lt,n(s.ot+s.ht)),t.fillStyle=s._t,n(s.ot)}}function Ce(){return{st:[{et:0,rt:0,ut:0,ct:0}],_t:"",lt:"",ot:0,ht:0,nt:null}}const ye={from:0,to:1};class xe{constructor(t,i){this.dt=new vt,this.ft=[],this.vt=[],this.bt=!0,this.F=t,this.gt=i,this.dt.X(this.ft)}wt(t){const i=this.F.Mt();i.length!==this.ft.length&&(this.vt=i.map(Ce),this.ft=this.vt.map(s=>{const n=new Se;return n.it(s),n}),this.dt.X(this.ft)),this.bt=!0}St(){return this.bt&&(this.xt(),this.bt=!1),this.dt}xt(){const t=this.F.Mt(),i=this.gt.kt(),s=this.F.yt();t.forEach((n,h)=>{var r;const o=this.vt[h],l=n.Ct(i);if(l===null||!n.Tt())return void(o.nt=null);const a=g(n.Pt());o._t=l.Rt,o.ot=l.ot,o.ht=l.Dt,o.st[0].ct=l.ct,o.st[0].rt=n.Bt().At(l.ct,a.Lt),o.lt=(r=l.Nt)!==null&&r!==void 0?r:this.F.Ot(o.st[0].rt/n.Bt().Et()),o.st[0].ut=i,o.st[0].et=s.It(i),o.nt=ye})}}class Z{Z(t,i,s){t.useBitmapCoordinateSpace(n=>this.K(n,i,s))}}class Me extends Z{constructor(t){super(),this.Vt=t}K({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:n}){if(this.Vt===null)return;const h=this.Vt.zt.Tt,r=this.Vt.Ft.Tt;if(!h&&!r)return;const o=Math.round(this.Vt.et*s),l=Math.round(this.Vt.rt*n);t.lineCap="butt",h&&o>=0&&(t.lineWidth=Math.floor(this.Vt.zt.ht*s),t.strokeStyle=this.Vt.zt.A,t.fillStyle=this.Vt.zt.A,j(t,this.Vt.zt.Wt),function(a,c,u,d){a.beginPath();const f=a.lineWidth%2?.5:0;a.moveTo(c+f,u),a.lineTo(c+f,d),a.stroke()}(t,o,0,i.height)),r&&l>=0&&(t.lineWidth=Math.floor(this.Vt.Ft.ht*n),t.strokeStyle=this.Vt.Ft.A,t.fillStyle=this.Vt.Ft.A,j(t,this.Vt.Ft.Wt),_s(t,l,0,i.width))}}class _e{constructor(t){this.bt=!0,this.jt={zt:{ht:1,Wt:0,A:"",Tt:!1},Ft:{ht:1,Wt:0,A:"",Tt:!1},et:0,rt:0},this.$t=new Me(this.jt),this.Ht=t}wt(){this.bt=!0}St(){return this.bt&&(this.xt(),this.bt=!1),this.$t}xt(){const t=this.Ht.Tt(),i=g(this.Ht.Ut()),s=i.Yt().W().crosshair,n=this.jt;n.Ft.Tt=t&&this.Ht.qt(i),n.zt.Tt=t&&this.Ht.Xt(),n.Ft.ht=s.horzLine.width,n.Ft.Wt=s.horzLine.style,n.Ft.A=s.horzLine.color,n.zt.ht=s.vertLine.width,n.zt.Wt=s.vertLine.style,n.zt.A=s.vertLine.color,n.et=this.Ht.Zt(),n.rt=this.Ht.Kt()}}function Ve(e,t,i,s,n,h){e.fillRect(t+h,i,s-2*h,h),e.fillRect(t+h,i+n-h,s-2*h,h),e.fillRect(t,i,h,n),e.fillRect(t+s-h,i,h,n)}function Xt(e,t,i,s,n,h){e.save(),e.globalCompositeOperation="copy",e.fillStyle=h,e.fillRect(t,i,s,n),e.restore()}function Fi(e,t){return Array.isArray(e)?e.map(i=>i===0?i:i+t):e+t}function Gt(e,t,i,s,n,h){let r,o,l,a;if(Array.isArray(h))if(h.length===2){const c=Math.max(0,h[0]),u=Math.max(0,h[1]);r=c,o=c,l=u,a=u}else{if(h.length!==4)throw new Error("Wrong border radius - it should be like css border radius");r=Math.max(0,h[0]),o=Math.max(0,h[1]),l=Math.max(0,h[2]),a=Math.max(0,h[3])}else{const c=Math.max(0,h);r=c,o=c,l=c,a=c}e.beginPath(),e.moveTo(t+r,i),e.lineTo(t+s-o,i),o!==0&&e.arcTo(t+s,i,t+s,i+o,o),e.lineTo(t+s,i+n-l),l!==0&&e.arcTo(t+s,i+n,t+s-l,i+n,l),e.lineTo(t+a,i+n),a!==0&&e.arcTo(t,i+n,t,i+n-a,a),e.lineTo(t,i+r),r!==0&&e.arcTo(t,i,t+r,i,r)}function Bi(e,t,i,s,n,h,r=0,o=0,l=""){if(e.save(),!r||!l||l===h)return Gt(e,t,i,s,n,o),e.fillStyle=h,e.fill(),void e.restore();const a=r/2;h!=="transparent"&&(Gt(e,t+r,i+r,s-2*r,n-2*r,Fi(o,-r)),e.fillStyle=h,e.fill()),l!=="transparent"&&(Gt(e,t+a,i+a,s-r,n-r,Fi(o,-a)),e.lineWidth=r,e.strokeStyle=l,e.closePath(),e.stroke()),e.restore()}function Ts(e,t,i,s,n,h,r){e.save(),e.globalCompositeOperation="copy";const o=e.createLinearGradient(0,0,0,n);o.addColorStop(0,h),o.addColorStop(1,r),e.fillStyle=o,e.fillRect(t,i,s,n),e.restore()}class Ai{constructor(t,i){this.it(t,i)}it(t,i){this.Vt=t,this.Gt=i}Et(t,i){return this.Vt.Tt?t.P+t.I+t.L:0}Z(t,i,s,n){if(!this.Vt.Tt||this.Vt.Jt.length===0)return;const h=this.Vt.A,r=this.Gt.t,o=t.useBitmapCoordinateSpace(l=>{const a=l.context;a.font=i.R;const c=this.Qt(l,i,s,n),u=c.ti,d=(f,p)=>{c.ii?Bi(a,u.ni,u.si,u.ei,u.ri,f,u.hi,[u.ot,0,0,u.ot],p):Bi(a,u.li,u.si,u.ei,u.ri,f,u.hi,[0,u.ot,u.ot,0],p)};return d(r,"transparent"),this.Vt.ai&&(a.fillStyle=h,a.fillRect(u.li,u.oi,u._i-u.li,u.ui)),d("transparent",r),this.Vt.ci&&(a.fillStyle=i.B,a.fillRect(c.ii?u.di-u.hi:0,u.si,u.hi,u.fi-u.si)),c});t.useMediaCoordinateSpace(({context:l})=>{const a=o.pi;l.font=i.R,l.textAlign=o.ii?"right":"left",l.textBaseline="middle",l.fillStyle=h,l.fillText(this.Vt.Jt,a.vi,(a.si+a.fi)/2+a.mi)})}Qt(t,i,s,n){var h;const{context:r,bitmapSize:o,mediaSize:l,horizontalPixelRatio:a,verticalPixelRatio:c}=t,u=this.Vt.ai||!this.Vt.bi?i.T:0,d=this.Vt.gi?i.C:0,f=i.I+this.Gt.wi,p=i.L+this.Gt.Mi,m=i.N,b=i.O,v=this.Vt.Jt,w=i.P,C=s.Si(r,v),S=Math.ceil(s.xi(r,v)),x=w+f+p,N=i.C+m+b+S+u,z=Math.max(1,Math.floor(c));let T=Math.round(x*c);T%2!=z%2&&(T+=1);const nt=d>0?Math.max(1,Math.floor(d*a)):0,Yt=Math.round(N*a),Ti=Math.round(u*a),te=(h=this.Gt.ki)!==null&&h!==void 0?h:this.Gt.yi,Li=Math.round(te*c)-Math.floor(.5*c),Dt=Math.floor(Li+z/2-T/2),Pi=Dt+T,St=n==="right",Ei=St?l.width-d:d,ht=St?o.width-nt:nt;let jt,Ht,Jt;return St?(jt=ht-Yt,Ht=ht-Ti,Jt=Ei-u-m-d):(jt=ht+Yt,Ht=ht+Ti,Jt=Ei+u+m),{ii:St,ti:{si:Dt,oi:Li,fi:Pi,ei:Yt,ri:T,ot:2*a,hi:nt,ni:jt,li:ht,_i:Ht,ui:z,di:o.width},pi:{si:Dt/c,fi:Pi/c,vi:Jt,mi:C}}}}class bi{constructor(t){this.Ci={yi:0,t:"#000",Mi:0,wi:0},this.Ti={Jt:"",Tt:!1,ai:!0,bi:!1,Nt:"",A:"#FFF",ci:!1,gi:!1},this.Pi={Jt:"",Tt:!1,ai:!1,bi:!0,Nt:"",A:"#FFF",ci:!0,gi:!0},this.bt=!0,this.Ri=new(t||Ai)(this.Ti,this.Ci),this.Di=new(t||Ai)(this.Pi,this.Ci)}Jt(){return this.Ai(),this.Ti.Jt}yi(){return this.Ai(),this.Ci.yi}wt(){this.bt=!0}Et(t,i=!1){return Math.max(this.Ri.Et(t,i),this.Di.Et(t,i))}Bi(){return this.Ci.ki||0}Li(t){this.Ci.ki=t}Ni(){return this.Ai(),this.Ti.Tt||this.Pi.Tt}Oi(){return this.Ai(),this.Ti.Tt}St(t){return this.Ai(),this.Ti.ai=this.Ti.ai&&t.W().ticksVisible,this.Pi.ai=this.Pi.ai&&t.W().ticksVisible,this.Ri.it(this.Ti,this.Ci),this.Di.it(this.Pi,this.Ci),this.Ri}Ei(){return this.Ai(),this.Ri.it(this.Ti,this.Ci),this.Di.it(this.Pi,this.Ci),this.Di}Ai(){this.bt&&(this.Ti.ai=!0,this.Pi.ai=!1,this.Ii(this.Ti,this.Pi,this.Ci))}}class Te extends bi{constructor(t,i,s){super(),this.Ht=t,this.Vi=i,this.zi=s}Ii(t,i,s){t.Tt=!1;const n=this.Ht.W().horzLine;if(!n.labelVisible)return;const h=this.Vi.Pt();if(!this.Ht.Tt()||this.Vi.Fi()||h===null)return;const r=Nt(n.labelBackgroundColor);s.t=r.t,t.A=r.i;const o=2/12*this.Vi.P();s.wi=o,s.Mi=o;const l=this.zi(this.Vi);s.yi=l.yi,t.Jt=this.Vi.Wi(l.ct,h),t.Tt=!0}}const Le=/[1-9]/g;class Pe{constructor(){this.Vt=null}it(t){this.Vt=t}Z(t,i){if(this.Vt===null||this.Vt.Tt===!1||this.Vt.Jt.length===0)return;const s=t.useMediaCoordinateSpace(({context:d})=>(d.font=i.R,Math.round(i.ji.xi(d,g(this.Vt).Jt,Le))));if(s<=0)return;const n=i.$i,h=s+2*n,r=h/2,o=this.Vt.Hi;let l=this.Vt.yi,a=Math.floor(l-r)+.5;a<0?(l+=Math.abs(0-a),a=Math.floor(l-r)+.5):a+h>o&&(l-=Math.abs(o-(a+h)),a=Math.floor(l-r)+.5);const c=a+h,u=Math.ceil(0+i.C+i.T+i.I+i.P+i.L);t.useBitmapCoordinateSpace(({context:d,horizontalPixelRatio:f,verticalPixelRatio:p})=>{const m=g(this.Vt);d.fillStyle=m.t;const b=Math.round(a*f),v=Math.round(0*p),w=Math.round(c*f),C=Math.round(u*p),S=Math.round(2*f);if(d.beginPath(),d.moveTo(b,v),d.lineTo(b,C-S),d.arcTo(b,C,b+S,C,S),d.lineTo(w-S,C),d.arcTo(w,C,w,C-S,S),d.lineTo(w,v),d.fill(),m.ai){const x=Math.round(m.yi*f),N=v,z=Math.round((N+i.T)*p);d.fillStyle=m.A;const T=Math.max(1,Math.floor(f)),nt=Math.floor(.5*f);d.fillRect(x-nt,N,T,z-N)}}),t.useMediaCoordinateSpace(({context:d})=>{const f=g(this.Vt),p=0+i.C+i.T+i.I+i.P/2;d.font=i.R,d.textAlign="left",d.textBaseline="middle",d.fillStyle=f.A;const m=i.ji.Si(d,"Apr0");d.translate(a+n,p+m),d.fillText(f.Jt,0,0)})}}class Ee{constructor(t,i,s){this.bt=!0,this.$t=new Pe,this.jt={Tt:!1,t:"#4c525e",A:"white",Jt:"",Hi:0,yi:NaN,ai:!0},this.gt=t,this.Ui=i,this.zi=s}wt(){this.bt=!0}St(){return this.bt&&(this.xt(),this.bt=!1),this.$t.it(this.jt),this.$t}xt(){const t=this.jt;t.Tt=!1;const i=this.gt.W().vertLine;if(!i.labelVisible)return;const s=this.Ui.yt();if(s.Fi())return;t.Hi=s.Hi();const n=this.zi();if(n===null)return;t.yi=n.yi;const h=s.Yi(this.gt.kt());t.Jt=s.qi(g(h)),t.Tt=!0;const r=Nt(i.labelBackgroundColor);t.t=r.t,t.A=r.i,t.ai=s.W().ticksVisible}}class vi{constructor(){this.Xi=null,this.Zi=0}Ki(){return this.Zi}Gi(t){this.Zi=t}Bt(){return this.Xi}Ji(t){this.Xi=t}Qi(t){return[]}tn(){return[]}Tt(){return!0}}var Wi;(function(e){e[e.Normal=0]="Normal",e[e.Magnet=1]="Magnet"})(Wi||(Wi={}));class ze extends vi{constructor(t,i){super(),this.nn=null,this.sn=NaN,this.en=0,this.rn=!0,this.hn=new Map,this.ln=!1,this.an=NaN,this.on=NaN,this._n=NaN,this.un=NaN,this.Ui=t,this.cn=i,this.dn=new xe(t,this),this.fn=((n,h)=>r=>{const o=h(),l=n();if(r===g(this.nn).pn())return{ct:l,yi:o};{const a=g(r.Pt());return{ct:r.vn(o,a),yi:o}}})(()=>this.sn,()=>this.on);const s=((n,h)=>()=>{const r=this.Ui.yt().mn(n()),o=h();return r&&Number.isFinite(o)?{ut:r,yi:o}:null})(()=>this.en,()=>this.Zt());this.bn=new Ee(this,t,s),this.gn=new _e(this)}W(){return this.cn}wn(t,i){this._n=t,this.un=i}Mn(){this._n=NaN,this.un=NaN}Sn(){return this._n}xn(){return this.un}kn(t,i,s){this.ln||(this.ln=!0),this.rn=!0,this.yn(t,i,s)}kt(){return this.en}Zt(){return this.an}Kt(){return this.on}Tt(){return this.rn}Cn(){this.rn=!1,this.Tn(),this.sn=NaN,this.an=NaN,this.on=NaN,this.nn=null,this.Mn()}Pn(t){return this.nn!==null?[this.gn,this.dn]:[]}qt(t){return t===this.nn&&this.cn.horzLine.visible}Xt(){return this.cn.vertLine.visible}Rn(t,i){this.rn&&this.nn===t||this.hn.clear();const s=[];return this.nn===t&&s.push(this.Dn(this.hn,i,this.fn)),s}tn(){return this.rn?[this.bn]:[]}Ut(){return this.nn}An(){this.gn.wt(),this.hn.forEach(t=>t.wt()),this.bn.wt(),this.dn.wt()}Bn(t){return t&&!t.pn().Fi()?t.pn():null}yn(t,i,s){this.Ln(t,i,s)&&this.An()}Ln(t,i,s){const n=this.an,h=this.on,r=this.sn,o=this.en,l=this.nn,a=this.Bn(s);this.en=t,this.an=isNaN(t)?NaN:this.Ui.yt().It(t),this.nn=s;const c=a!==null?a.Pt():null;return a!==null&&c!==null?(this.sn=i,this.on=a.At(i,c)):(this.sn=NaN,this.on=NaN),n!==this.an||h!==this.on||o!==this.en||r!==this.sn||l!==this.nn}Tn(){const t=this.Ui.Mt().map(s=>s.On().Nn()).filter(ve),i=t.length===0?null:Math.max(...t);this.en=i!==null?i:NaN}Dn(t,i,s){let n=t.get(i);return n===void 0&&(n=new Te(this,i,s),t.set(i,n)),n}}function $t(e){return e==="left"||e==="right"}class M{constructor(t){this.En=new Map,this.In=[],this.Vn=t}zn(t,i){const s=function(n,h){return n===void 0?h:{Fn:Math.max(n.Fn,h.Fn),Wn:n.Wn||h.Wn}}(this.En.get(t),i);this.En.set(t,s)}jn(){return this.Vn}$n(t){const i=this.En.get(t);return i===void 0?{Fn:this.Vn}:{Fn:Math.max(this.Vn,i.Fn),Wn:i.Wn}}Hn(){this.Un(),this.In=[{Yn:0}]}qn(t){this.Un(),this.In=[{Yn:1,Lt:t}]}Xn(t){this.Zn(),this.In.push({Yn:5,Lt:t})}Un(){this.Zn(),this.In.push({Yn:6})}Kn(){this.Un(),this.In=[{Yn:4}]}Gn(t){this.Un(),this.In.push({Yn:2,Lt:t})}Jn(t){this.Un(),this.In.push({Yn:3,Lt:t})}Qn(){return this.In}ts(t){for(const i of t.In)this.ns(i);this.Vn=Math.max(this.Vn,t.Vn),t.En.forEach((i,s)=>{this.zn(s,i)})}static ss(){return new M(2)}static es(){return new M(3)}ns(t){switch(t.Yn){case 0:this.Hn();break;case 1:this.qn(t.Lt);break;case 2:this.Gn(t.Lt);break;case 3:this.Jn(t.Lt);break;case 4:this.Kn();break;case 5:this.Xn(t.Lt);break;case 6:this.Zn()}}Zn(){const t=this.In.findIndex(i=>i.Yn===5);t!==-1&&this.In.splice(t,1)}}const Oi=".";function W(e,t){if(!F(e))return"n/a";if(!mt(t))throw new TypeError("invalid length");if(t<0||t>16)throw new TypeError("invalid length");return t===0?e.toString():("0000000000000000"+e.toString()).slice(-t)}class Ut{constructor(t,i){if(i||(i=1),F(t)&&mt(t)||(t=100),t<0)throw new TypeError("invalid base");this.Vi=t,this.rs=i,this.hs()}format(t){const i=t<0?"−":"";return t=Math.abs(t),i+this.ls(t)}hs(){if(this.os=0,this.Vi>0&&this.rs>0){let t=this.Vi;for(;t>1;)t/=10,this.os++}}ls(t){const i=this.Vi/this.rs;let s=Math.floor(t),n="";const h=this.os!==void 0?this.os:NaN;if(i>1){let r=+(Math.round(t*i)-s*i).toFixed(this.os);r>=i&&(r-=i,s+=1),n=Oi+W(+r.toFixed(this.os)*this.rs,h)}else s=Math.round(s*i)/i,h>0&&(n=Oi+W(0,h));return s.toFixed(0)+n}}class Ls extends Ut{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class Re{constructor(t){this._s=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.us(t):t<999995?i+this.us(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.us(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.us(t/1e9)+"B")}us(t){let i;const s=Math.pow(10,this._s);return i=(t=Math.round(t*s)/s)>=1e-15&&t<1?t.toFixed(this._s).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,(n,h)=>h)}}function Ps(e,t,i,s,n,h,r){if(t.length===0||s.from>=t.length||s.to<=0)return;const o=e.context,l=t[s.from];let a=h(e,l),c=l;if(s.to-s.from<2){const f=n/2;o.beginPath();const p={et:l.et-f,rt:l.rt},m={et:l.et+f,rt:l.rt};return o.moveTo(p.et,p.rt),o.lineTo(m.et,m.rt),void r(o,a,p,m)}const u=(f,p)=>{r(o,a,c,p),o.beginPath(),a=f,c=p};let d=c;o.beginPath(),o.moveTo(l.et,l.rt);for(let f=s.from+1;f<s.to;++f){d=t[f];const p=h(e,d);switch(i){case 0:o.lineTo(d.et,d.rt);break;case 1:o.lineTo(d.et,t[f-1].rt),p!==a&&(u(p,d),o.lineTo(d.et,t[f-1].rt)),o.lineTo(d.et,d.rt);break;case 2:{const[m,b]=ke(t,f-1,f);o.bezierCurveTo(m.et,m.rt,b.et,b.rt,d.et,d.rt);break}}i!==1&&p!==a&&(u(p,d),o.moveTo(d.et,d.rt))}(c!==d||c===d&&i===1)&&r(o,a,c,d)}const Ni=6;function Zt(e,t){return{et:e.et-t.et,rt:e.rt-t.rt}}function Xi(e,t){return{et:e.et/t,rt:e.rt/t}}function ke(e,t,i){const s=Math.max(0,t-1),n=Math.min(e.length-1,i+1);var h,r;return[(h=e[t],r=Xi(Zt(e[i],e[s]),Ni),{et:h.et+r.et,rt:h.rt+r.rt}),Zt(e[i],Xi(Zt(e[n],e[t]),Ni))]}function Fe(e,t,i,s,n){t.lineTo(n.et,e),t.lineTo(s.et,e),t.closePath(),t.fillStyle=i,t.fill()}class Es extends G{constructor(){super(...arguments),this.tt=null}it(t){this.tt=t}K(t){var i;if(this.tt===null)return;const{st:s,nt:n,cs:h,ht:r,Wt:o,ds:l}=this.tt,a=(i=this.tt.fs)!==null&&i!==void 0?i:this.tt.ps?0:t.mediaSize.height;if(n===null)return;const c=t.context;c.lineCap="butt",c.lineJoin="round",c.lineWidth=r,j(c,o),c.lineWidth=1,Ps(t,s,l,n,h,this.vs.bind(this),Fe.bind(null,a))}}class Be extends Es{constructor(){super(...arguments),this.bs=null}vs(t,i){const{context:s,mediaSize:n}=t,{gs:h,ws:r}=i,o=n.height;if(this.bs!==null&&this.bs.topColor===h&&this.bs.bottomColor===r&&this.bs.bottom===o)return this.bs.fillStyle;const l=s.createLinearGradient(0,0,0,o);return l.addColorStop(0,h),l.addColorStop(1,r),this.bs={topColor:h,bottomColor:r,fillStyle:l,bottom:o},l}}function Ae(e,t){e.strokeStyle=t,e.stroke()}class zs extends G{constructor(){super(...arguments),this.tt=null}it(t){this.tt=t}K(t){if(this.tt===null)return;const{st:i,nt:s,cs:n,ds:h,ht:r,Wt:o}=this.tt;if(s===null)return;const l=t.context;l.lineCap="butt",l.lineWidth=r,j(l,o),l.lineJoin="round",Ps(t,i,h,s,n,this.Ms.bind(this),Ae)}}class Ft extends zs{Ms(t,i){return i._t}}function wt(e,t,i,s=0,n=e.length){let h=n-s;for(;0<h;){const r=h>>1,o=s+r;i(e[o],t)?(s=o+1,h-=r+1):h=r}return s}function Rs(e,t,i,s=0,n=e.length){let h=n-s;for(;0<h;){const r=h>>1,o=s+r;i(t,e[o])?h=r:(s=o+1,h-=r+1)}return s}function We(e,t){return e.ut<t}function Oe(e,t){return e<t.ut}function ks(e,t,i){const s=t.Ss(),n=t.di(),h=wt(e,s,We),r=Rs(e,n,Oe);if(!i)return{from:h,to:r};let o=h,l=r;return h>0&&h<e.length&&e[h].ut>=s&&(o=h-1),r>0&&r<e.length&&e[r-1].ut<=n&&(l=r+1),{from:o,to:l}}class wi{constructor(t,i,s){this.xs=!0,this.ks=!0,this.ys=!0,this.Cs=[],this.Ts=null,this.Ps=t,this.Rs=i,this.Ds=s}wt(t){this.xs=!0,t==="data"&&(this.ks=!0),t==="options"&&(this.ys=!0)}St(){return this.Ps.Tt()?(this.As(),this.Ts===null?null:this.Bs):null}Ls(){this.Cs=this.Cs.map(t=>Object.assign(Object.assign({},t),this.Ps.Os().Ns(t.ut)))}Es(){this.Ts=null}As(){this.ks&&(this.Is(),this.ks=!1),this.ys&&(this.Ls(),this.ys=!1),this.xs&&(this.Vs(),this.xs=!1)}Vs(){const t=this.Ps.Bt(),i=this.Rs.yt();if(this.Es(),i.Fi()||t.Fi())return;const s=i.zs();if(s===null||this.Ps.On().Fs()===0)return;const n=this.Ps.Pt();n!==null&&(this.Ts=ks(this.Cs,s,this.Ds),this.Ws(t,i,n.Lt),this.js())}}class It extends wi{constructor(t,i){super(t,i,!0)}Ws(t,i,s){i.$s(this.Cs,U(this.Ts)),t.Hs(this.Cs,s,U(this.Ts))}Us(t,i){return{ut:t,ct:i,et:NaN,rt:NaN}}Is(){const t=this.Ps.Os();this.Cs=this.Ps.On().Ys().map(i=>{const s=i.Lt[3];return this.qs(i.Xs,s,t)})}}class Ne extends It{constructor(t,i){super(t,i),this.Bs=new vt,this.Zs=new Be,this.Ks=new Ft,this.Bs.X([this.Zs,this.Ks])}qs(t,i,s){return Object.assign(Object.assign({},this.Us(t,i)),s.Ns(t))}js(){const t=this.Ps.W();this.Zs.it({ds:t.lineType,st:this.Cs,Wt:t.lineStyle,ht:t.lineWidth,fs:null,ps:t.invertFilledArea,nt:this.Ts,cs:this.Rs.yt().Gs()}),this.Ks.it({ds:t.lineType,st:this.Cs,Wt:t.lineStyle,ht:t.lineWidth,nt:this.Ts,cs:this.Rs.yt().Gs()})}}class Xe extends Z{constructor(){super(...arguments),this.Vt=null,this.Js=0,this.Qs=0}it(t){this.Vt=t}K({context:t,horizontalPixelRatio:i,verticalPixelRatio:s}){if(this.Vt===null||this.Vt.On.length===0||this.Vt.nt===null)return;this.Js=this.te(i),this.Js>=2&&Math.max(1,Math.floor(i))%2!=this.Js%2&&this.Js--,this.Qs=this.Vt.ie?Math.min(this.Js,Math.floor(i)):this.Js;let n=null;const h=this.Qs<=this.Js&&this.Vt.Gs>=Math.floor(1.5*i);for(let r=this.Vt.nt.from;r<this.Vt.nt.to;++r){const o=this.Vt.On[r];n!==o.ne&&(t.fillStyle=o.ne,n=o.ne);const l=Math.floor(.5*this.Qs),a=Math.round(o.et*i),c=a-l,u=this.Qs,d=c+u-1,f=Math.min(o.se,o.ee),p=Math.max(o.se,o.ee),m=Math.round(f*s)-l,b=Math.round(p*s)+l,v=Math.max(b-m,this.Qs);t.fillRect(c,m,u,v);const w=Math.ceil(1.5*this.Js);if(h){if(this.Vt.re){const N=a-w;let z=Math.max(m,Math.round(o.he*s)-l),T=z+u-1;T>m+v-1&&(T=m+v-1,z=T-u+1),t.fillRect(N,z,c-N,T-z+1)}const C=a+w;let S=Math.max(m,Math.round(o.le*s)-l),x=S+u-1;x>m+v-1&&(x=m+v-1,S=x-u+1),t.fillRect(d+1,S,C-d,x-S+1)}}}te(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(s,n){return Math.floor(.3*s*n)}(g(this.Vt).Gs,t)))}}class Fs extends wi{constructor(t,i){super(t,i,!1)}Ws(t,i,s){i.$s(this.Cs,U(this.Ts)),t.ae(this.Cs,s,U(this.Ts))}oe(t,i,s){return{ut:t,_e:i.Lt[0],ue:i.Lt[1],ce:i.Lt[2],de:i.Lt[3],et:NaN,he:NaN,se:NaN,ee:NaN,le:NaN}}Is(){const t=this.Ps.Os();this.Cs=this.Ps.On().Ys().map(i=>this.qs(i.Xs,i,t))}}class $e extends Fs{constructor(){super(...arguments),this.Bs=new Xe}qs(t,i,s){return Object.assign(Object.assign({},this.oe(t,i,s)),s.Ns(t))}js(){const t=this.Ps.W();this.Bs.it({On:this.Cs,Gs:this.Rs.yt().Gs(),re:t.openVisible,ie:t.thinBars,nt:this.Ts})}}function Bt(e,t,i){return Math.min(Math.max(e,t),i)}function yt(e,t,i){return t-e<=i}function Bs(e){return e<=0?NaN:Math.log(e)/Math.log(10)}function As(e){const t=Math.ceil(e);return t%2==0?t-1:t}class Ue extends Es{constructor(){super(...arguments),this.bs=null}vs(t,i){var s;const{context:n,mediaSize:h}=t,r=this.tt,{fe:o,pe:l,ve:a,me:c}=i,u=(s=r.fs)!==null&&s!==void 0?s:h.height,d=h.height;if(this.bs!==null&&this.bs.topFillColor1===o&&this.bs.topFillColor2===l&&this.bs.bottomFillColor1===a&&this.bs.bottomFillColor2===c&&this.bs.baseLevelCoordinate===u&&this.bs.bottom===d)return this.bs.fillStyle;const f=n.createLinearGradient(0,0,0,d),p=Bt(u/d,0,1);return f.addColorStop(0,o),f.addColorStop(p,l),f.addColorStop(p,a),f.addColorStop(1,c),this.bs={topFillColor1:o,topFillColor2:l,bottomFillColor1:a,bottomFillColor2:c,fillStyle:f,baseLevelCoordinate:u,bottom:d},f}}class Ie extends zs{constructor(){super(...arguments),this.be=null}Ms(t,i){const{context:s,mediaSize:n}=t,h=this.tt,{ge:r,we:o}=i,{fs:l}=h,a=n.height;if(this.be!==null&&this.be.topLineColor===r&&this.be.bottomLineColor===o&&this.be.baseLevelCoordinate===l&&this.be.bottom===a)return this.be.strokeStyle;const c=s.createLinearGradient(0,0,0,a),u=Bt(l/a,0,1);return c.addColorStop(0,r),c.addColorStop(u,r),c.addColorStop(u,o),c.addColorStop(1,o),this.be={topLineColor:r,bottomLineColor:o,strokeStyle:c,baseLevelCoordinate:l,bottom:a},c}}class Ye extends It{constructor(t,i){super(t,i),this.Bs=new vt,this.Me=new Ue,this.Se=new Ie,this.Bs.X([this.Me,this.Se])}qs(t,i,s){return Object.assign(Object.assign({},this.Us(t,i)),s.Ns(t))}js(){const t=this.Ps.Pt();if(t===null)return;const i=this.Ps.W(),s=this.Ps.Bt().At(i.baseValue.price,t.Lt),n=this.Rs.yt().Gs();this.Me.it({st:this.Cs,ht:i.lineWidth,Wt:i.lineStyle,ds:i.lineType,fs:s,ps:!1,nt:this.Ts,cs:n}),this.Se.it({st:this.Cs,ht:i.lineWidth,Wt:i.lineStyle,ds:i.lineType,fs:s,nt:this.Ts,cs:n})}}class De extends G{constructor(){super(...arguments),this.xe={},this.tt=null}it(t){this.tt=t}K(t){if(this.tt===null||this.tt.st.length===0||!this.tt.nt)return;const i=t.context,s=[];let n=this.tt.nt.from;const h=this.tt.nt.to;if(n===h)s.push([n,h]);else{let r=null,o=null;for(let l=n;l<h;++l){const a=this.tt.st[l];r!==null&&(a.ut-r>1||a.A!==o)&&(s.push([n,a.ut-r>1?l-1:l]),n=l),r=a.ut,o=a.A}s.push([n,Math.max(h?h-1:0,n)])}i.strokeStyle=this.tt.ke,i.lineWidth=this.tt.ye,i.fillStyle=this.tt.A;for(let r=0;r<s.length;++r){const o=s[r][0],l=s[r][1];if(this.tt.st[o].Ce!==void 0&&(i.fillStyle=this.tt.ke,i.fillText(this.tt.st[o].Ce,this.tt.st[o].et,this.tt.st[o].Te-4),i.fillStyle=this.tt.A),i.beginPath(),i.moveTo(this.tt.st[o].et,this.tt.st[o].Te),this.tt.st[o].Pe&&this.tt.st[o].Te===this.tt.st[o].Re&&o===l)this.tt.st[o].A!==void 0&&(i.strokeStyle=this.tt.st[o].A),i.lineTo(this.tt.st[o].De,this.tt.st[o].Te),this.tt.ye&&i.stroke();else{for(let a=o;a<=l;a++)i.lineTo(this.tt.st[a].et,this.tt.st[a].Te);this.tt.st[o].Pe&&(i.lineTo(this.tt.st[l].De,this.tt.st[l].Te),i.lineTo(this.tt.st[l].De,this.tt.st[l].Re));for(let a=l;a>=o;--a)i.lineTo(this.tt.st[a].et,this.tt.st[a].Re);i.closePath(),this.tt.st[o].A!==void 0&&(i.fillStyle=this.tt.st[o].A),this.tt.A&&i.fill(),this.tt.ye&&i.stroke()}}}}class Ws extends wi{Ws(t,i,s){i.$s(this.Cs,U(this.Ts)),t.Ae(this.Cs,s,U(this.Ts))}Is(){this.Cs=this.Ps.On().Ys().map(t=>{const i=t.Lt[1],s=t.Lt[2];return{ut:t.Xs,Be:i,Le:s,et:NaN,Te:NaN,Re:NaN}})}}class je extends Ws{constructor(t,i){super(t,i,!1),this.Bs=new vt,this.Ne=new De,this.Bs.X([this.Ne])}Oe(t){this.Ne.xe=t}js(){const t=this.Ps.W(),i={st:this.Cs,A:t.color,ke:t.strokeColor,ye:t.strokeWidth,Ee:t.compositeOperation,nt:this.Ts,cs:this.Rs.yt().Gs()};this.Ne.it(i)}Ws(t,i,s){i.Ie(this.Cs,this.Ne.xe,U(this.Ts)),t.Ae(this.Cs,s,U(this.Ts))}Is(){this.Cs=this.Ps.On().Ys().map(t=>{const i=t.Lt[1],s=t.Lt[2],n={ut:t.Xs,Be:i,Le:s,et:NaN,De:NaN,Te:NaN,Re:NaN};return t.A!==void 0&&(n.A=t.A),t.Ve!==void 0&&(n.Ve=t.Ve),t.Ce!==void 0&&(n.Ce=t.Ce),t.Pe!==void 0&&(n.Pe=t.Pe),n})}}class He extends Z{constructor(){super(...arguments),this.Vt=null,this.Js=0}it(t){this.Vt=t}K(t){if(this.Vt===null||this.Vt.On.length===0||this.Vt.nt===null)return;const{horizontalPixelRatio:i}=t;this.Js=function(h,r){if(h>=2.5&&h<=4)return Math.floor(3*r);const o=1-.2*Math.atan(Math.max(4,h)-4)/(.5*Math.PI),l=Math.floor(h*o*r),a=Math.floor(h*r),c=Math.min(l,a);return Math.max(Math.floor(r),c)}(this.Vt.Gs,i),this.Js>=2&&Math.floor(i)%2!=this.Js%2&&this.Js--;const s=this.Vt.On;this.Vt.ze&&this.Fe(t,s,this.Vt.nt),this.Vt.ci&&this.We(t,s,this.Vt.nt);const n=this.je(i);(!this.Vt.ci||this.Js>2*n)&&this.$e(t,s,this.Vt.nt)}Fe(t,i,s){if(this.Vt===null)return;const{context:n,horizontalPixelRatio:h,verticalPixelRatio:r}=t;let o="",l=Math.min(Math.floor(h),Math.floor(this.Vt.Gs*h));l=Math.max(Math.floor(h),Math.min(l,this.Js));const a=Math.floor(.5*l);let c=null;for(let u=s.from;u<s.to;u++){const d=i[u];d.He!==o&&(n.fillStyle=d.He,o=d.He);const f=Math.round(Math.min(d.he,d.le)*r),p=Math.round(Math.max(d.he,d.le)*r),m=Math.round(d.se*r),b=Math.round(d.ee*r);let v=Math.round(h*d.et)-a;const w=v+l-1;c!==null&&(v=Math.max(c+1,v),v=Math.min(v,w));const C=w-v+1;n.fillRect(v,m,C,f-m),n.fillRect(v,p+1,C,b-p),c=w}}je(t){let i=Math.floor(1*t);this.Js<=2*i&&(i=Math.floor(.5*(this.Js-1)));const s=Math.max(Math.floor(t),i);return this.Js<=2*s?Math.max(Math.floor(t),Math.floor(1*t)):s}We(t,i,s){if(this.Vt===null)return;const{context:n,horizontalPixelRatio:h,verticalPixelRatio:r}=t;let o="";const l=this.je(h);let a=null;for(let c=s.from;c<s.to;c++){const u=i[c];u.Ue!==o&&(n.fillStyle=u.Ue,o=u.Ue);let d=Math.round(u.et*h)-Math.floor(.5*this.Js);const f=d+this.Js-1,p=Math.round(Math.min(u.he,u.le)*r),m=Math.round(Math.max(u.he,u.le)*r);if(a!==null&&(d=Math.max(a+1,d),d=Math.min(d,f)),this.Vt.Gs*h>2*l)Ve(n,d,p,f-d+1,m-p+1,l);else{const b=f-d+1;n.fillRect(d,p,b,m-p+1)}a=f}}$e(t,i,s){if(this.Vt===null)return;const{context:n,horizontalPixelRatio:h,verticalPixelRatio:r}=t;let o="";const l=this.je(h);for(let a=s.from;a<s.to;a++){const c=i[a];let u=Math.round(Math.min(c.he,c.le)*r),d=Math.round(Math.max(c.he,c.le)*r),f=Math.round(c.et*h)-Math.floor(.5*this.Js),p=f+this.Js-1;if(c.ne!==o){const m=c.ne;n.fillStyle=m,o=m}this.Vt.ci&&(f+=l,u+=l,p-=l,d-=l),u>d||n.fillRect(f,u,p-f+1,d-u+1)}}}class Je extends Fs{constructor(){super(...arguments),this.Bs=new He}qs(t,i,s){return Object.assign(Object.assign({},this.oe(t,i,s)),s.Ns(t))}js(){const t=this.Ps.W();this.Bs.it({On:this.Cs,Gs:this.Rs.yt().Gs(),ze:t.wickVisible,ci:t.borderVisible,nt:this.Ts})}}class Si extends G{constructor(){super(...arguments),this.tt=null}it(t){this.tt=t}K(t){if(this.tt===null||this.tt.st.length===0||this.tt.nt===null)return;const i=t.context;let s=1;const n=[];let h=-2;for(let c=this.tt.nt.from+1;c<this.tt.nt.to;++c){const u=this.tt.st[c],d=u.Be-u.Le,f=d>0?1:-1;c===this.tt.nt.from+1&&(s=d),h!==-2&&h*f==-1&&n.push(c),h=f}n.push(this.tt.nt.to);let r,o=this.tt.nt.from,l=[0,0],a=[0,0];for(let c=0;c<n.length;++c){r=n[c],i.beginPath(),c===0?i.moveTo(this.tt.st[o].et,this.tt.st[o].Te):i.moveTo(l[0],l[1]);for(let u=o;u<r;u++)i.lineTo(this.tt.st[u].et,this.tt.st[u].Te);c!==n.length-1&&(a=this.Ye(r),i.lineTo(a[0],a[1]));for(let u=r-1;u>=o;--u)i.lineTo(this.tt.st[u].et,this.tt.st[u].Re);c!==0&&i.lineTo(l[0],l[1]),i.closePath(),s*Math.pow(-1,c)>0?i.fillStyle=this.tt.qe:i.fillStyle=this.tt.Xe,i.fill(),o=r,l=a}}Ye(t){if(this.tt===null||this.tt.st.length===0||this.tt.nt===null)throw new Error("Empty data");return Si.Ze(this.tt.st[t-1].et,this.tt.st[t-1].Te,this.tt.st[t].et,this.tt.st[t].Te,this.tt.st[t-1].Re,this.tt.st[t].Re)}static Ze(t,i,s,n,h,r){const o=n-i,l=t-s,a=o*t+l*i,c=r-h,u=t-s,d=c*t+u*h,f=o*u-c*l;if(f===0)throw new Error("Lines are parallel");return[(u*a-l*d)/f,(o*d-c*a)/f]}}class Ge extends Ws{constructor(t,i){super(t,i,!1),this.Bs=new vt,this.Ke=new Si,this.Ge=new Ft,this.Je=new Ft,this.Bs.X([this.Ke,this.Ge,this.Je])}js(){const t=this.Ps.W(),i={st:this.Cs,qe:t.positiveColor,Xe:t.negativeColor,nt:this.Ts,cs:this.Rs.yt().Gs()};this.Ke.it(i);const s=[],n=[];for(let o=0;o<this.Cs.length;o++)s.push({_t:t.higherLineColor,ut:this.Cs[o].ut,ct:this.Cs[o].Be,et:this.Cs[o].et,rt:this.Cs[o].Te}),n.push({_t:t.lowerLineColor,ut:this.Cs[o].ut,ct:this.Cs[o].Le,et:this.Cs[o].et,rt:this.Cs[o].Re});const h={st:s,Wt:t.higherLineStyle,ds:t.higherLineType,ht:t.higherLineWidth,nt:this.Ts,cs:this.Rs.yt().Gs()};this.Ge.it(h);const r={st:n,Wt:t.lowerLineStyle,ds:t.lowerLineType,ht:t.lowerLineWidth,nt:this.Ts,cs:this.Rs.yt().Gs()};this.Je.it(r)}}class Ze extends Z{constructor(){super(...arguments),this.Vt=null,this.Qe=[]}it(t){this.Vt=t,this.Qe=[]}K({context:t,horizontalPixelRatio:i,verticalPixelRatio:s}){if(this.Vt===null||this.Vt.st.length===0||this.Vt.nt===null)return;this.Qe.length||this.tr(i);const n=Math.max(1,Math.floor(s)),h=Math.round(this.Vt.ir*s)-Math.floor(n/2),r=h+n;for(let o=this.Vt.nt.from;o<this.Vt.nt.to;o++){const l=this.Vt.st[o],a=this.Qe[o-this.Vt.nt.from],c=Math.round(l.rt*s);let u,d;t.fillStyle=l.ne,c<=h?(u=c,d=r):(u=h,d=c-Math.floor(n/2)+n),t.fillRect(a.Ss,u,a.di-a.Ss+1,d-u)}}tr(t){if(this.Vt===null||this.Vt.st.length===0||this.Vt.nt===null)return void(this.Qe=[]);const i=Math.ceil(this.Vt.Gs*t)<=1?0:Math.max(1,Math.floor(t)),s=Math.round(this.Vt.Gs*t)-i;this.Qe=new Array(this.Vt.nt.to-this.Vt.nt.from);for(let h=this.Vt.nt.from;h<this.Vt.nt.to;h++){const r=this.Vt.st[h],o=Math.round(r.et*t);let l,a;if(s%2){const c=(s-1)/2;l=o-c,a=o+c}else{const c=s/2;l=o-c,a=o+c-1}this.Qe[h-this.Vt.nt.from]={Ss:l,di:a,nr:o,sr:r.et*t,ut:r.ut}}for(let h=this.Vt.nt.from+1;h<this.Vt.nt.to;h++){const r=this.Qe[h-this.Vt.nt.from],o=this.Qe[h-this.Vt.nt.from-1];r.ut===o.ut+1&&r.Ss-o.di!==i+1&&(o.nr>o.sr?o.di=r.Ss-i-1:r.Ss=o.di+i+1)}let n=Math.ceil(this.Vt.Gs*t);for(let h=this.Vt.nt.from;h<this.Vt.nt.to;h++){const r=this.Qe[h-this.Vt.nt.from];r.di<r.Ss&&(r.di=r.Ss);const o=r.di-r.Ss+1;n=Math.min(o,n)}if(i>0&&n<4)for(let h=this.Vt.nt.from;h<this.Vt.nt.to;h++){const r=this.Qe[h-this.Vt.nt.from];r.di-r.Ss+1>n&&(r.nr>r.sr?r.di-=1:r.Ss+=1)}}}class Qe extends It{constructor(){super(...arguments),this.Bs=new Ze}qs(t,i,s){return Object.assign(Object.assign({},this.Us(t,i)),s.Ns(t))}js(){const t={st:this.Cs,Gs:this.Rs.yt().Gs(),nt:this.Ts,ir:this.Ps.Bt().At(this.Ps.W().base,g(this.Ps.Pt()).Lt)};this.Bs.it(t)}}class qe extends It{constructor(){super(...arguments),this.Bs=new Ft}qs(t,i,s){return Object.assign(Object.assign({},this.Us(t,i)),s.Ns(t))}js(){const t=this.Ps.W(),i={st:this.Cs,Wt:t.lineStyle,ds:t.lineType,ht:t.lineWidth,nt:this.Ts,cs:this.Rs.yt().Gs()};this.Bs.it(i)}}const Ke=/[2-9]/g;class gt{constructor(t=50){this.er=0,this.rr=1,this.hr=1,this.lr={},this.ar=new Map,this._r=t}ur(){this.er=0,this.ar.clear(),this.rr=1,this.hr=1,this.lr={}}xi(t,i,s){return this.cr(t,i,s).width}Si(t,i,s){const n=this.cr(t,i,s);return((n.actualBoundingBoxAscent||0)-(n.actualBoundingBoxDescent||0))/2}cr(t,i,s){const n=s||Ke,h=String(i).replace(n,"0");if(this.ar.has(h))return P(this.ar.get(h)).dr;if(this.er===this._r){const o=this.lr[this.hr];delete this.lr[this.hr],this.ar.delete(o),this.hr++,this.er--}t.save(),t.textBaseline="middle";const r=t.measureText(h);return t.restore(),r.width===0&&i.length||(this.ar.set(h,{dr:r,pr:this.rr}),this.lr[this.rr]=h,this.er++,this.rr++),r}}class tn{constructor(t){this.vr=null,this.k=null,this.mr="right",this.br=t}gr(t,i,s){this.vr=t,this.k=i,this.mr=s}Z(t){this.k!==null&&this.vr!==null&&this.vr.Z(t,this.k,this.br,this.mr)}}class Os{constructor(t,i,s){this.wr=t,this.br=new gt(50),this.Mr=i,this.F=s,this.j=-1,this.$t=new tn(this.br)}St(){const t=this.F.Sr(this.Mr);if(t===null)return null;const i=t.kr(this.Mr)?t.yr():this.Mr.Bt();if(i===null)return null;const s=t.Cr(i);if(s==="overlay")return null;const n=this.F.Tr();return n.P!==this.j&&(this.j=n.P,this.br.ur()),this.$t.gr(this.wr.Ei(),n,s),this.$t}}class sn extends Z{constructor(){super(...arguments),this.Vt=null}it(t){this.Vt=t}Pr(t,i){var s;if(!(!((s=this.Vt)===null||s===void 0)&&s.Tt))return null;const{rt:n,ht:h,Rr:r}=this.Vt;return i>=n-h-7&&i<=n+h+7?{Dr:this.Vt,Rr:r}:null}K({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:n}){if(this.Vt===null||this.Vt.Tt===!1)return;const h=Math.round(this.Vt.rt*n);if(h<0||h>i.height)return;let r=0;this.Vt.et!==void 0&&(r=Math.round(this.Vt.et*s)),t.lineCap="butt",t.strokeStyle=this.Vt.A,t.lineWidth=Math.floor(this.Vt.ht*s),j(t,this.Vt.Wt),_s(t,h,r,i.width)}}class Ci{constructor(t){this.Ar={rt:0,A:"rgba(0, 0, 0, 0)",ht:1,Wt:0,Tt:!1},this.Br=new sn,this.bt=!0,this.Ps=t,this.Rs=t.Yt(),this.Br.it(this.Ar)}wt(){this.bt=!0}St(){return this.Ps.Tt()?(this.bt&&(this.Lr(),this.bt=!1),this.Br):null}}class en extends Ci{constructor(t){super(t)}Lr(){this.Ar.Tt=!1;const t=this.Ps.Bt(),i=t.Nr().Nr;if(i!==2&&i!==3)return;const s=this.Ps.W();if(!s.baseLineVisible||!this.Ps.Tt())return;const n=this.Ps.Pt();n!==null&&(this.Ar.Tt=!0,this.Ar.rt=t.At(n.Lt,n.Lt),this.Ar.A=s.baseLineColor,this.Ar.ht=s.baseLineWidth,this.Ar.Wt=s.baseLineStyle)}}class nn extends Z{constructor(){super(...arguments),this.Vt=null}it(t){this.Vt=t}Or(){return this.Vt}K({context:t,horizontalPixelRatio:i,verticalPixelRatio:s}){const n=this.Vt;if(n===null)return;const h=Math.max(1,Math.floor(i)),r=h%2/2,o=Math.round(n.sr.x*i)+r,l=n.sr.y*s;t.fillStyle=n.Er,t.beginPath();const a=Math.max(2,1.5*n.Ir)*i;t.arc(o,l,a,0,2*Math.PI,!1),t.fill(),t.fillStyle=n.Vr,t.beginPath(),t.arc(o,l,n.ot*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=h,t.strokeStyle=n.ke,t.beginPath(),t.arc(o,l,n.ot*i+h/2,0,2*Math.PI,!1),t.stroke()}}const hn=[{zr:0,De:.25,Fr:4,Wr:10,jr:.25,$r:0,Hr:.4,Ur:.8},{zr:.25,De:.525,Fr:10,Wr:14,jr:0,$r:0,Hr:.8,Ur:0},{zr:.525,De:1,Fr:14,Wr:14,jr:0,$r:0,Hr:0,Ur:0}];function $i(e,t,i,s){return function(n,h){if(n==="transparent")return n;const r=kt(n),o=r[3];return`rgba(${r[0]}, ${r[1]}, ${r[2]}, ${h*o})`}(e,i+(s-i)*t)}function Ui(e,t){const i=e%2600/2600;let s;for(const l of hn)if(i>=l.zr&&i<=l.De){s=l;break}J(s!==void 0,"Last price animation internal logic error");const n=(i-s.zr)/(s.De-s.zr);return{Vr:$i(t,n,s.jr,s.$r),ke:$i(t,n,s.Hr,s.Ur),ot:(h=n,r=s.Fr,o=s.Wr,r+(o-r)*h)};var h,r,o}class rn{constructor(t){this.$t=new nn,this.bt=!0,this.Yr=!0,this.qr=performance.now(),this.Xr=this.qr-1,this.Zr=t}Kr(){this.Xr=this.qr-1,this.wt()}Gr(){if(this.wt(),this.Zr.W().lastPriceAnimation===2){const t=performance.now(),i=this.Xr-t;if(i>0)return void(i<650&&(this.Xr+=2600));this.qr=t,this.Xr=t+2600}}wt(){this.bt=!0}Jr(){this.Yr=!0}Tt(){return this.Zr.W().lastPriceAnimation!==0}Qr(){switch(this.Zr.W().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.Xr}}St(){return this.bt?(this.xt(),this.bt=!1,this.Yr=!1):this.Yr&&(this.th(),this.Yr=!1),this.$t}xt(){this.$t.it(null);const t=this.Zr.Yt().yt(),i=t.zs(),s=this.Zr.Pt();if(i===null||s===null)return;const n=this.Zr.ih(!0);if(n.nh||!i.sh(n.Xs))return;const h={x:t.It(n.Xs),y:this.Zr.Bt().At(n.ct,s.Lt)},r=n.A,o=this.Zr.W().lineWidth,l=Ui(this.eh(),r);this.$t.it({Er:r,Ir:o,Vr:l.Vr,ke:l.ke,ot:l.ot,sr:h})}th(){const t=this.$t.Or();if(t!==null){const i=Ui(this.eh(),t.Er);t.Vr=i.Vr,t.ke=i.ke,t.ot=i.ot}}eh(){return this.Qr()?performance.now()-this.qr:2599}}function ut(e,t){return As(Math.min(Math.max(e,12),30)*t)}function bt(e,t){switch(e){case"arrowDown":case"arrowUp":return ut(t,1);case"circle":return ut(t,.8);case"square":return ut(t,.7)}}function Ns(e){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(ut(e,1))}function Ii(e){return Math.max(ut(e,.1),3)}function Xs(e,t,i,s,n){const h=bt("square",i),r=(h-1)/2,o=e-r,l=t-r;return s>=o&&s<=o+h&&n>=l&&n<=l+h}function Yi(e,t,i,s,n){const h=(bt("arrowUp",n)-1)/2,r=(As(n/2)-1)/2;t.beginPath(),e?(t.moveTo(i-h,s),t.lineTo(i,s-h),t.lineTo(i+h,s),t.lineTo(i+r,s),t.lineTo(i+r,s+h),t.lineTo(i-r,s+h),t.lineTo(i-r,s)):(t.moveTo(i-h,s),t.lineTo(i,s+h),t.lineTo(i+h,s),t.lineTo(i+r,s),t.lineTo(i+r,s-h),t.lineTo(i-r,s-h),t.lineTo(i-r,s)),t.fill()}function on(e,t,i,s,n,h){return Xs(t,i,s,n,h)}class ln extends G{constructor(){super(...arguments),this.Vt=null,this.br=new gt,this.j=-1,this.$="",this.rh=""}it(t){this.Vt=t}gr(t,i){this.j===t&&this.$===i||(this.j=t,this.$=i,this.rh=it(t,i),this.br.ur())}Pr(t,i){if(this.Vt===null||this.Vt.nt===null)return null;for(let s=this.Vt.nt.from;s<this.Vt.nt.to;s++){const n=this.Vt.st[s];if(cn(n,t,i))return{Dr:n.hh,Rr:n.Rr}}return null}K({context:t},i,s){if(this.Vt!==null&&this.Vt.nt!==null){t.textBaseline="middle",t.font=this.rh;for(let n=this.Vt.nt.from;n<this.Vt.nt.to;n++){const h=this.Vt.st[n];h.Jt!==void 0&&(h.Jt.Hi=this.br.xi(t,h.Jt.lh),h.Jt.Et=this.j,h.Jt.et=h.et-h.Jt.Hi/2),an(h,t)}}}}function an(e,t){t.fillStyle=e.A,e.Jt!==void 0&&function(i,s,n,h){i.fillText(s,n,h)}(t,e.Jt.lh,e.Jt.et,e.Jt.rt),function(i,s){if(i.Fs!==0){switch(i.ah){case"arrowDown":return void Yi(!1,s,i.et,i.rt,i.Fs);case"arrowUp":return void Yi(!0,s,i.et,i.rt,i.Fs);case"circle":return void function(n,h,r,o){const l=(bt("circle",o)-1)/2;n.beginPath(),n.arc(h,r,l,0,2*Math.PI,!1),n.fill()}(s,i.et,i.rt,i.Fs);case"square":return void function(n,h,r,o){const l=bt("square",o),a=(l-1)/2,c=h-a,u=r-a;n.fillRect(c,u,l,l)}(s,i.et,i.rt,i.Fs)}i.ah}}(e,t)}function cn(e,t,i){return!(e.Jt===void 0||!function(s,n,h,r,o,l){const a=r/2;return o>=s&&o<=s+h&&l>=n-a&&l<=n+a}(e.Jt.et,e.Jt.rt,e.Jt.Hi,e.Jt.Et,t,i))||function(s,n,h){if(s.Fs===0)return!1;switch(s.ah){case"arrowDown":case"arrowUp":return on(0,s.et,s.rt,s.Fs,n,h);case"circle":return function(r,o,l,a,c){const u=2+bt("circle",l)/2,d=r-a,f=o-c;return Math.sqrt(d*d+f*f)<=u}(s.et,s.rt,s.Fs,n,h);case"square":return Xs(s.et,s.rt,s.Fs,n,h)}}(e,t,i)}function un(e,t,i,s,n,h,r,o,l){const a=F(i)?i:i.de,c=F(i)?i:i.ue,u=F(i)?i:i.ce,d=F(t.size)?Math.max(t.size,0):1,f=Ns(o.Gs())*d,p=f/2;switch(e.Fs=f,t.position){case"inBar":return e.rt=r.At(a,l),void(e.Jt!==void 0&&(e.Jt.rt=e.rt+p+h+.6*n));case"aboveBar":return e.rt=r.At(c,l)-p-s.oh,e.Jt!==void 0&&(e.Jt.rt=e.rt-p-.6*n,s.oh+=1.2*n),void(s.oh+=f+h);case"belowBar":return e.rt=r.At(u,l)+p+s._h,e.Jt!==void 0&&(e.Jt.rt=e.rt+p+h+.6*n,s._h+=1.2*n),void(s._h+=f+h)}t.position}class dn{constructor(t,i){this.bt=!0,this.uh=!0,this.dh=!0,this.fh=null,this.$t=new ln,this.Zr=t,this.Ui=i,this.Vt={st:[],nt:null}}wt(t){this.bt=!0,this.dh=!0,t==="data"&&(this.uh=!0)}St(t){if(!this.Zr.Tt())return null;this.bt&&this.ph();const i=this.Ui.W().layout;return this.$t.gr(i.fontSize,i.fontFamily),this.$t.it(this.Vt),this.$t}mh(){if(this.dh){if(this.Zr.bh().length>0){const t=this.Ui.yt().Gs(),i=Ii(t),s=1.5*Ns(t)+2*i;this.fh={above:s,below:s}}else this.fh=null;this.dh=!1}return this.fh}ph(){const t=this.Zr.Bt(),i=this.Ui.yt(),s=this.Zr.bh();this.uh&&(this.Vt.st=s.map(c=>({ut:c.time,et:0,rt:0,Fs:0,ah:c.shape,A:c.color,hh:c.internalId,Rr:c.id,Jt:void 0})),this.uh=!1);const n=this.Ui.W().layout;this.Vt.nt=null;const h=i.zs();if(h===null)return;const r=this.Zr.Pt();if(r===null||this.Vt.st.length===0)return;let o=NaN;const l=Ii(i.Gs()),a={oh:l,_h:l};this.Vt.nt=ks(this.Vt.st,h,!0);for(let c=this.Vt.nt.from;c<this.Vt.nt.to;c++){const u=s[c];u.time!==o&&(a.oh=l,a._h=l,o=u.time);const d=this.Vt.st[c];d.et=i.It(u.time),u.text!==void 0&&u.text.length>0&&(d.Jt={lh:u.text,et:0,rt:0,Hi:0,Et:0});const f=this.Zr.gh(u.time);f!==null&&un(d,u,f,a,n.fontSize,l,t,i,r.Lt)}this.bt=!1}}class fn extends Ci{constructor(t){super(t)}Lr(){const t=this.Ar;t.Tt=!1;const i=this.Ps.W();if(!i.priceLineVisible||!this.Ps.Tt())return;const s=this.Ps.ih(i.priceLineSource===0);s.nh||(t.Tt=!0,t.rt=s.yi,t.A=this.Ps.wh(s.A),t.ht=i.priceLineWidth,t.Wt=i.priceLineStyle)}}class pn extends bi{constructor(t){super(),this.Ht=t}Ii(t,i,s){t.Tt=!1,i.Tt=!1;const n=this.Ht;if(!n.Tt())return;const h=n.W(),r=h.lastValueVisible,o=n.Mh()!=="",l=h.seriesLastValueMode===0,a=n.ih(!1);if(a.nh)return;r&&(t.Jt=this.Sh(a,r,l),t.Tt=t.Jt.length!==0),(o||l)&&(i.Jt=this.xh(a,r,o,l),i.Tt=i.Jt.length>0);const c=n.wh(a.A),u=Nt(c);s.t=u.t,s.yi=a.yi,i.Nt=n.Yt().Ot(a.yi/n.Bt().Et()),t.Nt=c,t.A=u.i,i.A=u.i}xh(t,i,s,n){let h="";const r=this.Ht.Mh();return s&&r.length!==0&&(h+=`${r} `),i&&n&&(h+=this.Ht.Bt().kh()?t.yh:t.Ch),h.trim()}Sh(t,i,s){return i?s?this.Ht.Bt().kh()?t.Ch:t.yh:t.Jt:""}}class V{constructor(t,i){this.Th=t,this.Ph=i}Rh(t){return t!==null&&this.Th===t.Th&&this.Ph===t.Ph}Dh(){return new V(this.Th,this.Ph)}Ah(){return this.Th}Bh(){return this.Ph}Lh(){return this.Ph-this.Th}Fi(){return this.Ph===this.Th||Number.isNaN(this.Ph)||Number.isNaN(this.Th)}ts(t){return t===null?this:new V(Math.min(this.Ah(),t.Ah()),Math.max(this.Bh(),t.Bh()))}Nh(t){if(!F(t)||this.Ph-this.Th===0)return;const i=.5*(this.Ph+this.Th);let s=this.Ph-i,n=this.Th-i;s*=t,n*=t,this.Ph=i+s,this.Th=i+n}Oh(t){F(t)&&(this.Ph+=t,this.Th+=t)}Eh(){return{minValue:this.Th,maxValue:this.Ph}}static Ih(t){return t===null?null:new V(t.minValue,t.maxValue)}}class At{constructor(t,i){this.Vh=t,this.zh=i||null}Fh(){return this.Vh}Wh(){return this.zh}Eh(){return this.Vh===null?null:{priceRange:this.Vh.Eh(),margins:this.zh||void 0}}static Ih(t){return t===null?null:new At(V.Ih(t.priceRange),t.margins)}}class mn extends Ci{constructor(t,i){super(t),this.jh=i}Lr(){const t=this.Ar;t.Tt=!1;const i=this.jh.W();if(!this.Ps.Tt()||!i.lineVisible)return;const s=this.jh.$h();if(s===null)return;let n;i.index!==void 0&&(n=this.Rs.yt().It(i.index)),t.Tt=!0,t.rt=s,t.et=n,t.A=i.color,t.ht=i.lineWidth,t.Wt=i.lineStyle,t.Rr=this.jh.W().id}}class gn extends bi{constructor(t,i){super(),this.Zr=t,this.jh=i}Ii(t,i,s){t.Tt=!1,i.Tt=!1;const n=this.jh.W(),h=n.axisLabelVisible,r=n.title!=="",o=this.Zr;if(!h||!o.Tt())return;const l=this.jh.$h();if(l===null)return;r&&(i.Jt=n.title,i.Tt=!0),i.Nt=o.Yt().Ot(l/o.Bt().Et()),t.Jt=this.Hh(n.price),t.Tt=!0;const a=Nt(n.axisLabelColor||n.color);s.t=a.t;const c=n.axisLabelTextColor||a.i;t.A=c,i.A=c,s.yi=l}Hh(t){const i=this.Zr.Pt();return i===null?"":this.Zr.Bt().Wi(t,i.Lt)}}class bn{constructor(t,i){this.Zr=t,this.cn=i,this.Uh=new mn(t,this),this.wr=new gn(t,this),this.Yh=new Os(this.wr,t,t.Yt())}qh(t){B(this.cn,t),this.wt(),this.Zr.Yt().Xh()}W(){return this.cn}Zh(){return this.Uh}Kh(){return this.Yh}Gh(){return this.wr}wt(){this.Uh.wt(),this.wr.wt()}$h(){const t=this.Zr,i=t.Bt();if(t.Yt().yt().Fi()||i.Fi())return null;const s=t.Pt();return s===null?null:i.At(this.cn.price,s.Lt)}}class vn extends vi{constructor(t){super(),this.Ui=t}Yt(){return this.Ui}}const Qt={Jh:4,Qh:1e-4};function K(e,t){const i=100*(e-t)/t;return t<0?-i:i}function wn(e,t){const i=K(e.Ah(),t),s=K(e.Bh(),t);return new V(i,s)}function dt(e,t){const i=100*(e-t)/t+100;return t<0?-i:i}function Sn(e,t){const i=dt(e.Ah(),t),s=dt(e.Bh(),t);return new V(i,s)}function Wt(e,t){const i=Math.abs(e);if(i<1e-15)return 0;const s=Bs(i+t.Qh)+t.Jh;return e<0?-s:s}function ft(e,t){const i=Math.abs(e);if(i<1e-15)return 0;const s=Math.pow(10,i-t.Jh)-t.Qh;return e<0?-s:s}function rt(e,t){if(e===null)return null;const i=Wt(e.Ah(),t),s=Wt(e.Bh(),t);return new V(i,s)}function at(e,t){if(e===null)return null;const i=ft(e.Ah(),t),s=ft(e.Bh(),t);return new V(i,s)}function qt(e){if(e===null)return Qt;const t=Math.abs(e.Bh()-e.Ah());if(t>=1||t<1e-15)return Qt;const i=Math.ceil(Math.abs(Math.log10(t))),s=Qt.Jh+i;return{Jh:s,Qh:1/Math.pow(10,s)}}const Cn={Bar:(e,t,i,s)=>{var n;const h=t.upColor,r=t.downColor,o=g(e(i,s)),l=lt(o.Lt[0])<=lt(o.Lt[3]);return{ne:(n=o.A)!==null&&n!==void 0?n:l?h:r}},Candlestick:(e,t,i,s)=>{var n,h,r;const o=t.upColor,l=t.downColor,a=t.borderUpColor,c=t.borderDownColor,u=t.wickUpColor,d=t.wickDownColor,f=g(e(i,s)),p=lt(f.Lt[0])<=lt(f.Lt[3]);return{ne:(n=f.A)!==null&&n!==void 0?n:p?o:l,Ue:(h=f.Nt)!==null&&h!==void 0?h:p?a:c,He:(r=f.tl)!==null&&r!==void 0?r:p?u:d}},Area:(e,t,i,s)=>{var n,h,r,o;const l=g(e(i,s));return{ne:(n=l._t)!==null&&n!==void 0?n:t.lineColor,_t:(h=l._t)!==null&&h!==void 0?h:t.lineColor,gs:(r=l.gs)!==null&&r!==void 0?r:t.topColor,ws:(o=l.ws)!==null&&o!==void 0?o:t.bottomColor}},BrokenArea:(e,t,i,s)=>{var n;return{ne:(n=g(e(i,s)).A)!==null&&n!==void 0?n:t.color,_t:t.strokeColor}},CloudArea:(e,t,i,s)=>{const n=g(e(i,s));return{ne:n.Lt[3]>=n.Lt[0]?t.positiveColor:t.negativeColor,Xe:t.negativeColor,qe:t.positiveColor,il:t.higherLineColor,nl:t.lowerLineColor}},Baseline:(e,t,i,s)=>{var n,h,r,o,l,a;const c=g(e(i,s));return{ne:c.Lt[3]>=t.baseValue.price?t.topLineColor:t.bottomLineColor,ge:(n=c.ge)!==null&&n!==void 0?n:t.topLineColor,we:(h=c.we)!==null&&h!==void 0?h:t.bottomLineColor,fe:(r=c.fe)!==null&&r!==void 0?r:t.topFillColor1,pe:(o=c.pe)!==null&&o!==void 0?o:t.topFillColor2,ve:(l=c.ve)!==null&&l!==void 0?l:t.bottomFillColor1,me:(a=c.me)!==null&&a!==void 0?a:t.bottomFillColor2}},Line:(e,t,i,s)=>{var n,h;const r=g(e(i,s));return{ne:(n=r.A)!==null&&n!==void 0?n:t.color,_t:(h=r.A)!==null&&h!==void 0?h:t.color}},Histogram:(e,t,i,s)=>{var n;return{ne:(n=g(e(i,s)).A)!==null&&n!==void 0?n:t.color}}};class yn{constructor(t){this.sl=(i,s)=>s!==void 0?s.Lt:this.Zr.On().el(i),this.Zr=t,this.rl=Cn[t.hl()]}Ns(t,i){return this.rl(this.sl,this.Zr.W(),t,i)}}var Di;(function(e){e[e.NearestLeft=-1]="NearestLeft",e[e.None=0]="None",e[e.NearestRight=1]="NearestRight"})(Di||(Di={}));const X=30;class xn{constructor(){this.ll=[],this.al=new Map,this.ol=new Map}_l(){return this.Fs()>0?this.ll[this.ll.length-1]:null}ul(){return this.Fs()>0?this.cl(0):null}Nn(){return this.Fs()>0?this.cl(this.ll.length-1):null}Fs(){return this.ll.length}Fi(){return this.Fs()===0}sh(t){return this.dl(t,0)!==null}el(t){return this.fl(t)}fl(t,i=0){const s=this.dl(t,i);return s===null?null:Object.assign(Object.assign({},this.pl(s)),{Xs:this.cl(s)})}Ys(){return this.ll}vl(t,i,s){if(this.Fi())return null;let n=null;for(const h of s)n=xt(n,this.ml(t,i,h));return n}it(t){this.ol.clear(),this.al.clear(),this.ll=t}cl(t){return this.ll[t].Xs}pl(t){return this.ll[t]}dl(t,i){const s=this.bl(t);if(s===null&&i!==0)switch(i){case-1:return this.gl(t);case 1:return this.wl(t);default:throw new TypeError("Unknown search mode")}return s}gl(t){let i=this.Ml(t);return i>0&&(i-=1),i!==this.ll.length&&this.cl(i)<t?i:null}wl(t){const i=this.Sl(t);return i!==this.ll.length&&t<this.cl(i)?i:null}bl(t){const i=this.Ml(t);return i===this.ll.length||t<this.ll[i].Xs?null:i}Ml(t){return wt(this.ll,t,(i,s)=>i.Xs<s)}Sl(t){return Rs(this.ll,t,(i,s)=>s.Xs>i)}xl(t,i,s){let n=null;for(let h=t;h<i;h++){const r=this.ll[h].Lt[s];Number.isNaN(r)||(n===null?n={kl:r,yl:r}:(r<n.kl&&(n.kl=r),r>n.yl&&(n.yl=r)))}return n}ml(t,i,s){if(this.Fi())return null;let n=null;const h=g(this.ul()),r=g(this.Nn()),o=Math.max(t,h),l=Math.min(i,r),a=Math.ceil(o/X)*X,c=Math.max(a,Math.floor(l/X)*X);{const d=this.Ml(o),f=this.Sl(Math.min(l,a,i));n=xt(n,this.xl(d,f,s))}let u=this.al.get(s);u===void 0&&(u=new Map,this.al.set(s,u));for(let d=Math.max(a+1,o);d<c;d+=X){const f=Math.floor(d/X);let p=u.get(f);if(p===void 0){const m=this.Ml(f*X),b=this.Sl((f+1)*X-1);p=this.xl(m,b,s),u.set(f,p)}n=xt(n,p)}{const d=this.Ml(c),f=this.Sl(l);n=xt(n,this.xl(d,f,s))}return n}}function xt(e,t){return e===null?t:t===null?e:{kl:Math.min(e.kl,t.kl),yl:Math.max(e.yl,t.yl)}}class yi extends vn{constructor(t,i,s){super(t),this.Vt=new xn,this.Uh=new fn(this),this.Cl=[],this.Tl=new en(this),this.Pl=null,this.Rl=null,this.Dl=[],this.Al=[],this.Bl=null,this.cn=i,this.Ll=s;const n=new pn(this);this.hn=[n],this.Yh=new Os(n,this,t),s!=="Area"&&s!=="Line"&&s!=="Baseline"||(this.Pl=new rn(this)),this.Nl(),this.Ol()}S(){this.Bl!==null&&clearTimeout(this.Bl)}wh(t){return this.cn.priceLineColor||t}ih(t){const i={nh:!0},s=this.Bt();if(this.Yt().yt().Fi()||s.Fi()||this.Vt.Fi())return i;const n=this.Yt().yt().zs(),h=this.Pt();if(n===null||h===null)return i;let r,o;if(t){const u=this.Vt._l();if(u===null)return i;r=u,o=u.Xs}else{const u=this.Vt.fl(n.di(),-1);if(u===null||(r=this.Vt.el(u.Xs),r===null))return i;o=u.Xs}const l=r.Lt[3],a=this.Os().Ns(o,{Lt:r}),c=s.At(l,h.Lt);return{nh:!1,ct:l,Jt:s.Wi(l,h.Lt),yh:s.El(l),Ch:s.Il(l,h.Lt),A:a.ne,yi:c,Xs:o}}Os(){return this.Rl!==null||(this.Rl=new yn(this)),this.Rl}W(){return this.cn}qh(t){const i=t.priceScaleId;i!==void 0&&i!==this.cn.priceScaleId&&this.Yt().Vl(this,i),B(this.cn,t),t.priceFormat!==void 0&&(this.Nl(),this.Yt().zl()),this.Yt().Fl(this),this.gn.wt("options")}it(t,i){this.Vt.it(t),this.Wl(),this.gn.wt("data"),this.dn.wt("data"),this.Pl!==null&&(i&&i.jl?this.Pl.Gr():t.length===0&&this.Pl.Kr());const s=this.Yt().Sr(this);this.Yt().$l(s),this.Yt().Fl(this),this.Yt().Xh()}Hl(t){this.Dl=t,this.Wl();const i=this.Yt().Sr(this);this.dn.wt("data"),this.Yt().$l(i),this.Yt().Fl(this),this.Yt().Xh()}Ul(){return this.Dl}bh(){return this.Al}Yl(t){const i=new bn(this,t);return this.Cl.push(i),this.Yt().Fl(this),i}ql(t){const i=this.Cl.indexOf(t);i!==-1&&this.Cl.splice(i,1),this.Yt().Fl(this)}Xl(t,i){const s=this.Bt();let n=s.Fh();s.Zl()&&(n=at(n,s.Kl()));let h=1e-4;n&&(h=16/s.Et()*(Math.abs(n.Lh())/t));for(let r=0;r<this.Cl.length;r++){const o=this.Cl[r],{price:l,index:a}=this.Cl[r].W();if((i===void 0||a===void 0||i>=a)&&Math.abs(Math.abs(l-t)/t)<Math.abs(h))return o}return null}Gl(){this.Cl.splice(0,this.Cl.length)}hl(){return this.Ll}Pt(){const t=this.Jl();return t===null?null:{Lt:t.Lt[3],Ql:t.ut}}Jl(){const t=this.Yt().yt().zs();if(t===null)return null;const i=t.Ss();return this.Vt.fl(i,1)}On(){return this.Vt}gh(t){const i=this.Vt.el(t);return i===null?null:this.Ll==="Bar"||this.Ll==="Candlestick"?{_e:i.Lt[0],ue:i.Lt[1],ce:i.Lt[2],de:i.Lt[3]}:i.Lt[3]}ta(t){const i=this.Pl;return i!==null&&i.Tt()?(this.Bl===null&&i.Qr()&&(this.Bl=setTimeout(()=>{this.Bl=null,this.Yt().ia()},0)),i.Jr(),[i]):[]}Pn(){const t=[];this.na()||t.push(this.Tl),t.push(this.gn,this.Uh,this.dn);const i=this.Cl.map(s=>s.Zh());return t.push(...i),t}Qi(t){return[this.Yh,...this.Cl.map(i=>i.Kh())]}Rn(t,i){if(i!==this.Xi&&!this.na())return[];const s=[...this.hn];for(const n of this.Cl)s.push(n.Gh());return s}sa(t,i){if(this.cn.autoscaleInfoProvider!==void 0){const s=this.cn.autoscaleInfoProvider(()=>{const n=this.ea(t,i);return n===null?null:n.Eh()});return At.Ih(s)}return this.ea(t,i)}ra(){return this.cn.priceFormat.minMove}ha(){return this.la}An(){var t;this.gn.wt(),this.dn.wt();for(const i of this.hn)i.wt();for(const i of this.Cl)i.wt();this.Uh.wt(),this.Tl.wt(),(t=this.Pl)===null||t===void 0||t.wt()}Bt(){return g(super.Bt())}Ct(t){if(!((this.Ll==="Line"||this.Ll==="Area"||this.Ll==="Baseline")&&this.cn.crosshairMarkerVisible))return null;const i=this.Vt.el(t);return i===null?null:{ct:i.Lt[3],ot:this.aa(),Nt:this.oa(),Dt:this._a(),Rt:this.ua(t)}}Mh(){return this.cn.title}Tt(){return this.cn.visible}Oe(t){this.gn.Oe(t)}na(){return!$t(this.Bt().Ve())}ea(t,i){if(!mt(t)||!mt(i)||this.Vt.Fi())return null;const s=this.Ll==="Line"||this.Ll==="Area"||this.Ll==="Baseline"||this.Ll==="Histogram"?[3]:[2,1],n=this.Vt.vl(t,i,s);let h=n!==null?new V(n.kl,n.yl):null;if(this.hl()==="Histogram"){const r=this.cn.base,o=new V(r,r);h=h!==null?h.ts(o):o}return new At(h,this.dn.mh())}aa(){switch(this.Ll){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerRadius}return 0}oa(){switch(this.Ll){case"Line":case"Area":case"Baseline":{const t=this.cn.crosshairMarkerBorderColor;if(t.length!==0)return t}}return null}_a(){switch(this.Ll){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerBorderWidth}return 0}ua(t){switch(this.Ll){case"Line":case"Area":case"Baseline":{const i=this.cn.crosshairMarkerBackgroundColor;if(i.length!==0)return i}}return this.Os().Ns(t).ne}Nl(){switch(this.cn.priceFormat.type){case"custom":this.la={format:this.cn.priceFormat.formatter};break;case"volume":this.la=new Re(this.cn.priceFormat.precision);break;case"percent":this.la=new Ls(this.cn.priceFormat.precision);break;default:{const t=Math.pow(10,this.cn.priceFormat.precision);this.la=new Ut(t,this.cn.priceFormat.minMove*t)}}this.Xi!==null&&this.Xi.ca()}Wl(){const t=this.Yt().yt();if(!t.da()||this.Vt.Fi())return void(this.Al=[]);const i=g(this.Vt.ul());this.Al=this.Dl.map((s,n)=>{const h=g(t.fa(s.time,!0)),r=h<i?1:-1;return{time:g(this.Vt.fl(h,r)).Xs,position:s.position,shape:s.shape,color:s.color,id:s.id,internalId:n,text:s.text,size:s.size}})}Ol(){switch(this.dn=new dn(this,this.Yt()),this.Ll){case"Bar":this.gn=new $e(this,this.Yt());break;case"Candlestick":this.gn=new Je(this,this.Yt());break;case"Line":this.gn=new qe(this,this.Yt());break;case"Area":this.gn=new Ne(this,this.Yt());break;case"CloudArea":this.gn=new Ge(this,this.Yt());break;case"BrokenArea":this.gn=new je(this,this.Yt());break;case"Baseline":this.gn=new Ye(this,this.Yt());break;case"Histogram":this.gn=new Qe(this,this.Yt());break;default:throw Error("Unknown chart style assigned: "+this.Ll)}}}class Mn{constructor(t){this.cn=t}pa(t,i,s){let n=t;if(this.cn.mode===0)return n;const h=s.pn(),r=h.Pt();if(r===null)return n;const o=h.At(t,r),l=s.va().filter(c=>c instanceof yi).reduce((c,u)=>{if(s.kr(u)||!u.Tt())return c;const d=u.Bt(),f=u.On();if(d.Fi()||!f.sh(i))return c;const p=f.el(i);if(p===null)return c;const m=lt(u.Pt());return c.concat([d.At(p.Lt[3],m.Lt)])},[]);if(l.length===0)return n;l.sort((c,u)=>Math.abs(c-o)-Math.abs(u-o));const a=l[0];return n=h.vn(a,r),n}}class _n extends Z{constructor(){super(...arguments),this.Vt=null}it(t){this.Vt=t}K({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:n}){if(this.Vt===null)return;const h=Math.max(1,Math.floor(s));t.lineWidth=h,function(r,o){r.save(),r.lineWidth%2&&r.translate(.5,.5),o(),r.restore()}(t,()=>{const r=g(this.Vt);if(r.ma){t.strokeStyle=r.ba,j(t,r.ga),t.beginPath();for(const o of r.wa){const l=Math.round(o.Ma*s);t.moveTo(l,-h),t.lineTo(l,i.height+h)}t.stroke()}if(r.Sa){t.strokeStyle=r.xa,j(t,r.ka),t.beginPath();for(const o of r.ya){const l=Math.round(o.Ma*n);t.moveTo(-h,l),t.lineTo(i.width+h,l)}t.stroke()}})}}class Vn{constructor(t){this.$t=new _n,this.bt=!0,this.nn=t}wt(){this.bt=!0}St(){if(this.bt){const t=this.nn.Yt().W().grid,i={Sa:t.horzLines.visible,ma:t.vertLines.visible,xa:t.horzLines.color,ba:t.vertLines.color,ka:t.horzLines.style,ga:t.vertLines.style,ya:this.nn.pn().Ca(),wa:this.nn.Yt().yt().Ca()||[]};this.$t.it(i),this.bt=!1}return this.$t}}class Tn{constructor(t){this.gn=new Vn(t)}Zh(){return this.gn}}class Kt{constructor(t,i){if(this.Ta=t,this.Pa=i,function(s){if(s<0)return!1;for(let n=s;n>1;n/=10)if(n%10!=0)return!1;return!0}(this.Ta))this.Ra=[2,2.5,2];else{this.Ra=[];for(let s=this.Ta;s!==1;){if(s%2==0)this.Ra.push(2),s/=2;else{if(s%5!=0)throw new Error("unexpected base");this.Ra.push(2,2.5),s/=5}if(this.Ra.length>100)throw new Error("something wrong with base")}}}Da(t,i,s){const n=this.Ta===0?0:1/this.Ta;let h=Math.pow(10,Math.max(0,Math.ceil(Bs(t-i)))),r=0,o=this.Pa[0];for(;;){const u=yt(h,n,1e-14)&&h>n+1e-14,d=yt(h,s*o,1e-14),f=yt(h,1,1e-14);if(!(u&&d&&f))break;h/=o,o=this.Pa[++r%this.Pa.length]}if(h<=n+1e-14&&(h=n),h=Math.max(1,h),this.Ra.length>0&&(l=h,a=1,c=1e-14,Math.abs(l-a)<c))for(r=0,o=this.Ra[0];yt(h,s*o,1e-14)&&h>n+1e-14;)h/=o,o=this.Ra[++r%this.Ra.length];var l,a,c;return h}}class ji{constructor(t,i,s,n){this.Aa=[],this.Vi=t,this.Ta=i,this.Ba=s,this.La=n}Da(t,i){if(t<i)throw new Error("high < low");const s=this.Vi.Et(),n=(t-i)*this.Na()/s,h=new Kt(this.Ta,[2,2.5,2]),r=new Kt(this.Ta,[2,2,2.5]),o=new Kt(this.Ta,[2.5,2,2]),l=[];return l.push(h.Da(t,i,n),r.Da(t,i,n),o.Da(t,i,n)),function(a){if(a.length<1)throw Error("array is empty");let c=a[0];for(let u=1;u<a.length;++u)a[u]<c&&(c=a[u]);return c}(l)}Oa(){const t=this.Vi,i=t.Pt();if(i===null)return void(this.Aa=[]);const s=t.Et(),n=this.Ba(s-1,i),h=this.Ba(0,i),r=this.Vi.W().entireTextOnly?this.Ea()/2:0,o=r,l=s-1-r,a=Math.max(n,h),c=Math.min(n,h);if(a===c)return void(this.Aa=[]);let u=this.Da(a,c),d=a%u;d+=d<0?u:0;const f=a>=c?1:-1;let p=null,m=0;for(let b=a-d;b>c;b-=u){const v=this.La(b,i,!0);p!==null&&Math.abs(v-p)<this.Na()||v<o||v>l||(m<this.Aa.length?(this.Aa[m].Ma=v,this.Aa[m].Ce=t.Ia(b)):this.Aa.push({Ma:v,Ce:t.Ia(b)}),m++,p=v,t.Zl()&&(u=this.Da(b*f,c)))}this.Aa.length=m}Ca(){return this.Aa}Ea(){return this.Vi.P()}Na(){return Math.ceil(2.5*this.Ea())}}function $s(e){return e.slice().sort((t,i)=>g(t.Ki())-g(i.Ki()))}var Hi;(function(e){e[e.Normal=0]="Normal",e[e.Logarithmic=1]="Logarithmic",e[e.Percentage=2]="Percentage",e[e.IndexedTo100=3]="IndexedTo100"})(Hi||(Hi={}));const Ji=new Ls,Gi=new Ut(100,1);class Ln{constructor(t,i,s,n){this.Va=0,this.za=null,this.Vh=null,this.Fa=null,this.Wa={ja:!1,$a:null},this.Ha=0,this.Ua=0,this.Ya=new _,this.qa=new _,this.Xa=[],this.Za=null,this.Ka=null,this.Ga=null,this.Ja=null,this.la=Gi,this.Qa=qt(null),this.io=t,this.cn=i,this.no=s,this.so=n,this.eo=new ji(this,100,this.ro.bind(this),this.ho.bind(this))}Ve(){return this.io}W(){return this.cn}qh(t){if(B(this.cn,t),this.ca(),t.mode!==void 0&&this.lo({Nr:t.mode}),t.scaleMargins!==void 0){const i=P(t.scaleMargins.top),s=P(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(s<0||s>1||i+s>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${s}`);if(i+s>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+s}`);this.ao(),this.Ka=null}}oo(){return this.cn.autoScale}Zl(){return this.cn.mode===1}kh(){return this.cn.mode===2}_o(){return this.cn.mode===3}Nr(){return{Wn:this.cn.autoScale,uo:this.cn.invertScale,Nr:this.cn.mode}}lo(t){const i=this.Nr();let s=null;t.Wn!==void 0&&(this.cn.autoScale=t.Wn),t.Nr!==void 0&&(this.cn.mode=t.Nr,t.Nr!==2&&t.Nr!==3||(this.cn.autoScale=!0),this.Wa.ja=!1),i.Nr===1&&t.Nr!==i.Nr&&(function(h,r){if(h===null)return!1;const o=ft(h.Ah(),r),l=ft(h.Bh(),r);return isFinite(o)&&isFinite(l)}(this.Vh,this.Qa)?(s=at(this.Vh,this.Qa),s!==null&&this.co(s)):this.cn.autoScale=!0),t.Nr===1&&t.Nr!==i.Nr&&(s=rt(this.Vh,this.Qa),s!==null&&this.co(s));const n=i.Nr!==this.cn.mode;n&&(i.Nr===2||this.kh())&&this.ca(),n&&(i.Nr===3||this._o())&&this.ca(),t.uo!==void 0&&i.uo!==t.uo&&(this.cn.invertScale=t.uo,this.do()),this.qa.m(i,this.Nr())}fo(){return this.qa}P(){return this.no.fontSize}Et(){return this.Va}po(t){this.Va!==t&&(this.Va=t,this.ao(),this.Ka=null)}vo(){if(this.za)return this.za;const t=this.Et()-this.mo()-this.bo();return this.za=t,t}Fh(){return this.wo(),this.Vh}Kl(){return this.Qa}co(t,i){const s=this.Vh;(i||s===null&&t!==null||s!==null&&!s.Rh(t))&&(this.Ka=null,this.Vh=t)}Fi(){return this.wo(),this.Va===0||!this.Vh||this.Vh.Fi()}Mo(t){return this.uo()?t:this.Et()-1-t}At(t,i){return this.kh()?t=K(t,i):this._o()&&(t=dt(t,i)),this.ho(t,i)}Hs(t,i,s){this.wo();const n=this.bo(),h=g(this.Fh()),r=h.Ah(),o=h.Bh(),l=this.vo()-1,a=this.uo(),c=l/(o-r),u=s===void 0?0:s.from,d=s===void 0?t.length:s.to,f=this.So();for(let p=u;p<d;p++){const m=t[p],b=m.ct;if(isNaN(b))continue;let v=b;f!==null&&(v=f(m.ct,i));const w=n+c*(v-r),C=a?w:this.Va-1-w;m.rt=C}}Ae(t,i,s){this.wo();const n=this.bo(),h=g(this.Fh()),r=h.Ah(),o=h.Bh(),l=this.vo()-1,a=this.uo(),c=l/(o-r),u=s===void 0?0:s.from,d=s===void 0?t.length:s.to,f=this.So();for(let p=u;p<d;p++){const m=t[p],b=m.Be,v=m.Le;if(isNaN(b)||isNaN(v))continue;let w=b,C=v;f!==null&&(w=f(m.Be,i),C=f(m.Le,i));let S=n+c*(w-r),x=a?S:this.Va-1-S;m.Te=Math.round(x),S=n+c*(C-r),x=a?S:this.Va-1-S,m.Re=Math.round(x)}}ae(t,i,s){this.wo();const n=this.bo(),h=g(this.Fh()),r=h.Ah(),o=h.Bh(),l=this.vo()-1,a=this.uo(),c=l/(o-r),u=s===void 0?0:s.from,d=s===void 0?t.length:s.to,f=this.So();for(let p=u;p<d;p++){const m=t[p];let b=m._e,v=m.ue,w=m.ce,C=m.de;f!==null&&(b=f(m._e,i),v=f(m.ue,i),w=f(m.ce,i),C=f(m.de,i));let S=n+c*(b-r),x=a?S:this.Va-1-S;m.he=x,S=n+c*(v-r),x=a?S:this.Va-1-S,m.se=x,S=n+c*(w-r),x=a?S:this.Va-1-S,m.ee=x,S=n+c*(C-r),x=a?S:this.Va-1-S,m.le=x}}vn(t,i){const s=this.ro(t,i);return this.xo(s,i)}xo(t,i){let s=t;return this.kh()?s=function(n,h){return h<0&&(n=-n),n/100*h+h}(s,i):this._o()&&(s=function(n,h){return n-=100,h<0&&(n=-n),n/100*h+h}(s,i)),s}va(){return this.Xa}ko(){if(this.Za)return this.Za;let t=[];for(let i=0;i<this.Xa.length;i++){const s=this.Xa[i];s.Ki()===null&&s.Gi(i+1),t.push(s)}return t=$s(t),this.Za=t,this.Za}yo(t){this.Xa.indexOf(t)===-1&&(this.Xa.push(t),this.ca(),this.Co())}To(t){const i=this.Xa.indexOf(t);if(i===-1)throw new Error("source is not attached to scale");this.Xa.splice(i,1),this.Xa.length===0&&(this.lo({Wn:!0}),this.co(null)),this.ca(),this.Co()}Pt(){let t=null;for(const i of this.Xa){const s=i.Pt();s!==null&&(t===null||s.Ql<t.Ql)&&(t=s)}return t===null?null:t.Lt}uo(){return this.cn.invertScale}Ca(){const t=this.Pt()===null;if(this.Ka!==null&&(t||this.Ka.Po===t))return this.Ka.Ca;this.eo.Oa();const i=this.eo.Ca();return this.Ka={Ca:i,Po:t},this.Ya.m(),i}Ro(){return this.Ya}Do(t){this.kh()||this._o()||this.Ga===null&&this.Fa===null&&(this.Fi()||(this.Ga=this.Va-t,this.Fa=g(this.Fh()).Dh()))}Ao(t){if(this.kh()||this._o()||this.Ga===null)return;this.lo({Wn:!1}),(t=this.Va-t)<0&&(t=0);let i=(this.Ga+.2*(this.Va-1))/(t+.2*(this.Va-1));const s=g(this.Fa).Dh();i=Math.max(i,.1),s.Nh(i),this.co(s)}Bo(){this.kh()||this._o()||(this.Ga=null,this.Fa=null)}Lo(t){this.oo()||this.Ja===null&&this.Fa===null&&(this.Fi()||(this.Ja=t,this.Fa=g(this.Fh()).Dh()))}No(t){if(this.oo()||this.Ja===null)return;const i=g(this.Fh()).Lh()/(this.vo()-1);let s=t-this.Ja;this.uo()&&(s*=-1);const n=s*i,h=g(this.Fa).Dh();h.Oh(n),this.co(h,!0),this.Ka=null}Oo(){this.oo()||this.Ja!==null&&(this.Ja=null,this.Fa=null)}ha(){return this.la||this.ca(),this.la}Wi(t,i){switch(this.cn.mode){case 2:return this.ha().format(K(t,i));case 3:return this.ha().format(dt(t,i));default:return this.Hh(t)}}Ia(t){switch(this.cn.mode){case 2:case 3:return this.ha().format(t);default:return this.Hh(t)}}El(t){return this.Hh(t,g(this.Eo()).ha())}Il(t,i){return t=K(t,i),Ji.format(t)}Io(){return this.Xa}Vo(t){this.Wa={$a:t,ja:!1}}An(){this.Xa.forEach(t=>t.An())}ca(){this.Ka=null;const t=this.Eo();let i=100;t!==null&&(i=Math.round(1/t.ra())),this.la=Gi,this.kh()?(this.la=Ji,i=100):this._o()?(this.la=new Ut(100,1),i=100):t!==null&&(this.la=t.ha()),this.eo=new ji(this,i,this.ro.bind(this),this.ho.bind(this)),this.eo.Oa()}Co(){this.Za=null}Eo(){return this.Xa[0]||null}mo(){return this.uo()?this.cn.scaleMargins.bottom*this.Et()+this.Ua:this.cn.scaleMargins.top*this.Et()+this.Ha}bo(){return this.uo()?this.cn.scaleMargins.top*this.Et()+this.Ha:this.cn.scaleMargins.bottom*this.Et()+this.Ua}wo(){this.Wa.ja||(this.Wa.ja=!0,this.zo())}ao(){this.za=null}ho(t,i){if(this.wo(),this.Fi())return 0;t=this.Zl()&&t?Wt(t,this.Qa):t;const s=g(this.Fh()),n=this.bo()+(this.vo()-1)*(t-s.Ah())/s.Lh();return this.Mo(n)}ro(t,i){if(this.wo(),this.Fi())return 0;const s=this.Mo(t),n=g(this.Fh()),h=n.Ah()+n.Lh()*((s-this.bo())/(this.vo()-1));return this.Zl()?ft(h,this.Qa):h}do(){this.Ka=null,this.eo.Oa()}zo(){const t=this.Wa.$a;if(t===null)return;let i=null;const s=this.Io();let n=0,h=0;for(const l of s){if(!l.Tt())continue;const a=l.Pt();if(a===null)continue;const c=l.sa(t.Ss(),t.di());let u=c&&c.Fh();if(u!==null){switch(this.cn.mode){case 1:u=rt(u,this.Qa);break;case 2:u=wn(u,a.Lt);break;case 3:u=Sn(u,a.Lt)}if(i=i===null?u:i.ts(g(u)),c!==null){const d=c.Wh();d!==null&&(n=Math.max(n,d.above),h=Math.max(n,d.below))}}}if(n===this.Ha&&h===this.Ua||(this.Ha=n,this.Ua=h,this.Ka=null,this.ao()),i!==null){if(i.Ah()===i.Bh()){const l=this.Eo(),a=5*(l===null||this.kh()||this._o()?1:l.ra());this.Zl()&&(i=at(i,this.Qa)),i=new V(i.Ah()-a,i.Bh()+a),this.Zl()&&(i=rt(i,this.Qa))}if(this.Zl()){const l=at(i,this.Qa),a=qt(l);if(r=a,o=this.Qa,r.Jh!==o.Jh||r.Qh!==o.Qh){const c=this.Fa!==null?at(this.Fa,this.Qa):null;this.Qa=a,i=rt(l,a),c!==null&&(this.Fa=rt(c,a))}}this.co(i)}else this.Vh===null&&(this.co(new V(-.5,.5)),this.Qa=qt(null));var r,o;this.Wa.ja=!0}So(){return this.kh()?K:this._o()?dt:this.Zl()?t=>Wt(t,this.Qa):null}Hh(t,i){return this.so.priceFormatter===void 0?(i===void 0&&(i=this.ha()),i.format(t)):this.so.priceFormatter(t)}}class Pn{constructor(t,i){this.Xa=[],this.Fo=new Map,this.Va=0,this.Wo=0,this.jo=1e3,this.Za=null,this.$o=new _,this.Ho=t,this.Ui=i,this.Uo=new Tn(this);const s=i.W();this.Yo=this.qo("left",s.leftPriceScale),this.Xo=this.qo("right",s.rightPriceScale),this.Yo.fo().l(this.Zo.bind(this,this.Yo),this),this.Xo.fo().l(this.Zo.bind(this,this.Xo),this),this.Ko(s)}Ko(t){if(t.leftPriceScale&&this.Yo.qh(t.leftPriceScale),t.rightPriceScale&&this.Xo.qh(t.rightPriceScale),t.localization&&(this.Yo.ca(),this.Xo.ca()),t.overlayPriceScales){const i=Array.from(this.Fo.values());for(const s of i){const n=g(s[0].Bt());n.qh(t.overlayPriceScales),t.localization&&n.ca()}}}Go(t){switch(t){case"left":return this.Yo;case"right":return this.Xo}return this.Fo.has(t)?P(this.Fo.get(t))[0].Bt():null}S(){this.Yt().Jo().v(this),this.Yo.fo().v(this),this.Xo.fo().v(this),this.Xa.forEach(t=>{t.S&&t.S()}),this.$o.m()}Qo(){return this.jo}t_(t){this.jo=t}Yt(){return this.Ui}Hi(){return this.Wo}Et(){return this.Va}i_(t){this.Wo=t,this.n_()}po(t){this.Va=t,this.Yo.po(t),this.Xo.po(t),this.Xa.forEach(i=>{if(this.kr(i)){const s=i.Bt();s!==null&&s.po(t)}}),this.n_()}va(){return this.Xa}kr(t){const i=t.Bt();return i===null||this.Yo!==i&&this.Xo!==i}yo(t,i,s){const n=s!==void 0?s:this.e_().s_+1;this.r_(t,i,n)}To(t){const i=this.Xa.indexOf(t);J(i!==-1,"removeDataSource: invalid data source"),this.Xa.splice(i,1);const s=g(t.Bt()).Ve();if(this.Fo.has(s)){const h=P(this.Fo.get(s)),r=h.indexOf(t);r!==-1&&(h.splice(r,1),h.length===0&&this.Fo.delete(s))}const n=t.Bt();n&&n.va().indexOf(t)>=0&&n.To(t),n!==null&&(n.Co(),this.h_(n)),this.Za=null}Cr(t){return t===this.Yo?"left":t===this.Xo?"right":"overlay"}l_(){return this.Yo}a_(){return this.Xo}o_(t,i){t.Do(i)}__(t,i){t.Ao(i),this.n_()}u_(t){t.Bo()}c_(t,i){t.Lo(i)}d_(t,i){t.No(i),this.n_()}f_(t){t.Oo()}n_(){this.Xa.forEach(t=>{t.An()})}pn(){let t=null;return this.Ui.W().rightPriceScale.visible&&this.Xo.va().length!==0?t=this.Xo:this.Ui.W().leftPriceScale.visible&&this.Yo.va().length!==0?t=this.Yo:this.Xa.length!==0&&(t=this.Xa[0].Bt()),t===null&&(t=this.Xo),t}yr(){let t=null;return this.Ui.W().rightPriceScale.visible?t=this.Xo:this.Ui.W().leftPriceScale.visible&&(t=this.Yo),t}h_(t){t!==null&&t.oo()&&this.p_(t)}v_(t){const i=this.Ho.zs();t.lo({Wn:!0}),i!==null&&t.Vo(i),this.n_()}m_(){this.p_(this.Yo),this.p_(this.Xo)}b_(){this.h_(this.Yo),this.h_(this.Xo),this.Xa.forEach(t=>{this.kr(t)&&this.h_(t.Bt())}),this.n_(),this.Ui.Xh()}ko(){return this.Za===null&&(this.Za=$s(this.Xa)),this.Za}g_(){return this.$o}w_(){return this.Uo}p_(t){const i=t.Io();if(i&&i.length>0&&!this.Ho.Fi()){const s=this.Ho.zs();s!==null&&t.Vo(s)}t.An()}e_(){const t=this.ko();if(t.length===0)return{M_:0,s_:0};let i=0,s=0;for(let n=0;n<t.length;n++){const h=t[n].Ki();h!==null&&(h<i&&(i=h),h>s&&(s=h))}return{M_:i,s_:s}}r_(t,i,s){let n=this.Go(i);if(n===null&&(n=this.qo(i,this.Ui.W().overlayPriceScales)),this.Xa.push(t),!$t(i)){const h=this.Fo.get(i)||[];h.push(t),this.Fo.set(i,h)}t.hl!==void 0&&t.hl()==="BrokenArea"||n.yo(t),t.Ji(n),t.Gi(s),this.h_(n),this.Za=null}Zo(t,i,s){i.Nr!==s.Nr&&this.p_(t)}qo(t,i){const s=Object.assign({visible:!0,autoScale:!0},A(i)),n=new Ln(t,s,this.Ui.W().layout,this.Ui.W().localization);return n.po(this.Et()),n}}const Zi=e=>e.getUTCFullYear();function En(e,t,i){return t.replace(/yyyy/g,(s=>W(Zi(s),4))(e)).replace(/yy/g,(s=>W(Zi(s)%100,2))(e)).replace(/MMMM/g,((s,n)=>new Date(s.getUTCFullYear(),s.getUTCMonth(),1).toLocaleString(n,{month:"long"}))(e,i)).replace(/MMM/g,((s,n)=>new Date(s.getUTCFullYear(),s.getUTCMonth(),1).toLocaleString(n,{month:"short"}))(e,i)).replace(/MM/g,(s=>W((n=>n.getUTCMonth()+1)(s),2))(e)).replace(/dd/g,(s=>W((n=>n.getUTCDate())(s),2))(e))}class Us{constructor(t="yyyy-MM-dd",i="default"){this.S_=t,this.x_=i}k_(t){return En(t,this.S_,this.x_)}}class zn{constructor(t){this.y_=t||"%h:%m:%s"}k_(t){return this.y_.replace("%h",W(t.getUTCHours(),2)).replace("%m",W(t.getUTCMinutes(),2)).replace("%s",W(t.getUTCSeconds(),2))}}const Rn={C_:"yyyy-MM-dd",T_:"%h:%m:%s",P_:" ",R_:"default"};class kn{constructor(t={}){const i=Object.assign(Object.assign({},Rn),t);this.D_=new Us(i.C_,i.R_),this.A_=new zn(i.T_),this.B_=i.P_}k_(t){return`${this.D_.k_(t)}${this.B_}${this.A_.k_(t)}`}}class Fn{constructor(t,i=50){this.er=0,this.rr=1,this.hr=1,this.ar=new Map,this.lr=new Map,this.L_=t,this._r=i}k_(t){const i=t.ut,s=i.N_===void 0?new Date(1e3*i.O_).getTime():new Date(Date.UTC(i.N_.year,i.N_.month-1,i.N_.day)).getTime(),n=this.ar.get(s);if(n!==void 0)return n.E_;if(this.er===this._r){const r=this.lr.get(this.hr);this.lr.delete(this.hr),this.ar.delete(P(r)),this.hr++,this.er--}const h=this.L_(t);return this.ar.set(s,{E_:h,pr:this.rr}),this.lr.set(this.rr,s),this.er++,this.rr++,h}}class pt{constructor(t,i){J(t<=i,"right should be >= left"),this.I_=t,this.V_=i}Ss(){return this.I_}di(){return this.V_}z_(){return this.V_-this.I_+1}sh(t){return this.I_<=t&&t<=this.V_}Rh(t){return this.I_===t.Ss()&&this.V_===t.di()}}function Qi(e,t){return e===null||t===null?e===t:e.Rh(t)}class Bn{constructor(){this.F_=new Map,this.ar=null}W_(t,i){this.j_(i),this.ar=null;for(let s=i;s<t.length;++s){const n=t[s];let h=this.F_.get(n.H_);h===void 0&&(h=[],this.F_.set(n.H_,h)),h.push({Xs:s,ut:n.ut,U_:n.H_,Y_:n.Y_})}}q_(t,i){const s=Math.ceil(i/t);return this.ar!==null&&this.ar.X_===s||(this.ar={Ca:this.Z_(s),X_:s}),this.ar.Ca}j_(t){if(t===0)return void this.F_.clear();const i=[];this.F_.forEach((s,n)=>{t<=s[0].Xs?i.push(n):s.splice(wt(s,t,h=>h.Xs<t),1/0)});for(const s of i)this.F_.delete(s)}Z_(t){let i=[];for(const s of Array.from(this.F_.keys()).sort((n,h)=>h-n)){if(!this.F_.get(s))continue;const n=i;i=[];const h=n.length;let r=0;const o=P(this.F_.get(s)),l=o.length;let a=1/0,c=-1/0;for(let u=0;u<l;u++){const d=o[u],f=d.Xs;for(;r<h;){const p=n[r],m=p.Xs;if(!(m<f)){a=m;break}r++,i.push(p),c=m,a=1/0}a-f>=t&&f-c>=t&&(i.push(d),c=f)}for(;r<h;r++)i.push(n[r])}return i}}class tt{constructor(t){this.K_=t}G_(){return this.K_===null?null:new pt(Math.floor(this.K_.Ss()),Math.ceil(this.K_.di()))}J_(){return this.K_}static Q_(){return new tt(null)}}var qi,Ki,ts,is,ui;(function(e){e[e.Year=0]="Year",e[e.Month=1]="Month",e[e.DayOfMonth=2]="DayOfMonth",e[e.Time=3]="Time",e[e.TimeWithSeconds=4]="TimeWithSeconds"})(qi||(qi={}));class An{constructor(t,i,s){this.Wo=0,this.tu=null,this.iu=[],this.Ja=null,this.Ga=null,this.nu=new Bn,this.su=new Map,this.eu=tt.Q_(),this.ru=!0,this.hu=new _,this.lu=new _,this.au=new _,this.ou=null,this._u=null,this.uu=[],this.cn=i,this.so=s,this.cu=i.rightOffset,this.du=i.barSpacing,this.Ui=t,this.fu()}W(){return this.cn}pu(t){B(this.so,t),this.vu(),this.fu()}qh(t,i){var s;B(this.cn,t),this.cn.fixLeftEdge&&this.mu(),this.cn.fixRightEdge&&this.bu(),t.barSpacing!==void 0&&this.Ui.Gn(t.barSpacing),t.rightOffset!==void 0&&this.Ui.Jn(t.rightOffset),t.minBarSpacing!==void 0&&this.Ui.Gn((s=t.barSpacing)!==null&&s!==void 0?s:this.du),this.vu(),this.fu(),this.au.m()}mn(t){var i,s;return(s=(i=this.iu[t])===null||i===void 0?void 0:i.ut)!==null&&s!==void 0?s:null}Yi(t){var i;return(i=this.iu[t])!==null&&i!==void 0?i:null}fa(t,i){if(this.iu.length<1)return null;if(t.O_>this.iu[this.iu.length-1].ut.O_)return i?this.iu.length-1:null;const s=wt(this.iu,t.O_,(n,h)=>n.ut.O_<h);return t.O_<this.iu[s].ut.O_?i?s:null:s}Fi(){return this.Wo===0||this.iu.length===0||this.tu===null}da(){return this.iu.length>0}zs(){return this.gu(),this.eu.G_()}wu(){return this.gu(),this.eu.J_()}Mu(){const t=this.zs();if(t===null)return null;const i={from:t.Ss(),to:t.di()};return this.Su(i)}Su(t){const i=Math.round(t.from),s=Math.round(t.to),n=g(this.xu()),h=g(this.ku());return{from:g(this.mn(Math.max(n,i))),to:g(this.mn(Math.min(h,s)))}}yu(t){return{from:g(this.fa(t.from,!0)),to:g(this.fa(t.to,!0))}}Hi(){return this.Wo}i_(t){if(!isFinite(t)||t<=0||this.Wo===t)return;const i=this.wu(),s=this.Wo;if(this.Wo=t,this.ru=!0,this.cn.lockVisibleTimeRangeOnResize&&s!==0){const n=this.du*t/s;this.du=n}if(this.cn.fixLeftEdge&&i!==null&&i.Ss()<=0){const n=s-t;this.cu-=Math.round(n/this.du)+1,this.ru=!0}this.Cu(),this.Tu()}It(t){if(this.Fi()||!mt(t))return 0;const i=this.Pu()+this.cu-t;return this.Wo-(i+.5)*this.du-1}$s(t,i){const s=this.Pu(),n=i===void 0?0:i.from,h=i===void 0?t.length:i.to;for(let r=n;r<h;r++){const o=t[r].ut,l=s+this.cu-o,a=this.Wo-(l+.5)*this.du-1;t[r].et=a}}Ie(t,i,s){const n=this.Pu(),h=s===void 0?0:s.from,r=s===void 0?t.length:s.to;for(let o=h;o<r;o++){const l=t[o].ut;let a=n+this.cu-l,c=this.Wo-(a+.5)*this.du-1;t[o].et=Math.round(c),t[o].Ve!==void 0&&i[t[o].Ve]?(a=n+this.cu-i[t[o].Ve],c=this.Wo-(a+.5)*this.du-1,t[o].De=Math.round(c)):t[o].De=this.Wo}}Ru(t){return Math.ceil(this.Du(t))}Jn(t){this.ru=!0,this.cu=t,this.Tu(),this.Ui.Au(),this.Ui.Xh()}Gs(){return this.du}Gn(t){this.Bu(t),this.Tu(),this.Ui.Au(),this.Ui.Xh()}Lu(){return this.cu}Ca(){if(this.Fi())return null;if(this._u!==null)return this._u;const t=this.du,i=5*(this.Ui.W().layout.fontSize+4),s=Math.round(i/t),n=g(this.zs()),h=Math.max(n.Ss(),n.Ss()-s),r=Math.max(n.di(),n.di()-s),o=this.nu.q_(t,i),l=this.xu()+s,a=this.ku()-s,c=this.Nu(),u=this.cn.fixLeftEdge||c,d=this.cn.fixRightEdge||c;let f=0;for(const p of o){if(!(h<=p.Xs&&p.Xs<=r))continue;let m;f<this.uu.length?(m=this.uu[f],m.Ma=this.It(p.Xs),m.Ce=this.Ou(p),m.U_=p.U_):(m={Eu:!1,Ma:this.It(p.Xs),Ce:this.Ou(p),U_:p.U_},this.uu.push(m)),this.du>i/2&&!c?m.Eu=!1:m.Eu=u&&p.Xs<=l||d&&p.Xs>=a,f++}return this.uu.length=f,this._u=this.uu,this.uu}Iu(){this.ru=!0,this.Gn(this.cn.barSpacing),this.Jn(this.cn.rightOffset)}Vu(t){this.ru=!0,this.tu=t,this.Tu(),this.mu()}zu(t,i){const s=this.Du(t),n=this.Gs(),h=n+i*(n/10);this.Gn(h),this.cn.rightBarStaysOnScroll||this.Jn(this.Lu()+(s-this.Du(t)))}Do(t){this.Ja&&this.Oo(),this.Ga===null&&this.ou===null&&(this.Fi()||(this.Ga=t,this.Fu()))}Ao(t){if(this.ou===null)return;const i=Bt(this.Wo-t,0,this.Wo),s=Bt(this.Wo-g(this.Ga),0,this.Wo);i!==0&&s!==0&&this.Gn(this.ou.Gs*i/s)}Bo(){this.Ga!==null&&(this.Ga=null,this.Wu())}Lo(t){this.Ja===null&&this.ou===null&&(this.Fi()||(this.Ja=t,this.Fu()))}No(t){if(this.Ja===null)return;const i=(this.Ja-t)/this.Gs();this.cu=g(this.ou).Lu+i,this.ru=!0,this.Tu()}Oo(){this.Ja!==null&&(this.Ja=null,this.Wu())}ju(){this.$u(this.cn.rightOffset)}$u(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const s=this.cu,n=performance.now();this.Ui.Xn({Hu:h=>(h-n)/i>=1,Uu:h=>{const r=(h-n)/i;return r>=1?t:s+(t-s)*r}})}wt(t,i){this.ru=!0,this.iu=t,this.nu.W_(t,i),this.Tu()}Yu(){return this.hu}qu(){return this.lu}Xu(){return this.au}Pu(){return this.tu||0}Zu(t){const i=t.z_();this.Bu(this.Wo/i),this.cu=t.di()-this.Pu(),this.Tu(),this.ru=!0,this.Ui.Au(),this.Ui.Xh()}Ku(){const t=this.xu(),i=this.ku();t!==null&&i!==null&&this.Zu(new pt(t,i+this.cn.rightOffset))}Gu(t){const i=new pt(t.from,t.to);this.Zu(i)}qi(t){return this.so.timeFormatter!==void 0?this.so.timeFormatter(t.Y_):this.Ju.k_(new Date(1e3*t.ut.O_))}Nu(){const{handleScroll:t,handleScale:i}=this.Ui.W();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}xu(){return this.iu.length===0?null:0}ku(){return this.iu.length===0?null:this.iu.length-1}Qu(t){return(this.Wo-1-t)/this.du}Du(t){const i=this.Qu(t),s=this.Pu()+this.cu-i;return Math.round(1e6*s)/1e6}Bu(t){const i=this.du;this.du=t,this.Cu(),i!==this.du&&(this.ru=!0,this.tc())}gu(){if(!this.ru)return;if(this.ru=!1,this.Fi())return void this.ic(tt.Q_());const t=this.Pu(),i=this.Wo/this.du,s=this.cu+t,n=new pt(s-i+1,s);this.ic(new tt(n))}Cu(){const t=this.nc();if(this.du<t&&(this.du=t,this.ru=!0),this.Wo!==0){const i=.5*this.Wo;this.du>i&&(this.du=i,this.ru=!0)}}nc(){return this.cn.fixLeftEdge&&this.cn.fixRightEdge&&this.iu.length!==0?this.Wo/this.iu.length:this.cn.minBarSpacing}Tu(){const t=this.sc();this.cu>t&&(this.cu=t,this.ru=!0);const i=this.ec();i!==null&&this.cu<i&&(this.cu=i,this.ru=!0)}ec(){const t=this.xu(),i=this.tu;return t===null||i===null?null:t-i-1+(this.cn.fixLeftEdge?this.Wo/this.du:Math.min(2,this.iu.length))}sc(){return this.cn.fixRightEdge?0:this.Wo/this.du-Math.min(2,this.iu.length)}Fu(){this.ou={Gs:this.Gs(),Lu:this.Lu()}}Wu(){this.ou=null}Ou(t){let i=this.su.get(t.U_);return i===void 0&&(i=new Fn(s=>this.rc(s)),this.su.set(t.U_,i)),i.k_(t)}rc(t){const i=function(s,n,h){switch(s){case 0:case 10:return n?h?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return n?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.U_,this.cn.timeVisible,this.cn.secondsVisible);if(this.cn.tickMarkFormatter!==void 0){const s=this.cn.tickMarkFormatter(t.Y_,i,this.so.locale);if(s!==null)return s}return function(s,n,h){const r={};switch(n){case 0:r.year="numeric";break;case 1:r.month="short";break;case 2:r.day="numeric";break;case 3:r.hour12=!1,r.hour="2-digit",r.minute="2-digit";break;case 4:r.hour12=!1,r.hour="2-digit",r.minute="2-digit",r.second="2-digit"}const o=s.N_===void 0?new Date(1e3*s.O_):new Date(Date.UTC(s.N_.year,s.N_.month-1,s.N_.day));return new Date(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds()).toLocaleString(h,r)}(t.ut,i,this.so.locale)}ic(t){const i=this.eu;this.eu=t,Qi(i.G_(),this.eu.G_())||this.hu.m(),Qi(i.J_(),this.eu.J_())||this.lu.m(),this.tc()}tc(){this._u=null}vu(){this.tc(),this.su.clear()}fu(){const t=this.so.dateFormat;this.cn.timeVisible?this.Ju=new kn({C_:t,T_:this.cn.secondsVisible?"%h:%m:%s":"%h:%m",P_:"   ",R_:this.so.locale}):this.Ju=new Us(t,this.so.locale)}mu(){if(!this.cn.fixLeftEdge)return;const t=this.xu();if(t===null)return;const i=this.zs();if(i===null)return;const s=i.Ss()-t;if(s<0){const n=this.cu-s-1;this.Jn(n)}this.Cu()}bu(){this.Tu(),this.Cu()}}class Wn extends G{constructor(t){super(),this.hc=new Map,this.Vt=t}K(t){}J(t){if(!this.Vt.Tt)return;const{context:i,mediaSize:s}=t;let n=0;for(const r of this.Vt.lc){if(r.Jt.length===0)continue;i.font=r.R;const o=this.ac(i,r.Jt);o>s.width?r.zu=s.width/o:r.zu=1,n+=r.oc*r.zu}let h=0;switch(this.Vt._c){case"top":h=0;break;case"center":h=Math.max((s.height-n)/2,0);break;case"bottom":h=Math.max(s.height-n,0)}i.fillStyle=this.Vt.A;for(const r of this.Vt.lc){i.save();let o=0;switch(this.Vt.uc){case"left":i.textAlign="left",o=r.oc/2;break;case"center":i.textAlign="center",o=s.width/2;break;case"right":i.textAlign="right",o=s.width-1-r.oc/2}i.translate(o,h),i.textBaseline="top",i.font=r.R,i.scale(r.zu,r.zu),i.fillText(r.Jt,0,r.cc),i.restore(),h+=r.oc*r.zu}}ac(t,i){const s=this.dc(t.font);let n=s.get(i);return n===void 0&&(n=t.measureText(i).width,s.set(i,n)),n}dc(t){let i=this.hc.get(t);return i===void 0&&(i=new Map,this.hc.set(t,i)),i}}class On{constructor(t){this.bt=!0,this.jt={Tt:!1,A:"",lc:[],_c:"center",uc:"center"},this.$t=new Wn(this.jt),this.Ht=t}wt(){this.bt=!0}St(){return this.bt&&(this.xt(),this.bt=!1),this.$t}xt(){const t=this.Ht.W(),i=this.jt;i.Tt=t.visible,i.Tt&&(i.A=t.color,i.uc=t.horzAlign,i._c=t.vertAlign,i.lc=[{Jt:t.text,R:it(t.fontSize,t.fontFamily,t.fontStyle),oc:1.2*t.fontSize,cc:0,zu:0}])}}class Nn extends vi{constructor(t,i){super(),this.cn=i,this.gn=new On(this)}Rn(){return[]}Pn(){return[this.gn]}W(){return this.cn}An(){this.gn.wt()}}(function(e){e[e.OnTouchEnd=0]="OnTouchEnd",e[e.OnNextTap=1]="OnNextTap"})(Ki||(Ki={}));class Xn{constructor(t,i){this.fc=[],this.vc=[],this.Wo=0,this.mc=null,this.bc=new _,this.gc=new _,this.wc=null,this.Mc=t,this.cn=i,this.Sc=new we(this),this.Ho=new An(this,i.timeScale,this.cn.localization),this.gt=new ze(this,i.crosshair),this.xc=new Mn(i.crosshair),this.kc=new Nn(this,i.watermark),this.yc(),this.fc[0].t_(2e3),this.Cc=this.Tc(0),this.Pc=this.Tc(1)}zl(){this.Rc(M.es())}Xh(){this.Rc(M.ss())}ia(){this.Rc(new M(1))}Fl(t){const i=this.Dc(t);this.Rc(i)}Ac(){return this.mc}Bc(t){const i=this.mc;this.mc=t,i!==null&&this.Fl(i.Lc),t!==null&&this.Fl(t.Lc)}W(){return this.cn}qh(t){B(this.cn,t),this.fc.forEach(i=>i.Ko(t)),t.timeScale!==void 0&&this.Ho.qh(t.timeScale),t.localization!==void 0&&this.Ho.pu(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.bc.m(),this.Cc=this.Tc(0),this.Pc=this.Tc(1),this.zl()}Nc(t,i){if(t==="left")return void this.qh({leftPriceScale:i});if(t==="right")return void this.qh({rightPriceScale:i});const s=this.Oc(t);s!==null&&(s.Bt.qh(i),this.bc.m())}Oc(t){for(const i of this.fc){const s=i.Go(t);if(s!==null)return{Ut:i,Bt:s}}return null}yt(){return this.Ho}Ec(){return this.fc}Ic(){return this.kc}Vc(){return this.gt}zc(){return this.gc}Fc(t,i){t.po(i),this.Au()}i_(t){this.Wo=t,this.Ho.i_(this.Wo),this.fc.forEach(i=>i.i_(t)),this.Au()}yc(t){const i=new Pn(this.Ho,this);t!==void 0?this.fc.splice(t,0,i):this.fc.push(i);const s=t===void 0?this.fc.length-1:t,n=M.es();return n.zn(s,{Fn:0,Wn:!0}),this.Rc(n),i}o_(t,i,s){t.o_(i,s)}__(t,i,s){t.__(i,s),this.Wc(),this.Rc(this.jc(t,2))}u_(t,i){t.u_(i),this.Rc(this.jc(t,2))}c_(t,i,s){i.oo()||t.c_(i,s)}d_(t,i,s){i.oo()||(t.d_(i,s),this.Wc(),this.Rc(this.jc(t,2)))}f_(t,i){i.oo()||(t.f_(i),this.Rc(this.jc(t,2)))}v_(t,i){t.v_(i),this.Rc(this.jc(t,2))}$c(t){this.Ho.Do(t)}Hc(t,i){const s=this.yt();if(s.Fi()||i===0)return;const n=s.Hi();t=Math.max(1,Math.min(t,n)),s.zu(t,i),this.Au()}Uc(t){this.Yc(0),this.qc(t),this.Xc()}Zc(t){this.Ho.Ao(t),this.Au()}Kc(){this.Ho.Bo(),this.Xh()}Yc(t){this.Ho.Lo(t)}qc(t){this.Ho.No(t),this.Au()}Xc(){this.Ho.Oo(),this.Xh()}Mt(){return this.vc}Gc(t,i,s,n){this.gt.wn(t,i);let h=NaN,r=this.Ho.Ru(t);const o=this.Ho.zs();o!==null&&(r=Math.min(Math.max(o.Ss(),r),o.di()));const l=n.pn(),a=l.Pt();a!==null&&(h=l.vn(i,a)),h=this.xc.pa(h,r,n),this.gt.kn(r,h,n),this.ia(),this.gc.m(this.gt.kt(),{x:t,y:i},s)}Jc(){this.Vc().Cn(),this.ia(),this.gc.m(null,null,null)}Wc(){const t=this.gt.Ut();if(t!==null){const i=this.gt.Sn(),s=this.gt.xn();this.Gc(i,s,null,t)}this.gt.An()}Qc(t,i,s){const n=this.Ho.mn(0);i!==void 0&&s!==void 0&&this.Ho.wt(i,s);const h=this.Ho.mn(0),r=this.Ho.Pu(),o=this.Ho.zs();if(o!==null&&n!==null&&h!==null){const l=o.sh(r),a=n.O_>h.O_,c=t!==null&&t>r&&!a,u=l&&this.Ho.W().shiftVisibleRangeOnNewBar;if(c&&!u){const d=t-r;this.Ho.Jn(this.Ho.Lu()-d)}}this.Ho.Vu(t)}$l(t){t!==null&&t.b_()}Sr(t){const i=this.fc.find(s=>s.ko().includes(t));return i===void 0?null:i}Au(){this.kc.An(),this.fc.forEach(t=>t.b_())}S(){this.fc.forEach(t=>t.S()),this.fc.length=0,this.cn.localization.priceFormatter=void 0,this.cn.localization.timeFormatter=void 0}td(){return this.Sc}Tr(){return this.Sc.W()}Jo(){return this.bc}nd(t,i){const s=this.fc[0],n=this.sd(i,t,s);return this.vc.push(n),this.vc.length===1?this.zl():this.Xh(),n}ed(t){const i=this.Sr(t),s=this.vc.indexOf(t);J(s!==-1,"Series not found"),this.vc.splice(s,1),g(i).To(t),t.S&&t.S()}Vl(t,i){const s=g(this.Sr(t));s.To(t);const n=this.Oc(i);if(n===null){const h=t.Ki();s.yo(t,i,h)}else{const h=n.Ut===s?t.Ki():void 0;n.Ut.yo(t,i,h)}}Ku(){const t=M.ss();t.Hn(),this.Rc(t)}rd(t){const i=M.ss();i.qn(t),this.Rc(i)}Kn(){const t=M.ss();t.Kn(),this.Rc(t)}Gn(t){const i=M.ss();i.Gn(t),this.Rc(i)}Jn(t){const i=M.ss();i.Jn(t),this.Rc(i)}Xn(t){const i=M.ss();i.Xn(t),this.Rc(i)}Un(){const t=M.ss();t.Un(),this.Rc(t)}hd(){return this.cn.rightPriceScale.visible?"right":"left"}ld(){return this.Pc}Y(){return this.Cc}Ot(t){const i=this.Pc,s=this.Cc;if(i===s)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),this.wc===null||this.wc.gs!==s||this.wc.ws!==i)this.wc={gs:s,ws:i,ad:new Map};else{const h=this.wc.ad.get(t);if(h!==void 0)return h}const n=function(h,r,o){const[l,a,c,u]=kt(h),[d,f,p,m]=kt(r),b=[L(l+o*(d-l)),L(a+o*(f-a)),L(c+o*(p-c)),Vs(u+o*(m-u))];return`rgba(${b[0]}, ${b[1]}, ${b[2]}, ${b[3]})`}(s,i,t/100);return this.wc.ad.set(t,n),n}od(t,i,s,n){this.gt.wn(t,NaN);let h=this.Ho.Ru(t),r=NaN;const o=this.Ho.zs();o!==null&&(h=Math.min(Math.max(o.Ss(),h),o.di()));const l=n.pn(),a=l.Pt();a!==null&&(r=l.vn(i,a)),r=this.xc.pa(r,h,n),this.gt.kn(h,r,n),this.ia(),s&&this.gc.m(this.gt.kt(),{x:t,y:i},null)}jc(t,i){const s=new M(i);if(t!==null){const n=this.fc.indexOf(t);s.zn(n,{Fn:i})}return s}Dc(t,i){return i===void 0&&(i=2),this.jc(this.Sr(t),i)}Rc(t){this.Mc&&this.Mc(t),this.fc.forEach(i=>i.w_().Zh().wt())}sd(t,i,s){const n=new yi(this,t,i),h=t.priceScaleId!==void 0?t.priceScaleId:this.hd();return s.yo(n,h),$t(h)||n.qh(t),n}Tc(t){const i=this.cn.layout;return i.background.type==="gradient"?t===0?i.background.topColor:i.background.bottomColor:i.background.color}}function xi(e){return!F(e)&&!mi(e)}function Is(e){return F(e)}(function(e){e[e.Disabled=0]="Disabled",e[e.Continuous=1]="Continuous",e[e.OnDataUpdate=2]="OnDataUpdate"})(ts||(ts={})),function(e){e[e.LastBar=0]="LastBar",e[e.LastVisible=1]="LastVisible"}(is||(is={})),function(e){e.Solid="solid",e.VerticalGradient="gradient"}(ui||(ui={}));const st=typeof window<"u";function ss(){return!!st&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function ti(){return!!st&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function di(e){return e+e%2}function ii(e,t){return e._d-t._d}function si(e,t,i){const s=(e._d-t._d)/(e.ut-t.ut);return Math.sign(s)*Math.min(Math.abs(s),i)}class $n{constructor(t,i,s,n){this.ud=null,this.dd=null,this.fd=null,this.pd=null,this.vd=null,this.md=0,this.bd=0,this.gd=t,this.wd=i,this.Md=s,this.rs=n}Sd(t,i){if(this.ud!==null){if(this.ud.ut===i)return void(this.ud._d=t);if(Math.abs(this.ud._d-t)<this.rs)return}this.pd=this.fd,this.fd=this.dd,this.dd=this.ud,this.ud={ut:i,_d:t}}zr(t,i){if(this.ud===null||this.dd===null||i-this.ud.ut>50)return;let s=0;const n=si(this.ud,this.dd,this.wd),h=ii(this.ud,this.dd),r=[n],o=[h];if(s+=h,this.fd!==null){const a=si(this.dd,this.fd,this.wd);if(Math.sign(a)===Math.sign(n)){const c=ii(this.dd,this.fd);if(r.push(a),o.push(c),s+=c,this.pd!==null){const u=si(this.fd,this.pd,this.wd);if(Math.sign(u)===Math.sign(n)){const d=ii(this.fd,this.pd);r.push(u),o.push(d),s+=d}}}}let l=0;for(let a=0;a<r.length;++a)l+=o[a]/s*r[a];Math.abs(l)<this.gd||(this.vd={_d:t,ut:i},this.bd=l,this.md=function(a,c){const u=Math.log(c);return Math.log(1*u/-a)/u}(Math.abs(l),this.Md))}Uu(t){const i=g(this.vd),s=t-i.ut;return i._d+this.bd*(Math.pow(this.Md,s)-1)/Math.log(this.Md)}Hu(t){return this.vd===null||this.xd(t)===this.md}xd(t){const i=t-g(this.vd).ut;return Math.min(i,this.md)}}function H(e,t){const i=g(e.ownerDocument).createElement("canvas");e.appendChild(i);const s=ce(i,{type:"device-pixel-content-box",options:{allowResizeObserver:!1},transform:(n,h)=>({width:Math.max(n.width,h.width),height:Math.max(n.height,h.height)})});return s.resizeCanvasElement(t),s}function Un(e){st&&window.chrome!==void 0&&e.addEventListener("mousedown",t=>{if(t.button===1)return t.preventDefault(),!1})}class Mi{constructor(t,i,s){this.kd=0,this.yd=null,this.Cd={et:Number.NEGATIVE_INFINITY,rt:Number.POSITIVE_INFINITY},this.Td=0,this.Pd=null,this.Rd={et:Number.NEGATIVE_INFINITY,rt:Number.POSITIVE_INFINITY},this.Dd=null,this.Ad=!1,this.Bd=null,this.Ld=null,this.Nd=!1,this.Od=!1,this.Ed=!1,this.Id=null,this.Vd=null,this.zd=null,this.Fd=null,this.Wd=null,this.jd=null,this.$d=null,this.Hd=0,this.Ud=!1,this.Yd=!1,this.qd=!1,this.Xd=0,this.Zd=null,this.Kd=!ti(),this.Gd=n=>{this.Jd(n)},this.Qd=n=>{if(this.tf(n)){const h=this.if(n);if(++this.Td,this.Pd&&this.Td>1){const{nf:r}=this.sf(R(n),this.Rd);r<30&&!this.Ed&&this.ef(h,this.hf.rf),this.lf()}}else{const h=this.if(n);if(++this.kd,this.yd&&this.kd>1){const{nf:r}=this.sf(R(n),this.Cd);r<5&&!this.Od&&this.af(h,this.hf._f),this.uf()}}},this.cf=t,this.hf=i,this.cn=s,this.df()}S(){this.Id!==null&&(this.Id(),this.Id=null),this.Vd!==null&&(this.Vd(),this.Vd=null),this.Fd!==null&&(this.Fd(),this.Fd=null),this.Wd!==null&&(this.Wd(),this.Wd=null),this.jd!==null&&(this.jd(),this.jd=null),this.zd!==null&&(this.zd(),this.zd=null),this.ff(),this.uf()}pf(t){this.Fd&&this.Fd();const i=this.vf.bind(this);if(this.Fd=()=>{this.cf.removeEventListener("mousemove",i)},this.cf.addEventListener("mousemove",i),this.tf(t))return;const s=this.if(t);this.af(s,this.hf.mf),this.Kd=!0}uf(){this.yd!==null&&clearTimeout(this.yd),this.kd=0,this.yd=null,this.Cd={et:Number.NEGATIVE_INFINITY,rt:Number.POSITIVE_INFINITY}}lf(){this.Pd!==null&&clearTimeout(this.Pd),this.Td=0,this.Pd=null,this.Rd={et:Number.NEGATIVE_INFINITY,rt:Number.POSITIVE_INFINITY}}vf(t){if(this.qd||this.Ld!==null||this.tf(t))return;const i=this.if(t);this.af(i,this.hf.bf),this.Kd=!0}gf(t){const i=ei(t.changedTouches,g(this.Zd));if(i===null||(this.Xd=Mt(t),this.$d!==null)||this.Yd)return;this.Ud=!0;const s=this.sf(R(i),g(this.Ld)),{wf:n,Mf:h,nf:r}=s;if(this.Nd||!(r<5)){if(!this.Nd){const o=.5*n,l=h>=o&&!this.cn.Sf(),a=o>h&&!this.cn.xf();l||a||(this.Yd=!0),this.Nd=!0,this.Ed=!0,this.ff(),this.lf()}if(!this.Yd){const o=this.if(t,i);this.ef(o,this.hf.kf),Q(t)}}}yf(t){if(t.button!==0)return;const i=this.sf(R(t),g(this.Bd)),{nf:s}=i;if(s>=5&&(this.Od=!0,this.uf()),this.Od){const n=this.if(t);this.af(n,this.hf.Cf)}}sf(t,i){const s=Math.abs(i.et-t.et),n=Math.abs(i.rt-t.rt);return{wf:s,Mf:n,nf:s+n}}Tf(t){let i=ei(t.changedTouches,g(this.Zd));if(i===null&&t.touches.length===0&&(i=t.changedTouches[0]),i===null)return;this.Zd=null,this.Xd=Mt(t),this.ff(),this.Ld=null,this.jd&&(this.jd(),this.jd=null);const s=this.if(t,i);if(this.ef(s,this.hf.Pf),++this.Td,this.Pd&&this.Td>1){const{nf:n}=this.sf(R(i),this.Rd);n<30&&!this.Ed&&this.ef(s,this.hf.rf),this.lf()}else this.Ed||(this.ef(s,this.hf.Rf),this.hf.Rf&&Q(t));this.Td===0&&Q(t),t.touches.length===0&&this.Ad&&(this.Ad=!1,Q(t))}Jd(t){if(t.button!==0)return;const i=this.if(t);if(this.Bd=null,this.qd=!1,this.Wd&&(this.Wd(),this.Wd=null),ss()&&this.cf.ownerDocument.documentElement.removeEventListener("mouseleave",this.Gd),!this.tf(t))if(this.af(i,this.hf.Df),++this.kd,this.yd&&this.kd>1){const{nf:s}=this.sf(R(t),this.Cd);s<5&&!this.Od&&this.af(i,this.hf._f),this.uf()}else this.Od||this.af(i,this.hf.Af)}ff(){this.Dd!==null&&(clearTimeout(this.Dd),this.Dd=null)}Bf(t){if(this.Zd!==null)return;const i=t.changedTouches[0];this.Zd=i.identifier,this.Xd=Mt(t);const s=this.cf.ownerDocument.documentElement;this.Ed=!1,this.Nd=!1,this.Yd=!1,this.Ld=R(i),this.jd&&(this.jd(),this.jd=null);{const h=this.gf.bind(this),r=this.Tf.bind(this);this.jd=()=>{s.removeEventListener("touchmove",h),s.removeEventListener("touchend",r)},s.addEventListener("touchmove",h,{passive:!1}),s.addEventListener("touchend",r,{passive:!1}),this.ff(),this.Dd=setTimeout(this.Lf.bind(this,t),240)}const n=this.if(t,i);this.ef(n,this.hf.Nf),this.Pd||(this.Td=0,this.Pd=setTimeout(this.lf.bind(this),500),this.Rd=R(i))}Of(t){if(t.button!==0)return;const i=this.cf.ownerDocument.documentElement;ss()&&i.addEventListener("mouseleave",this.Gd),this.Od=!1,this.Bd=R(t),this.Wd&&(this.Wd(),this.Wd=null);{const n=this.yf.bind(this),h=this.Jd.bind(this);this.Wd=()=>{i.removeEventListener("mousemove",n),i.removeEventListener("mouseup",h)},i.addEventListener("mousemove",n),i.addEventListener("mouseup",h)}if(this.qd=!0,this.tf(t))return;const s=this.if(t);this.af(s,this.hf.Ef),this.yd||(this.kd=0,this.yd=setTimeout(this.uf.bind(this),500),this.Cd=R(t))}df(){this.cf.addEventListener("mouseenter",this.pf.bind(this)),this.cf.addEventListener("touchcancel",this.ff.bind(this));{const t=this.cf.ownerDocument,i=s=>{this.hf.If&&(s.composed&&this.cf.contains(s.composedPath()[0])||s.target&&this.cf.contains(s.target)||this.hf.If())};this.Vd=()=>{t.removeEventListener("touchstart",i)},this.Id=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}ti()&&(this.zd=()=>{this.cf.removeEventListener("dblclick",this.Qd)},this.cf.addEventListener("dblclick",this.Qd)),this.cf.addEventListener("mouseleave",this.Vf.bind(this)),this.cf.addEventListener("touchstart",this.Bf.bind(this),{passive:!0}),Un(this.cf),this.cf.addEventListener("mousedown",this.Of.bind(this)),this.zf(),this.cf.addEventListener("touchmove",()=>{},{passive:!1})}zf(){this.hf.Ff===void 0&&this.hf.Wf===void 0&&this.hf.jf===void 0||(this.cf.addEventListener("touchstart",t=>this.$f(t.touches),{passive:!0}),this.cf.addEventListener("touchmove",t=>{if(t.touches.length===2&&this.$d!==null&&this.hf.Wf!==void 0){const i=es(t.touches[0],t.touches[1])/this.Hd;this.hf.Wf(this.$d,i),Q(t)}},{passive:!1}),this.cf.addEventListener("touchend",t=>{this.$f(t.touches)}))}$f(t){t.length===1&&(this.Ud=!1),t.length!==2||this.Ud||this.Ad?this.Hf():this.Uf(t)}Uf(t){const i=this.cf.getBoundingClientRect()||{left:0,top:0};this.$d={et:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,rt:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Hd=es(t[0],t[1]),this.hf.Ff!==void 0&&this.hf.Ff(),this.ff()}Hf(){this.$d!==null&&(this.$d=null,this.hf.jf!==void 0&&this.hf.jf())}Vf(t){if(this.Fd&&this.Fd(),this.tf(t)||!this.Kd)return;const i=this.if(t);this.af(i,this.hf.Yf),this.Kd=!ti()}Lf(t){const i=ei(t.touches,g(this.Zd));if(i===null)return;const s=this.if(t,i);this.ef(s,this.hf.qf),this.Ed=!0,this.Ad=!0}tf(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents!==void 0?t.sourceCapabilities.firesTouchEvents:Mt(t)<this.Xd+500}ef(t,i){i&&i.call(this.hf,t)}af(t,i){i&&i.call(this.hf,t)}if(t,i){const s=i||t,n=this.cf.getBoundingClientRect()||{left:0,top:0};return{clientX:s.clientX,clientY:s.clientY,pageX:s.pageX,pageY:s.pageY,screenX:s.screenX,screenY:s.screenY,localX:s.clientX-n.left,localY:s.clientY-n.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,Xf:!t.type.startsWith("mouse")&&t.type!=="contextmenu"&&t.type!=="click",Zf:t.type,Kf:s.target,Gf:t.view,Jf:()=>{t.type!=="touchstart"&&Q(t)}}}}function es(e,t){const i=e.clientX-t.clientX,s=e.clientY-t.clientY;return Math.sqrt(i*i+s*s)}function Q(e){e.cancelable&&e.preventDefault()}function R(e){return{et:e.pageX,rt:e.pageY}}function Mt(e){return e.timeStamp||performance.now()}function ei(e,t){for(let i=0;i<e.length;++i)if(e[i].identifier===t)return e[i];return null}class ns{constructor(t,i,s,n){this.Vi=null,this.Qf=null,this.tp=!1,this.ip=new gt(200),this.rh=null,this.np=0,this.sp=!1,this.ep=()=>{this.sp||this.nn.rp().Yt().Xh()},this.hp=()=>{this.sp||this.nn.rp().Yt().Xh()},this.nn=t,this.cn=i,this.no=i.layout,this.Sc=s,this.lp=n==="left",this.ap=document.createElement("div"),this.ap.style.height="100%",this.ap.style.overflow="hidden",this.ap.style.width="25px",this.ap.style.left="0",this.ap.style.position="relative",this.op=H(this.ap,y({width:16,height:16})),this.op.subscribeSuggestedBitmapSizeChanged(this.ep);const h=this.op.canvasElement;h.style.position="absolute",h.style.zIndex="1",h.style.left="0",h.style.top="0",this._p=H(this.ap,y({width:16,height:16})),this._p.subscribeSuggestedBitmapSizeChanged(this.hp);const r=this._p.canvasElement;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0";const o={Ef:this.up.bind(this),Nf:this.up.bind(this),Cf:this.cp.bind(this),kf:this.cp.bind(this),If:this.dp.bind(this),Df:this.fp.bind(this),Pf:this.fp.bind(this),_f:this.pp.bind(this),rf:this.pp.bind(this),mf:this.vp.bind(this),Yf:this.mp.bind(this)};this.bp=new Mi(this._p.canvasElement,o,{Sf:()=>!1,xf:()=>!0})}S(){this.bp.S(),this._p.unsubscribeSuggestedBitmapSizeChanged(this.hp),this._p.dispose(),this.op.unsubscribeSuggestedBitmapSizeChanged(this.ep),this.op.dispose(),this.Vi!==null&&this.Vi.Ro().v(this),this.Vi=null}gp(){return this.ap}P(){return this.no.fontSize}wp(){const t=this.Sc.W();return this.rh!==t.R&&(this.ip.ur(),this.rh=t.R),t}Mp(){if(this.Vi===null)return 0;let t=0;const i=this.wp(),s=g(this.op.canvasElement.getContext("2d"));s.save();const n=this.Vi.Ca();s.font=this.Sp(),n.length>0&&(t=Math.max(this.ip.xi(s,n[0].Ce),this.ip.xi(s,n[n.length-1].Ce)));const h=this.xp();for(let l=h.length;l--;){const a=this.ip.xi(s,h[l].Jt());a>t&&(t=a)}const r=this.Vi.Pt();if(r!==null&&this.Qf!==null){const l=this.Vi.vn(1,r),a=this.Vi.vn(this.Qf.height-2,r);t=Math.max(t,this.ip.xi(s,this.Vi.Wi(Math.floor(Math.min(l,a))+.11111111111111,r)),this.ip.xi(s,this.Vi.Wi(Math.ceil(Math.max(l,a))-.11111111111111,r)))}s.restore();const o=t||34;return di(Math.ceil(i.C+i.T+i.N+i.O+5+o))}kp(t){this.Qf!==null&&Y(this.Qf,t)||(this.Qf=t,this.sp=!0,this.op.resizeCanvasElement(t),this._p.resizeCanvasElement(t),this.sp=!1,this.ap.style.width=`${t.width}px`,this.ap.style.height=`${t.height}px`)}yp(){return g(this.Qf).width}Ji(t){this.Vi!==t&&(this.Vi!==null&&this.Vi.Ro().v(this),this.Vi=t,t.Ro().l(this.Ya.bind(this),this))}Bt(){return this.Vi}ur(){const t=this.nn.Cp();this.nn.rp().Yt().v_(t,g(this.Bt()))}Tp(t){if(this.Qf===null)return;if(t!==1){this.Pp(),this.op.applySuggestedBitmapSize();const s=D(this.op);s!==null&&(s.useBitmapCoordinateSpace(n=>{this.Rp(n),this.We(n)}),this.Dp(s),this.Ap(s))}this._p.applySuggestedBitmapSize();const i=D(this._p);i!==null&&(i.useBitmapCoordinateSpace(({context:s,bitmapSize:n})=>{s.clearRect(0,0,n.width,n.height)}),this.Bp(i))}Lp(){return this.op.bitmapSize}Np(t,i,s){const n=this.Lp();n.width>0&&n.height>0&&t.drawImage(this.op.canvasElement,i,s)}wt(){var t;(t=this.Vi)===null||t===void 0||t.Ca()}up(t){if(this.Vi===null||this.Vi.Fi()||!this.cn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.rp().Yt(),s=this.nn.Cp();this.tp=!0,i.o_(s,this.Vi,t.localY)}cp(t){if(this.Vi===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.rp().Yt(),s=this.nn.Cp(),n=this.Vi;i.__(s,n,t.localY)}dp(){if(this.Vi===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const t=this.nn.rp().Yt(),i=this.nn.Cp(),s=this.Vi;this.tp&&(this.tp=!1,t.u_(i,s))}fp(t){if(this.Vi===null||!this.cn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.rp().Yt(),s=this.nn.Cp();this.tp=!1,i.u_(s,this.Vi)}pp(t){this.cn.handleScale.axisDoubleClickReset.price&&this.ur()}vp(t){this.Vi!==null&&(!this.nn.rp().Yt().W().handleScale.axisPressedMouseMove.price||this.Vi.kh()||this.Vi._o()||this.Op(1))}mp(t){this.Op(0)}xp(){const t=[],i=this.Vi===null?void 0:this.Vi;return(s=>{for(let n=0;n<s.length;++n){const h=s[n].Rn(this.nn.Cp(),i);for(let r=0;r<h.length;r++)t.push(h[r])}})(this.nn.Cp().ko()),t}Rp({context:t,bitmapSize:i}){const{width:s,height:n}=i,h=this.nn.Cp().Yt(),r=h.Y(),o=h.ld();r===o?Xt(t,0,0,s,n,r):Ts(t,0,0,s,n,r,o)}We({context:t,bitmapSize:i,horizontalPixelRatio:s}){if(this.Qf===null||this.Vi===null||!this.Vi.W().borderVisible)return;t.fillStyle=this.Vi.W().borderColor;const n=Math.max(1,Math.floor(this.wp().C*s));let h;h=this.lp?i.width-n:0,t.fillRect(h,0,n,i.height)}Dp(t){if(this.Qf===null||this.Vi===null)return;const i=this.Vi.Ca(),s=this.Vi.W(),n=this.wp(),h=this.lp?this.Qf.width-n.T:0;s.borderVisible&&s.ticksVisible&&t.useBitmapCoordinateSpace(({context:r,horizontalPixelRatio:o,verticalPixelRatio:l})=>{r.fillStyle=s.borderColor;const a=Math.max(1,Math.floor(l)),c=Math.floor(.5*l),u=Math.round(n.T*o);r.beginPath();for(const d of i)r.rect(Math.floor(h*o),Math.round(d.Ma*l)-c,u,a);r.fill()}),t.useMediaCoordinateSpace(({context:r})=>{var o;r.font=this.Sp(),r.fillStyle=(o=s.textColor)!==null&&o!==void 0?o:this.no.textColor,r.textAlign=this.lp?"right":"left",r.textBaseline="middle";const l=this.lp?Math.round(h-n.N):Math.round(h+n.T+n.N),a=i.map(c=>this.ip.Si(r,c.Ce));for(let c=i.length;c--;){const u=i[c];r.fillText(u.Ce,l,u.Ma+a[c])}})}Pp(){if(this.Qf===null||this.Vi===null)return;let t=this.Qf.height/2;const i=[],s=this.Vi.ko().slice(),n=this.nn.Cp(),h=this.wp();this.Vi===n.yr()&&this.nn.Cp().ko().forEach(l=>{n.kr(l)&&s.push(l)});const r=this.Vi.va()[0],o=this.Vi;s.forEach(l=>{const a=l.Rn(n,o);a.forEach(c=>{c.Li(null),c.Ni()&&i.push(c)}),r===l&&a.length>0&&(t=a[0].yi())}),i.forEach(l=>l.Li(l.yi())),this.Vi.W().alignLabels&&this.Ep(i,h,t)}Ep(t,i,s){if(this.Qf===null)return;const n=t.filter(r=>r.yi()<=s),h=t.filter(r=>r.yi()>s);n.sort((r,o)=>o.yi()-r.yi()),n.length&&h.length&&h.push(n[0]),h.sort((r,o)=>r.yi()-o.yi());for(const r of t){const o=Math.floor(r.Et(i)/2),l=r.yi();l>-o&&l<o&&r.Li(o),l>this.Qf.height-o&&l<this.Qf.height+o&&r.Li(this.Qf.height-o)}for(let r=1;r<n.length;r++){const o=n[r],l=n[r-1],a=l.Et(i,!1),c=o.yi(),u=l.Bi();c>u-a&&o.Li(u-a)}for(let r=1;r<h.length;r++){const o=h[r],l=h[r-1],a=l.Et(i,!0),c=o.yi(),u=l.Bi();c<u+a&&o.Li(u+a)}}Ap(t){if(this.Qf===null)return;const i=this.xp(),s=this.wp(),n=this.lp?"right":"left";i.forEach(h=>{h.Oi()&&h.St(g(this.Vi)).Z(t,s,this.ip,n)})}Bp(t){if(this.Qf===null||this.Vi===null)return;const i=this.nn.rp().Yt(),s=[],n=this.nn.Cp(),h=i.Vc().Rn(n,this.Vi);h.length&&s.push(h);const r=this.wp(),o=this.lp?"right":"left";s.forEach(l=>{l.forEach(a=>{a.St(g(this.Vi)).Z(t,r,this.ip,o)})})}Op(t){this.ap.style.cursor=t===1?"ns-resize":"default"}Ya(){const t=this.Mp();this.np<t&&this.nn.rp().Yt().zl(),this.np=t}Sp(){return it(this.no.fontSize,this.no.fontFamily)}}function hs(e,t,i,s){e.G&&e.G(t,i,s)}function ni(e,t,i,s){e.Z(t,i,s)}function _t(e,t){return e.Pn(t)}function In(e,t){return e.Qi(t)}function Yn(e,t){return e.ta!==void 0?e.ta(t):[]}class _i{constructor(t,i){this.Qf=y({width:0,height:0}),this.Ip=null,this.Vp=null,this.zp=null,this.Fp=!1,this.Wp=new _,this.jp=0,this.$p=!1,this.Hp=null,this.Up=!1,this.Yp=null,this.qp=null,this.sp=!1,this.ep=()=>{this.sp||this.Xp===null||this.Ui().Xh()},this.hp=()=>{this.sp||this.Xp===null||this.Ui().Xh()},this.Zp=t,this.Xp=i,this.Xp.g_().l(this.Kp.bind(this),this,!0),this.Gp=document.createElement("td"),this.Gp.style.padding="0",this.Gp.style.position="relative";const s=document.createElement("div");s.style.width="100%",s.style.height="100%",s.style.position="relative",s.style.overflow="hidden",this.Jp=document.createElement("td"),this.Jp.style.padding="0",this.Qp=document.createElement("td"),this.Qp.style.padding="0",this.Gp.appendChild(s),this.op=H(s,y({width:16,height:16})),this.op.subscribeSuggestedBitmapSizeChanged(this.ep);const n=this.op.canvasElement;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this._p=H(s,y({width:16,height:16})),this._p.subscribeSuggestedBitmapSizeChanged(this.hp);const h=this._p.canvasElement;h.style.position="absolute",h.style.zIndex="2",h.style.left="0",h.style.top="0",this.tv=document.createElement("tr"),this.tv.appendChild(this.Jp),this.tv.appendChild(this.Gp),this.tv.appendChild(this.Qp),this.iv(),this.bp=new Mi(this._p.canvasElement,this,{Sf:()=>this.Hp===null&&!this.Zp.W().handleScroll.vertTouchDrag,xf:()=>this.Hp===null&&!this.Zp.W().handleScroll.horzTouchDrag})}S(){this.Ip!==null&&this.Ip.S(),this.Vp!==null&&this.Vp.S(),this._p.unsubscribeSuggestedBitmapSizeChanged(this.hp),this._p.dispose(),this.op.unsubscribeSuggestedBitmapSizeChanged(this.ep),this.op.dispose(),this.Xp!==null&&this.Xp.g_().v(this),this.bp.S()}Cp(){return g(this.Xp)}nv(t){this.Xp!==null&&this.Xp.g_().v(this),this.Xp=t,this.Xp!==null&&this.Xp.g_().l(_i.prototype.Kp.bind(this),this,!0),this.iv()}rp(){return this.Zp}gp(){return this.tv}iv(){if(this.Xp!==null&&(this.sv(),this.Ui().Mt().length!==0)){if(this.Ip!==null){const t=this.Xp.l_();this.Ip.Ji(g(t))}if(this.Vp!==null){const t=this.Xp.a_();this.Vp.Ji(g(t))}}}ev(){this.Ip!==null&&this.Ip.wt(),this.Vp!==null&&this.Vp.wt()}Qo(){return this.Xp!==null?this.Xp.Qo():0}t_(t){this.Xp&&this.Xp.t_(t)}mf(t){if(!this.Xp)return;this.rv();const i=t.localX,s=t.localY;this.hv(i,s,t)}Ef(t){this.rv(),this.lv(),this.hv(t.localX,t.localY,t)}bf(t){if(!this.Xp)return;this.rv();const i=t.localX,s=t.localY;this.hv(i,s,t);const n=this.Pr(i,s);this.Ui().Bc(n&&{Lc:n.Lc,av:n.av})}Af(t){this.Xp!==null&&(this.rv(),this.ov(t))}Cf(t){this.rv(),this._v(t),this.hv(t.localX,t.localY,t)}Df(t){this.Xp!==null&&(this.rv(),this.$p=!1,this.uv(t))}Rf(t){this.Xp!==null&&this.ov(t)}qf(t){if(this.$p=!0,this.Hp===null){const i={x:t.localX,y:t.localY};this.cv(i,i,t)}}Yf(t){this.Xp!==null&&(this.rv(),this.Xp.Yt().Bc(null),this.dv())}fv(){return this.Wp}Ff(){this.jp=1,this.Ui().Un()}Wf(t,i){if(!this.Zp.W().handleScale.pinch)return;const s=5*(i-this.jp);this.jp=i,this.Ui().Hc(t.et,s)}Nf(t){if(this.$p=!1,this.Up=this.Hp!==null,this.lv(),this.Hp!==null){const i=this.Ui().Vc();this.Yp={x:i.Zt(),y:i.Kt()},this.Hp={x:t.localX,y:t.localY}}}kf(t){if(this.Xp===null)return;const i=t.localX,s=t.localY;if(this.Hp===null)this._v(t);else{this.Up=!1;const n=g(this.Yp),h=n.x+(i-this.Hp.x),r=n.y+(s-this.Hp.y);this.hv(h,r,t)}}Pf(t){this.rp().W().trackingMode.exitMode===0&&(this.Up=!0),this.pv(),this.uv(t)}Pr(t,i){const s=this.Xp;if(s===null)return null;const n=s.ko();for(const h of n){const r=this.vv(h.Pn(s),t,i);if(r!==null)return{Lc:h,Gf:r.Gf,av:r.av}}return null}mv(t,i){g(i==="left"?this.Ip:this.Vp).kp(y({width:t,height:this.Qf.height}))}bv(){return this.Qf}kp(t){Y(this.Qf,t)||(this.Qf=t,this.sp=!0,this.op.resizeCanvasElement(t),this._p.resizeCanvasElement(t),this.sp=!1,this.Gp.style.width=t.width+"px",this.Gp.style.height=t.height+"px")}gv(){const t=g(this.Xp);t.h_(t.l_()),t.h_(t.a_());for(const i of t.va())if(t.kr(i)){const s=i.Bt();s!==null&&t.h_(s),i.An()}}Lp(){return this.op.bitmapSize}Np(t,i,s){const n=this.Lp();n.width>0&&n.height>0&&t.drawImage(this.op.canvasElement,i,s)}Tp(t){if(t===0||this.Xp===null)return;if(t>1&&this.gv(),this.Ip!==null&&this.Ip.Tp(t),this.Vp!==null&&this.Vp.Tp(t),t!==1){this.op.applySuggestedBitmapSize();const s=D(this.op);s!==null&&(s.useBitmapCoordinateSpace(n=>{this.Rp(n)}),this.Xp&&(this.wv(s),this.Mv(s),this.Sv(s,_t),this.Sv(s,In)))}this._p.applySuggestedBitmapSize();const i=D(this._p);i!==null&&(i.useBitmapCoordinateSpace(({context:s,bitmapSize:n})=>{s.clearRect(0,0,n.width,n.height)}),this.Sv(i,Yn),this.xv(i))}kv(){return this.Ip}yv(){return this.Vp}Cv(t,i,s){if(this.Xp)if(s){const n=t,h=i;this.Tv(n,h)}else this.Xp.Yt().Bc(null),this.dv()}Tv(t,i){this.Ui().od(this.Pv(t),this.Rv(i),!1,g(this.Xp))}Kp(){this.Xp!==null&&this.Xp.g_().v(this),this.Xp=null}ov(t){const i=t.localX,s=t.localY;this.Wp.M()&&this.Wp.m(this.Ui().yt().Ru(i),{x:i,y:s},t)}Rp({context:t,bitmapSize:i}){const{width:s,height:n}=i,h=this.Ui(),r=h.Y(),o=h.ld();r===o?Xt(t,0,0,s,n,o):Ts(t,0,0,s,n,r,o)}wv(t){const i=g(this.Xp).w_().Zh().St();i!==null&&i.Z(t,!1)}Mv(t){const i=this.Ui().Ic();this.Dv(t,_t,hs,i),this.Dv(t,_t,ni,i)}xv(t){this.Dv(t,_t,ni,this.Ui().Vc())}Sv(t,i){const s=g(this.Xp).ko();for(const n of s)this.Dv(t,i,hs,n);for(const n of s)this.Dv(t,i,ni,n)}Dv(t,i,s,n){const h=g(this.Xp),r=i(n,h),o=h.Yt().Ac(),l=o!==null&&o.Lc===n,a=o!==null&&l&&o.av!==void 0?o.av.Dr:void 0;for(const c of r){const u=c.St();u!==null&&s(u,t,l,a)}}vv(t,i,s){for(const n of t){const h=n.St();if(h!==null&&h.Pr){const r=h.Pr(i,s);if(r!==null)return{Gf:n,av:r}}}return null}sv(){if(this.Xp===null)return;const t=this.Zp,i=this.Xp.l_().W().visible,s=this.Xp.a_().W().visible;i||this.Ip===null||(this.Jp.removeChild(this.Ip.gp()),this.Ip.S(),this.Ip=null),s||this.Vp===null||(this.Qp.removeChild(this.Vp.gp()),this.Vp.S(),this.Vp=null);const n=t.Yt().td();i&&this.Ip===null&&(this.Ip=new ns(this,t.W(),n,"left"),this.Jp.appendChild(this.Ip.gp())),s&&this.Vp===null&&(this.Vp=new ns(this,t.W(),n,"right"),this.Qp.appendChild(this.Vp.gp()))}Av(t){return t.Xf&&this.$p||this.Hp!==null}Pv(t){return Math.max(0,Math.min(t,this.Qf.width-1))}Rv(t){return Math.max(0,Math.min(t,this.Qf.height-1))}hv(t,i,s){this.Ui().Gc(this.Pv(t),this.Rv(i),s,g(this.Xp))}dv(){this.Ui().Jc()}pv(){this.Up&&(this.Hp=null,this.dv())}cv(t,i,s){this.Hp=t,this.Up=!1,this.hv(i.x,i.y,s);const n=this.Ui().Vc();this.Yp={x:n.Zt(),y:n.Kt()}}Ui(){return this.Zp.Yt()}uv(t){if(!this.Fp)return;const i=this.Ui(),s=this.Cp();if(i.f_(s,s.pn()),this.zp=null,this.Fp=!1,i.Xc(),this.qp!==null){const n=performance.now(),h=i.yt();this.qp.zr(h.Lu(),n),this.qp.Hu(n)||i.Xn(this.qp)}}rv(){this.Hp=null}lv(){if(this.Xp){if(this.Ui().Un(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)g(document.activeElement).blur();else{const t=document.getSelection();t!==null&&t.removeAllRanges()}!this.Xp.pn().Fi()&&this.Ui().yt().Fi()}}_v(t){if(this.Xp===null)return;const i=this.Ui(),s=i.yt();if(s.Fi())return;const n=this.Zp.W(),h=n.handleScroll,r=n.kineticScroll;if((!h.pressedMouseMove||t.Xf)&&(!h.horzTouchDrag&&!h.vertTouchDrag||!t.Xf))return;const o=this.Xp.pn(),l=performance.now();if(this.zp!==null||this.Av(t)||(this.zp={x:t.clientX,y:t.clientY,O_:l,Bv:t.localX,Lv:t.localY}),this.zp!==null&&!this.Fp&&(this.zp.x!==t.clientX||this.zp.y!==t.clientY)){if(t.Xf&&r.touch||!t.Xf&&r.mouse){const a=s.Gs();this.qp=new $n(.2/a,7/a,.997,15/a),this.qp.Sd(s.Lu(),this.zp.O_)}else this.qp=null;o.Fi()||i.c_(this.Xp,o,t.localY),i.Yc(t.localX),this.Fp=!0}this.Fp&&(o.Fi()||i.d_(this.Xp,o,t.localY),i.qc(t.localX),this.qp!==null&&this.qp.Sd(s.Lu(),l))}}class rs{constructor(t,i,s,n,h){this.bt=!0,this.Qf=y({width:0,height:0}),this.ep=()=>this.Tp(3),this.lp=t==="left",this.Sc=s.td,this.cn=i,this.Nv=n,this.Ov=h,this.ap=document.createElement("div"),this.ap.style.width="25px",this.ap.style.height="100%",this.ap.style.overflow="hidden",this.op=H(this.ap,y({width:16,height:16})),this.op.subscribeSuggestedBitmapSizeChanged(this.ep)}S(){this.op.unsubscribeSuggestedBitmapSizeChanged(this.ep),this.op.dispose()}gp(){return this.ap}bv(){return this.Qf}kp(t){Y(this.Qf,t)||(this.Qf=t,this.op.resizeCanvasElement(t),this.ap.style.width=`${t.width}px`,this.ap.style.height=`${t.height}px`,this.bt=!0)}Tp(t){if(t<3&&!this.bt||this.Qf.width===0||this.Qf.height===0)return;this.bt=!1,this.op.applySuggestedBitmapSize();const i=D(this.op);i!==null&&i.useBitmapCoordinateSpace(s=>{this.Rp(s),this.We(s)})}Lp(){return this.op.bitmapSize}Np(t,i,s){const n=this.Lp();n.width>0&&n.height>0&&t.drawImage(this.op.canvasElement,i,s)}We({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:n}){if(!this.Nv())return;t.fillStyle=this.cn.timeScale.borderColor;const h=Math.floor(this.Sc.W().C*s),r=Math.floor(this.Sc.W().C*n),o=this.lp?i.width-h:0;t.fillRect(o,0,h,r)}Rp({context:t,bitmapSize:i}){Xt(t,0,0,i.width,i.height,this.Ov())}}function Dn(e,t){return e.U_>t.U_?e:t}class jn{constructor(t){this.Ev=null,this.Iv=null,this.k=null,this.Vv=!1,this.Qf=y({width:0,height:0}),this.zv=new _,this.ip=new gt(5),this.sp=!1,this.ep=()=>{this.sp||this.Zp.Yt().Xh()},this.hp=()=>{this.sp||this.Zp.Yt().Xh()},this.Zp=t,this.cn=t.W().layout,this.Fv=document.createElement("tr"),this.Wv=document.createElement("td"),this.Wv.style.padding="0",this.jv=document.createElement("td"),this.jv.style.padding="0",this.ap=document.createElement("td"),this.ap.style.height="25px",this.ap.style.padding="0",this.$v=document.createElement("div"),this.$v.style.width="100%",this.$v.style.height="100%",this.$v.style.position="relative",this.$v.style.overflow="hidden",this.ap.appendChild(this.$v),this.op=H(this.$v,y({width:16,height:16})),this.op.subscribeSuggestedBitmapSizeChanged(this.ep);const i=this.op.canvasElement;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this._p=H(this.$v,y({width:16,height:16})),this._p.subscribeSuggestedBitmapSizeChanged(this.hp);const s=this._p.canvasElement;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Fv.appendChild(this.Wv),this.Fv.appendChild(this.ap),this.Fv.appendChild(this.jv),this.Hv(),this.Zp.Yt().Jo().l(this.Hv.bind(this),this),this.bp=new Mi(this._p.canvasElement,this,{Sf:()=>!0,xf:()=>!1})}S(){this.bp.S(),this.Ev!==null&&this.Ev.S(),this.Iv!==null&&this.Iv.S(),this._p.unsubscribeSuggestedBitmapSizeChanged(this.hp),this._p.dispose(),this.op.unsubscribeSuggestedBitmapSizeChanged(this.ep),this.op.dispose()}gp(){return this.Fv}Uv(){return this.Ev}Yv(){return this.Iv}Ef(t){if(this.Vv)return;this.Vv=!0;const i=this.Zp.Yt();!i.yt().Fi()&&this.Zp.W().handleScale.axisPressedMouseMove.time&&i.$c(t.localX)}Nf(t){this.Ef(t)}If(){const t=this.Zp.Yt();!t.yt().Fi()&&this.Vv&&(this.Vv=!1,this.Zp.W().handleScale.axisPressedMouseMove.time&&t.Kc())}Cf(t){const i=this.Zp.Yt();!i.yt().Fi()&&this.Zp.W().handleScale.axisPressedMouseMove.time&&i.Zc(t.localX)}kf(t){this.Cf(t)}Df(){this.Vv=!1;const t=this.Zp.Yt();t.yt().Fi()&&!this.Zp.W().handleScale.axisPressedMouseMove.time||t.Kc()}Pf(){this.Df()}_f(){this.Zp.W().handleScale.axisDoubleClickReset.time&&this.Zp.Yt().Kn()}rf(){this._f()}mf(){this.Zp.Yt().W().handleScale.axisPressedMouseMove.time&&this.Op(1)}Yf(){this.Op(0)}bv(){return this.Qf}qv(){return this.zv}Xv(t,i,s){Y(this.Qf,t)||(this.Qf=t,this.sp=!0,this.op.resizeCanvasElement(t),this._p.resizeCanvasElement(t),this.sp=!1,this.ap.style.width=`${t.width}px`,this.ap.style.height=`${t.height}px`,this.zv.m(t)),this.Ev!==null&&this.Ev.kp(y({width:i,height:t.height})),this.Iv!==null&&this.Iv.kp(y({width:s,height:t.height}))}Zv(){const t=this.Kv();return Math.ceil(t.C+t.T+t.P+t.I+t.L+t.Gv)}wt(){this.Zp.Yt().yt().Ca()}Lp(){return this.op.bitmapSize}Np(t,i,s){const n=this.Lp();n.width>0&&n.height>0&&t.drawImage(this.op.canvasElement,i,s)}Tp(t){if(t===0)return;if(t!==1){this.op.applySuggestedBitmapSize();const s=D(this.op);s!==null&&(s.useBitmapCoordinateSpace(n=>{this.Rp(n),this.We(n)}),this.Dp(s)),this.Ev!==null&&this.Ev.Tp(t),this.Iv!==null&&this.Iv.Tp(t)}this._p.applySuggestedBitmapSize();const i=D(this._p);i!==null&&(i.useBitmapCoordinateSpace(({context:s,bitmapSize:n})=>{s.clearRect(0,0,n.width,n.height)}),this.Jv([this.Zp.Yt().Vc()],i))}Rp({context:t,bitmapSize:i}){Xt(t,0,0,i.width,i.height,this.Zp.Yt().ld())}We({context:t,bitmapSize:i,verticalPixelRatio:s}){if(this.Zp.W().timeScale.borderVisible){t.fillStyle=this.Qv();const n=Math.max(1,Math.floor(this.Kv().C*s));t.fillRect(0,0,i.width,n)}}Dp(t){const i=this.Zp.Yt().yt(),s=i.Ca();if(!s||s.length===0)return;let n=s.reduce(Dn,s[0]).U_;n>30&&n<50&&(n=30);const h=this.Kv(),r=i.W();r.borderVisible&&r.ticksVisible&&t.useBitmapCoordinateSpace(({context:o,horizontalPixelRatio:l,verticalPixelRatio:a})=>{o.strokeStyle=this.Qv(),o.fillStyle=this.Qv();const c=Math.max(1,Math.floor(l)),u=Math.floor(.5*l);o.beginPath();const d=Math.round(h.T*a);for(let f=s.length;f--;){const p=Math.round(s[f].Ma*l);o.rect(p-u,0,c,d)}o.fill()}),t.useMediaCoordinateSpace(({context:o})=>{const l=h.C+h.T+h.I+h.P/2;o.textAlign="center",o.textBaseline="middle",o.fillStyle=this.H(),o.font=this.Sp();for(const a of s)if(a.U_<n){const c=a.Eu?this.tm(o,a.Ma,a.Ce):a.Ma;o.fillText(a.Ce,c,l)}o.font=this.im();for(const a of s)if(a.U_>=n){const c=a.Eu?this.tm(o,a.Ma,a.Ce):a.Ma;o.fillText(a.Ce,c,l)}})}tm(t,i,s){const n=this.ip.xi(t,s),h=n/2,r=Math.floor(i-h)+.5;return r<0?i+=Math.abs(0-r):r+n>this.Qf.width&&(i-=Math.abs(this.Qf.width-(r+n))),i}Jv(t,i){const s=this.Kv();for(const n of t)for(const h of n.tn())h.St().Z(i,s)}Qv(){return this.Zp.W().timeScale.borderColor}H(){return this.cn.textColor}j(){return this.cn.fontSize}Sp(){return it(this.j(),this.cn.fontFamily)}im(){return it(this.j(),this.cn.fontFamily,"bold")}Kv(){this.k===null&&(this.k={C:1,V:NaN,I:NaN,L:NaN,$i:NaN,T:5,P:NaN,R:"",ji:new gt,Gv:0});const t=this.k,i=this.Sp();if(t.R!==i){const s=this.j();t.P=s,t.R=i,t.I=3*s/12,t.L=3*s/12,t.$i=9*s/12,t.V=0,t.Gv=4*s/12,t.ji.ur()}return this.k}Op(t){this.ap.style.cursor=t===1?"ew-resize":"default"}Hv(){const t=this.Zp.Yt(),i=t.W();i.leftPriceScale.visible||this.Ev===null||(this.Wv.removeChild(this.Ev.gp()),this.Ev.S(),this.Ev=null),i.rightPriceScale.visible||this.Iv===null||(this.jv.removeChild(this.Iv.gp()),this.Iv.S(),this.Iv=null);const s={td:this.Zp.Yt().td()},n=()=>i.leftPriceScale.borderVisible&&t.yt().W().borderVisible,h=()=>t.ld();i.leftPriceScale.visible&&this.Ev===null&&(this.Ev=new rs("left",i,s,n,h),this.Wv.appendChild(this.Ev.gp())),i.rightPriceScale.visible&&this.Iv===null&&(this.Iv=new rs("right",i,s,n,h),this.jv.appendChild(this.Iv.gp()))}}const Hn=!!st&&!!navigator.userAgentData&&navigator.userAgentData.brands.some(e=>e.brand.includes("Chromium"))&&!!st&&(!((hi=navigator==null?void 0:navigator.userAgentData)===null||hi===void 0)&&hi.platform?navigator.userAgentData.platform==="Windows":navigator.userAgent.toLowerCase().indexOf("win")>=0);var hi;class Jn{constructor(t,i){var s;this.nm=[],this.sm=0,this.Va=0,this.Wo=0,this.rm=0,this.hm=0,this.lm=null,this.am=!1,this.Wp=new _,this.gc=new _,this.om=null,this._m=t,this.cn=i,this.Fv=document.createElement("div"),this.Fv.classList.add("tv-lightweight-charts"),this.Fv.style.overflow="hidden",this.Fv.style.width="100%",this.Fv.style.height="100%",(s=this.Fv).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.um=document.createElement("table"),this.um.setAttribute("cellspacing","0"),this.Fv.appendChild(this.um),this.dm=this.fm.bind(this),ri(this.cn)&&this.pm(!0),this.Ui=new Xn(this.Mc.bind(this),this.cn),this.Yt().zc().l(this.vm.bind(this),this),this.bm=new jn(this),this.um.appendChild(this.bm.gp());const n=i.autoSize&&this.gm();let h=this.cn.width,r=this.cn.height;if(n||h===0||r===0){const o=t.getBoundingClientRect();h=h||o.width,r=r||o.height}this.wm(h,r),this.Mm(),t.appendChild(this.Fv),this.Sm(),this.Ui.yt().Xu().l(this.Ui.zl.bind(this.Ui),this),this.Ui.Jo().l(this.Ui.zl.bind(this.Ui),this)}Yt(){return this.Ui}W(){return this.cn}xm(){return this.nm}km(){return this.bm}S(){this.pm(!1),this.sm!==0&&window.cancelAnimationFrame(this.sm),this.Ui.zc().v(this),this.Ui.yt().Xu().v(this),this.Ui.Jo().v(this),this.Ui.S();for(const t of this.nm)this.um.removeChild(t.gp()),t.fv().v(this),t.S();this.nm=[],g(this.bm).S(),this.Fv.parentElement!==null&&this.Fv.parentElement.removeChild(this.Fv),this.gc.S(),this.Wp.S(),this.ym()}wm(t,i,s=!1){if(this.Va===i&&this.Wo===t)return;const n=function(o){const l=Math.floor(o.width),a=Math.floor(o.height);return y({width:l-l%2,height:a-a%2})}(y({width:t,height:i}));this.Va=n.height,this.Wo=n.width;const h=this.Va+"px",r=this.Wo+"px";g(this.Fv).style.height=h,g(this.Fv).style.width=r,this.um.style.height=h,this.um.style.width=r,s?this.Cm(M.es(),performance.now()):this.Ui.zl()}Tp(t){t===void 0&&(t=M.es());for(let i=0;i<this.nm.length;i++)this.nm[i].Tp(t.$n(i).Fn);this.cn.timeScale.visible&&this.bm.Tp(t.jn())}qh(t){const i=ri(this.cn);this.Ui.qh(t);const s=ri(this.cn);s!==i&&this.pm(s),this.Sm(),this.Tm(t)}fv(){return this.Wp}zc(){return this.gc}Pm(){this.lm!==null&&(this.Cm(this.lm,performance.now()),this.lm=null);const t=this.Rm(null),i=document.createElement("canvas");i.width=t.width,i.height=t.height;const s=g(i.getContext("2d"));return this.Rm(s),i}Dm(t){return t==="left"&&!this.Am()||t==="right"&&!this.Bm()||this.nm.length===0?0:g(t==="left"?this.nm[0].kv():this.nm[0].yv()).yp()}Lm(){return this.cn.autoSize&&this.om!==null}Tm(t){(t.autoSize!==void 0||!this.om||t.width===void 0&&t.height===void 0)&&(t.autoSize&&!this.om&&this.gm(),t.autoSize===!1&&this.om!==null&&this.ym(),t.autoSize||t.width===void 0&&t.height===void 0||this.wm(t.width||this.Wo,t.height||this.Va))}Rm(t){let i=0,s=0;const n=this.nm[0],h=(o,l)=>{let a=0;for(let c=0;c<this.nm.length;c++){const u=this.nm[c],d=g(o==="left"?u.kv():u.yv()),f=d.Lp();t!==null&&d.Np(t,l,a),a+=f.height}};this.Am()&&(h("left",0),i+=g(n.kv()).Lp().width);for(let o=0;o<this.nm.length;o++){const l=this.nm[o],a=l.Lp();t!==null&&l.Np(t,i,s),s+=a.height}i+=n.Lp().width,this.Bm()&&(h("right",i),i+=g(n.yv()).Lp().width);const r=(o,l,a)=>{g(o==="left"?this.bm.Uv():this.bm.Yv()).Np(g(t),l,a)};if(this.cn.timeScale.visible){const o=this.bm.Lp();if(t!==null){let l=0;this.Am()&&(r("left",l,s),l=g(n.kv()).Lp().width),this.bm.Np(t,l,s),l+=o.width,this.Bm()&&r("right",l,s)}s+=o.height}return y({width:i,height:s})}Nm(){let t=0,i=0,s=0;for(const p of this.nm)this.Am()&&(i=Math.max(i,g(p.kv()).Mp())),this.Bm()&&(s=Math.max(s,g(p.yv()).Mp())),t+=p.Qo();i=di(i),s=di(s);const n=this.Wo,h=this.Va,r=Math.max(n-i-s,0),o=this.cn.timeScale.visible;let l=o?this.bm.Zv():0;var a;l=(a=l)+a%2;const c=0+l,u=h<c?0:h-c,d=u/t;let f=0;for(let p=0;p<this.nm.length;++p){const m=this.nm[p];m.nv(this.Ui.Ec()[p]);let b=0,v=0;v=p===this.nm.length-1?u-f:Math.round(m.Qo()*d),b=Math.max(v,2),f+=b,m.kp(y({width:r,height:b})),this.Am()&&m.mv(i,"left"),this.Bm()&&m.mv(s,"right"),m.Cp()&&this.Ui.Fc(m.Cp(),b)}this.bm.Xv(y({width:o?r:0,height:l}),o?i:0,o?s:0),this.Ui.i_(r),this.rm!==i&&(this.rm=i),this.hm!==s&&(this.hm=s)}pm(t){t?this.Fv.addEventListener("wheel",this.dm,{passive:!1}):this.Fv.removeEventListener("wheel",this.dm)}Om(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return Hn?1/window.devicePixelRatio:1}fm(t){if(!(t.deltaX!==0&&this.cn.handleScroll.mouseWheel||t.deltaY!==0&&this.cn.handleScale.mouseWheel))return;const i=this.Om(t),s=i*t.deltaX/100,n=-i*t.deltaY/100;if(t.cancelable&&t.preventDefault(),n!==0&&this.cn.handleScale.mouseWheel){const h=Math.sign(n)*Math.min(1,Math.abs(n)),r=t.clientX-this.Fv.getBoundingClientRect().left;this.Yt().Hc(r,h)}s!==0&&this.cn.handleScroll.mouseWheel&&this.Yt().Uc(-80*s)}Cm(t,i){var s;const n=t.jn();n===3&&this.Em(),n!==3&&n!==2||(this.Im(t),this.Vm(t,i),this.bm.wt(),this.nm.forEach(h=>{h.ev()}),((s=this.lm)===null||s===void 0?void 0:s.jn())===3&&(this.lm.ts(t),this.Em(),this.Im(this.lm),this.Vm(this.lm,i),t=this.lm,this.lm=null)),this.Tp(t)}Vm(t,i){for(const s of t.Qn())this.ns(s,i)}Im(t){const i=this.Ui.Ec();for(let s=0;s<i.length;s++)t.$n(s).Wn&&i[s].m_()}ns(t,i){const s=this.Ui.yt();switch(t.Yn){case 0:s.Ku();break;case 1:s.Gu(t.Lt);break;case 2:s.Gn(t.Lt);break;case 3:s.Jn(t.Lt);break;case 4:s.Iu();break;case 5:t.Lt.Hu(i)||s.Jn(t.Lt.Uu(i))}}Mc(t){this.lm!==null?this.lm.ts(t):this.lm=t,this.am||(this.am=!0,this.sm=window.requestAnimationFrame(i=>{if(this.am=!1,this.sm=0,this.lm!==null){const s=this.lm;this.lm=null,this.Cm(s,i);for(const n of s.Qn())if(n.Yn===5&&!n.Lt.Hu(i)){this.Yt().Xn(n.Lt);break}}}))}Em(){this.Mm()}Mm(){const t=this.Ui.Ec(),i=t.length,s=this.nm.length;for(let n=i;n<s;n++){const h=P(this.nm.pop());this.um.removeChild(h.gp()),h.fv().v(this),h.S()}for(let n=s;n<i;n++){const h=new _i(this,t[n]);h.fv().l(this.zm.bind(this),this),this.nm.push(h),this.um.insertBefore(h.gp(),this.bm.gp())}for(let n=0;n<i;n++){const h=t[n],r=this.nm[n];r.Cp()!==h?r.nv(h):r.iv()}this.Sm(),this.Nm()}Fm(t,i,s){var n;const h=new Map;t!==null&&this.Ui.Mt().forEach(c=>{const u=c.On().fl(t);u!==null&&h.set(c,u)});let r;if(t!==null){const c=(n=this.Ui.yt().Yi(t))===null||n===void 0?void 0:n.Y_;c!==void 0&&(r=c)}const o=this.Yt().Ac(),l=o!==null&&o.Lc instanceof yi?o.Lc:void 0,a=o!==null&&o.av!==void 0?o.av.Rr:void 0;return{ut:r,Xs:t??void 0,Wm:i??void 0,jm:l,$m:h,Hm:a,Um:s??void 0}}zm(t,i,s){this.Wp.m(()=>this.Fm(t,i,s))}vm(t,i,s){this.gc.m(()=>this.Fm(t,i,s))}Sm(){const t=this.cn.timeScale.visible?"":"none";this.bm.gp().style.display=t}Am(){return this.nm[0].Cp().l_().W().visible}Bm(){return this.nm[0].Cp().a_().W().visible}gm(){return"ResizeObserver"in window&&(this.om=new ResizeObserver(t=>{const i=t.find(s=>s.target===this._m);i&&this.wm(i.contentRect.width,i.contentRect.height)}),this.om.observe(this._m,{box:"border-box"}),!0)}ym(){this.om!==null&&this.om.disconnect()}}function ri(e){return!!(e.handleScroll.mouseWheel||e.handleScale.mouseWheel)}function os(e,t,i,s){const n=i.value,h={Xs:t,ut:e,Lt:[n,n,n,n],Y_:s};return i.color!==void 0&&(h.A=i.color),h}function Vt(e){return e.Lt!==void 0}function $(e){return(t,i,s,n)=>{return(h=s).lowerValue===void 0&&h.open===void 0&&h.value===void 0?{ut:t,Xs:i,Y_:n}:e(t,i,s,n);var h}}const Gn={Candlestick:$(function(e,t,i,s){const n={Xs:t,ut:e,Lt:[i.open,i.high,i.low,i.close],Y_:s};return i.color!==void 0&&(n.A=i.color),i.borderColor!==void 0&&(n.Nt=i.borderColor),i.wickColor!==void 0&&(n.tl=i.wickColor),n}),Bar:$(function(e,t,i,s){const n={Xs:t,ut:e,Lt:[i.open,i.high,i.low,i.close],Y_:s};return i.color!==void 0&&(n.A=i.color),n}),Area:$(function(e,t,i,s){const n=i.value,h={Xs:t,ut:e,Lt:[n,n,n,n],Y_:s};return i.lineColor!==void 0&&(h._t=i.lineColor),i.topColor!==void 0&&(h.gs=i.topColor),i.bottomColor!==void 0&&(h.ws=i.bottomColor),h}),Baseline:$(function(e,t,i,s){const n=i.value,h={Xs:t,ut:e,Lt:[n,n,n,n],Y_:s};return i.topLineColor!==void 0&&(h.ge=i.topLineColor),i.bottomLineColor!==void 0&&(h.we=i.bottomLineColor),i.topFillColor1!==void 0&&(h.fe=i.topFillColor1),i.topFillColor2!==void 0&&(h.pe=i.topFillColor2),i.bottomFillColor1!==void 0&&(h.ve=i.bottomFillColor1),i.bottomFillColor2!==void 0&&(h.me=i.bottomFillColor2),h}),CloudArea:$(function(e,t,i,s){return{Xs:t,ut:e,Lt:[i.higherValue,i.higherValue,i.lowerValue,i.lowerValue],Y_:s}}),BrokenArea:$(function(e,t,i,s){const n={Xs:t,ut:e,Lt:[i.higherValue,i.higherValue,i.lowerValue,i.lowerValue],Y_:s};return i.color!==void 0&&(n.A=i.color),i.label!==void 0&&(n.Ce=i.label),i.extendRight!==void 0&&(n.Pe=i.extendRight),i.id!==void 0&&(n.Ve=i.id),n}),Histogram:$(os),Line:$(os)};function ls(e){return Gn[e]}function Tt(e){return 60*e*60*1e3}function oi(e){return 60*e*1e3}const Lt=[{Ym:(as=1,1e3*as),U_:10},{Ym:oi(1),U_:20},{Ym:oi(5),U_:21},{Ym:oi(30),U_:22},{Ym:Tt(1),U_:30},{Ym:Tt(3),U_:31},{Ym:Tt(6),U_:32},{Ym:Tt(12),U_:33}];var as;function cs(e,t){if(e.getUTCFullYear()!==t.getUTCFullYear())return 70;if(e.getUTCMonth()!==t.getUTCMonth())return 60;if(e.getUTCDate()!==t.getUTCDate())return 50;for(let i=Lt.length-1;i>=0;--i)if(Math.floor(t.getTime()/Lt[i].Ym)!==Math.floor(e.getTime()/Lt[i].Ym))return Lt[i].U_;return 0}function us(e,t=0){if(e.length===0)return;let i=t===0?null:e[t-1].ut.O_,s=i!==null?new Date(1e3*i):null,n=0;for(let h=t;h<e.length;++h){const r=e[h],o=new Date(1e3*r.ut.O_);s!==null&&(r.H_=cs(o,s)),n+=r.ut.O_-(i||r.ut.O_),i=r.ut.O_,s=o}if(t===0&&e.length>1){const h=Math.ceil(n/(e.length-1)),r=new Date(1e3*(e[0].ut.O_-h));e[0].H_=cs(new Date(1e3*e[0].ut.O_),r)}}function fi(e){if(!xi(e))throw new Error("time must be of type BusinessDay");const t=new Date(Date.UTC(e.year,e.month-1,e.day,0,0,0,0));return{O_:Math.round(t.getTime()/1e3),N_:e}}function Ys(e){if(!Is(e))throw new Error("time must be of type isUTCTimestamp");return{O_:e}}function ds(e){return e.length===0?null:xi(e[0].time)?fi:Ys}function Et(e){return Is(e)?Ys(e):xi(e)?fi(e):fi(Ds(e))}function Ds(e){const t=new Date(e);if(isNaN(t.getTime()))throw new Error(`Invalid date string=${e}, expected format=yyyy-mm-dd`);return{day:t.getUTCDate(),month:t.getUTCMonth()+1,year:t.getUTCFullYear()}}function fs(e){mi(e.time)&&(e.time=Ds(e.time))}function ps(e){return{Xs:0,qm:new Map,Ql:e}}function ms(e){if(e!==void 0&&e.length!==0)return{Xm:e[0].ut.O_,Zm:e[e.length-1].ut.O_}}function gs(e){let t;return e.forEach(i=>{t===void 0&&(t=i.Y_)}),P(t)}function bs(e){e.Y_===void 0&&(e.Y_=e.time)}class Zn{constructor(){this.Km=new Map,this.Gm=new Map,this.Jm=new Map,this.Qm=[]}S(){this.Km.clear(),this.Gm.clear(),this.Jm.clear(),this.Qm=[]}tb(t,i){let s=this.Km.size!==0,n=!1;const h=this.Gm.get(t);if(h!==void 0)if(this.Gm.size===1)s=!1,n=!0,this.Km.clear();else for(const l of this.Qm)l.pointData.qm.delete(t)&&(n=!0);let r=[];if(i.length!==0){const l=i;l.forEach(u=>bs(u)),function(u){u.forEach(fs)}(i);const a=g(ds(i)),c=ls(t.hl());r=l.map(u=>{const d=a(u.time);let f=this.Km.get(d.O_);f===void 0&&(f=ps(d),this.Km.set(d.O_,f),n=!0);const p=c(d,f.Xs,u,u.Y_);return f.qm.set(t,p),p})}s&&this.ib(),this.nb(t,r);let o=-1;if(n){const l=[];this.Km.forEach(a=>{l.push({H_:0,ut:a.Ql,pointData:a,Y_:gs(a.qm)})}),l.sort((a,c)=>a.ut.O_-c.ut.O_),o=this.sb(l)}return this.eb(t,o,function(l,a){const c=ms(l),u=ms(a);if(c!==void 0&&u!==void 0)return{jl:c.Zm>=u.Zm&&c.Xm>=u.Xm}}(this.Gm.get(t),h))}ed(t){return this.tb(t,[])}rb(t,i){const s=i;bs(s),fs(i);const n=g(ds([i]))(i.time),h=this.Jm.get(t);if(h!==void 0&&n.O_<h.O_)throw new Error(`Cannot update oldest data, last time=${h.O_}, new time=${n.O_}`);let r=this.Km.get(n.O_);const o=r===void 0;r===void 0&&(r=ps(n),this.Km.set(n.O_,r));const l=ls(t.hl())(n,r.Xs,i,s.Y_);r.qm.set(t,l),this.hb(t,l);const a={jl:Vt(l)};if(!o)return this.eb(t,-1,a);const c={H_:0,ut:r.Ql,pointData:r,Y_:gs(r.qm)},u=wt(this.Qm,c.ut.O_,(d,f)=>d.ut.O_<f);this.Qm.splice(u,0,c);for(let d=u;d<this.Qm.length;++d)li(this.Qm[d].pointData,d);return us(this.Qm,u),this.eb(t,u,a)}hb(t,i){let s=this.Gm.get(t);s===void 0&&(s=[],this.Gm.set(t,s));const n=s.length!==0?s[s.length-1]:null;n===null||i.ut.O_>n.ut.O_?Vt(i)&&s.push(i):Vt(i)?s[s.length-1]=i:s.splice(-1,1),this.Jm.set(t,i.ut)}nb(t,i){i.length!==0?(this.Gm.set(t,i.filter(Vt)),this.Jm.set(t,i[i.length-1].ut)):(this.Gm.delete(t),this.Jm.delete(t))}ib(){for(const t of this.Qm)t.pointData.qm.size===0&&this.Km.delete(t.ut.O_)}sb(t){let i=-1;for(let s=0;s<this.Qm.length&&s<t.length;++s){const n=this.Qm[s],h=t[s];if(n.ut.O_!==h.ut.O_){i=s;break}h.H_=n.H_,li(h.pointData,s)}if(i===-1&&this.Qm.length!==t.length&&(i=Math.min(this.Qm.length,t.length)),i===-1)return-1;for(let s=i;s<t.length;++s)li(t[s].pointData,s);return us(t,i),this.Qm=t,i}lb(){if(this.Gm.size===0)return null;let t=0;return this.Gm.forEach(i=>{i.length!==0&&(t=Math.max(t,i[i.length-1].Xs))}),t}eb(t,i,s){const n={ab:new Map,yt:{Pu:this.lb()}};if(i!==-1)this.Gm.forEach((h,r)=>{n.ab.set(r,{Or:h,ob:r===t?s:void 0})}),this.Gm.has(t)||n.ab.set(t,{Or:[],ob:s}),n.yt._b=this.Qm,n.yt.ub=i;else{const h=this.Gm.get(t);n.ab.set(t,{Or:h||[],ob:s})}return n}}function li(e,t){e.Xs=t,e.qm.forEach(i=>{i.Xs=t})}function ct(e){return{value:e.Lt[3],time:e.Y_}}function vs(e){const t=ct(e);return e.A!==void 0&&(t.color=e.A),t}function ws(e){return{open:e.Lt[0],high:e.Lt[1],low:e.Lt[2],close:e.Lt[3],time:e.Y_}}const Qn={Area:function(e){const t=ct(e);return e._t!==void 0&&(t.lineColor=e._t),e.gs!==void 0&&(t.topColor=e.gs),e.ws!==void 0&&(t.bottomColor=e.ws),t},Line:vs,Baseline:function(e){const t=ct(e);return e.ge!==void 0&&(t.topLineColor=e.ge),e.we!==void 0&&(t.bottomLineColor=e.we),e.fe!==void 0&&(t.topFillColor1=e.fe),e.pe!==void 0&&(t.topFillColor2=e.pe),e.ve!==void 0&&(t.bottomFillColor1=e.ve),e.me!==void 0&&(t.bottomFillColor2=e.me),t},Histogram:vs,Bar:function(e){const t=ws(e);return e.A!==void 0&&(t.color=e.A),t},Candlestick:function(e){const t=ws(e),{A:i,Nt:s,tl:n}=e;return i!==void 0&&(t.color=i),s!==void 0&&(t.borderColor=s),n!==void 0&&(t.wickColor=n),t},BrokenArea:function(e){return ct(e)},CloudArea:function(e){return ct(e)}};function js(e){return Qn[e]}const ai={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2}},qn={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:gi,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},Ss={width:0,height:0,autoSize:!1,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:gi},crosshair:{vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},ai),leftPriceScale:Object.assign(Object.assign({},ai),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},ai),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!1},watermark:qn,localization:{locale:st?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},Kn={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},th={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},ih={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},sh={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},eh={positiveColor:"rgba( 76, 175, 80, 0.1)",negativeColor:"rgba( 255, 82, 82, 0.1)",higherLineColor:"#4CAF50",higherLineStyle:0,higherLineWidth:3,higherLineType:0,lowerLineColor:"#FF5252",lowerLineStyle:0,lowerLineWidth:3,lowerLineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:""},nh={color:"rgba( 41, 98, 255, 0.01)",strokeColor:"",strokeWidth:0,compositeOperation:"",crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:""},hh={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},rh={color:"#26a69a",base:0},oh={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class lh{constructor(t,i){this.cb=t,this.fb=i}applyOptions(t){this.cb.Yt().Nc(this.fb,t)}options(){return this.Vi().W()}width(){return $t(this.fb)?this.cb.Dm(this.fb):0}Vi(){return g(this.cb.Yt().Oc(this.fb)).Bt}}const ah={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",axisLabelColor:"",axisLabelTextColor:""};class Cs{constructor(t){this.jh=t}applyOptions(t){this.jh.qh(t)}options(){return this.jh.W()}pb(){return this.jh}}class ch{constructor(t,i,s){this.Ps=t,this.vb=i,this.mb=s}priceFormatter(){return this.Ps.ha()}priceToCoordinate(t){const i=this.Ps.Pt();return i===null?null:this.Ps.Bt().At(t,i.Lt)}coordinateToPrice(t){const i=this.Ps.Pt();return i===null?null:this.Ps.Bt().vn(t,i.Lt)}barsInLogicalRange(t){if(t===null)return null;const i=new tt(new pt(t.from,t.to)).G_(),s=this.Ps.On();if(s.Fi())return null;const n=s.fl(i.Ss(),1),h=s.fl(i.di(),-1),r=g(s.ul()),o=g(s.Nn());if(n!==null&&h!==null&&n.Xs>h.Xs)return{barsBefore:t.from-r,barsAfter:o-t.to};const l={barsBefore:n===null||n.Xs===r?t.from-r:n.Xs-r,barsAfter:h===null||h.Xs===o?o-t.to:o-h.Xs};return n!==null&&h!==null&&(l.from=n.ut.N_||n.ut.O_,l.to=h.ut.N_||h.ut.O_),l}setData(t){this.Ps.hl(),this.vb.bb(this.Ps,t)}update(t){this.Ps.hl(),this.vb.gb(this.Ps,t)}dataByIndex(t,i){const s=this.Ps.On().fl(t,i);return s===null?null:js(this.seriesType())(s)}setMarkers(t){const i=t.map(s=>Object.assign(Object.assign({},s),{originalTime:s.time,time:Et(s.time)}));this.Ps.Hl(i)}markers(){return this.Ps.Ul().map(t=>{const{originalTime:i,time:s}=t,n=function(h,r){var o={};for(var l in h)Object.prototype.hasOwnProperty.call(h,l)&&r.indexOf(l)<0&&(o[l]=h[l]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function"){var a=0;for(l=Object.getOwnPropertySymbols(h);a<l.length;a++)r.indexOf(l[a])<0&&Object.prototype.propertyIsEnumerable.call(h,l[a])&&(o[l[a]]=h[l[a]])}return o}(t,["originalTime","time"]);return Object.assign({time:i},n)})}applyOptions(t){this.Ps.qh(t)}options(){return A(this.Ps.W())}priceScale(){return this.mb.priceScale(this.Ps.Bt().Ve())}createPriceLine(t){const i=B(A(ah),t),s=this.Ps.Yl(i);return new Cs(s)}removePriceLine(t){this.Ps.ql(t.pb())}removeAllPriceLines(){this.Ps.Gl()}getPriceLine(t,i){const s=this.Ps.Xl(t,i);if(s)return new Cs(s)}seriesType(){return this.Ps.hl()}setExtensionsBoundaries(t){return this.Ps.Oe(t)}}class uh{constructor(t,i){this.wb=new _,this.lu=new _,this.zv=new _,this.Ui=t,this.Ho=t.yt(),this.bm=i,this.Ho.Yu().l(this.Mb.bind(this)),this.Ho.qu().l(this.Sb.bind(this)),this.bm.qv().l(this.xb.bind(this))}S(){this.Ho.Yu().v(this),this.Ho.qu().v(this),this.bm.qv().v(this),this.wb.S(),this.lu.S(),this.zv.S()}scrollPosition(){return this.Ho.Lu()}scrollToPosition(t,i){i?this.Ho.$u(t,1e3):this.Ui.Jn(t)}scrollToRealTime(){this.Ho.ju()}getVisibleRange(){var t,i;const s=this.Ho.Mu();return s===null?null:{from:(t=s.from.N_)!==null&&t!==void 0?t:s.from.O_,to:(i=s.to.N_)!==null&&i!==void 0?i:s.to.O_}}setVisibleRange(t){const i={from:Et(t.from),to:Et(t.to)},s=this.Ho.yu(i);this.Ui.rd(s)}getVisibleLogicalRange(){const t=this.Ho.wu();return t===null?null:{from:t.Ss(),to:t.di()}}setVisibleLogicalRange(t){J(t.from<=t.to,"The from index cannot be after the to index."),this.Ui.rd(t)}resetTimeScale(){this.Ui.Kn()}fitContent(){this.Ui.Ku()}logicalToCoordinate(t){const i=this.Ui.yt();return i.Fi()?null:i.It(t)}coordinateToLogical(t){return this.Ho.Fi()?null:this.Ho.Ru(t)}timeToCoordinate(t){const i=Et(t),s=this.Ho.fa(i,!1);return s===null?null:this.Ho.It(s)}coordinateToTime(t){var i;const s=this.Ui.yt(),n=s.Ru(t),h=s.mn(n);return h===null?null:(i=h.N_)!==null&&i!==void 0?i:h.O_}width(){return this.bm.bv().width}height(){return this.bm.bv().height}subscribeVisibleTimeRangeChange(t){this.wb.l(t)}unsubscribeVisibleTimeRangeChange(t){this.wb.p(t)}subscribeVisibleLogicalRangeChange(t){this.lu.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.lu.p(t)}subscribeSizeChange(t){this.zv.l(t)}unsubscribeSizeChange(t){this.zv.p(t)}applyOptions(t){this.Ho.qh(t)}options(){return A(this.Ho.W())}Mb(){this.wb.M()&&this.wb.m(this.getVisibleRange())}Sb(){this.lu.M()&&this.lu.m(this.getVisibleLogicalRange())}xb(t){this.zv.m(t.width,t.height)}}function dh(e){if(e===void 0||e.type==="custom")return;const t=e;t.minMove!==void 0&&t.precision===void 0&&(t.precision=function(i){if(i>=1)return 0;let s=0;for(;s<8;s++){const n=Math.round(i);if(Math.abs(n-i)<1e-8)return s;i*=10}return s}(t.minMove))}function ys(e){return function(t){if(Ct(t.handleScale)){const s=t.handleScale;t.handleScale={axisDoubleClickReset:{time:s,price:s},axisPressedMouseMove:{time:s,price:s},mouseWheel:s,pinch:s}}else if(t.handleScale!==void 0){const{axisPressedMouseMove:s,axisDoubleClickReset:n}=t.handleScale;Ct(s)&&(t.handleScale.axisPressedMouseMove={time:s,price:s}),Ct(n)&&(t.handleScale.axisDoubleClickReset={time:n,price:n})}const i=t.handleScroll;Ct(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(e),e}class fh{constructor(t,i){this.kb=new Zn,this.yb=new Map,this.Cb=new Map,this.Tb=new _,this.Pb=new _;const s=i===void 0?A(Ss):B(A(Ss),ys(i));this.cb=new Jn(t,s),this.cb.fv().l(h=>{this.Tb.M()&&this.Tb.m(this.Rb(h()))},this),this.cb.zc().l(h=>{this.Pb.M()&&this.Pb.m(this.Rb(h()))},this);const n=this.cb.Yt();this.Db=new uh(n,this.cb.km())}remove(){this.cb.fv().v(this),this.cb.zc().v(this),this.Db.S(),this.cb.S(),this.yb.clear(),this.Cb.clear(),this.Tb.S(),this.Pb.S(),this.kb.S()}resize(t,i,s){this.autoSizeActive()||this.cb.wm(t,i,s)}addAreaSeries(t){return this.Ab("Area",sh,t)}addBaselineSeries(t){return this.Ab("Baseline",hh,t)}addCloudAreaSeries(t={}){return this.Ab("CloudArea",eh,t)}addBrokenAreaSeries(t={}){return this.Ab("BrokenArea",nh,t)}addBarSeries(t){return this.Ab("Bar",th,t)}addCandlestickSeries(t={}){return function(i){i.borderColor!==void 0&&(i.borderUpColor=i.borderColor,i.borderDownColor=i.borderColor),i.wickColor!==void 0&&(i.wickUpColor=i.wickColor,i.wickDownColor=i.wickColor)}(t),this.Ab("Candlestick",Kn,t)}addHistogramSeries(t){return this.Ab("Histogram",rh,t)}addLineSeries(t){return this.Ab("Line",ih,t)}removeSeries(t){const i=P(this.yb.get(t)),s=this.kb.ed(i);this.cb.Yt().ed(i),this.Bb(s),this.yb.delete(t),this.Cb.delete(i)}bb(t,i){this.Bb(this.kb.tb(t,i))}gb(t,i){this.Bb(this.kb.rb(t,i))}subscribeClick(t){this.Tb.l(t)}unsubscribeClick(t){this.Tb.p(t)}subscribeCrosshairMove(t){this.Pb.l(t)}unsubscribeCrosshairMove(t){this.Pb.p(t)}clearCrosshairPosition(){this.cb.Yt().Jc()}priceScale(t){return t===void 0&&(t=this.cb.Yt().hd()),new lh(this.cb,t)}timeScale(){return this.Db}applyOptions(t){this.cb.qh(ys(t))}options(){return this.cb.W()}takeScreenshot(){return this.cb.Pm()}autoSizeActive(){return this.cb.Lm()}fullUpdate(){return this.cb.Yt().zl()}setCrosshair(t,i,s){this.cb.xm()[0].Cv(t,i,s)}Ab(t,i,s={}){dh(s.priceFormat);const n=B(A(oh),A(i),s),h=this.cb.Yt().nd(t,n),r=new ch(h,this,this);return this.yb.set(r,h),this.Cb.set(h,r),r}Bb(t){const i=this.cb.Yt();i.Qc(t.yt.Pu,t.yt._b,t.yt.ub),t.ab.forEach((s,n)=>n.it(s.Or,s.ob)),i.Au()}Lb(t){return P(this.Cb.get(t))}Rb(t){const i=new Map;t.$m.forEach((n,h)=>{const r=js(h.hl())(n);J(function(o){return o.lowerValue!==void 0||o.open!==void 0||o.value!==void 0}(r)),i.set(this.Lb(h),r)});const s=t.jm===void 0?void 0:this.Lb(t.jm);return{time:t.ut,logical:t.Xs,point:t.Wm,hoveredSeries:s,hoveredObjectId:t.Hm,seriesData:i,sourceEvent:t.Um}}}function Zh(e,t){let i;if(mi(e)){const s=document.getElementById(e);J(s!==null,`Cannot find element in DOM with id=${e}`),i=s}else i=e;return new fh(i,t)}function Pt(e){e.state.open=e.state.close,e.state.high=e.state.close,e.state.low=e.state.close}function xs(e){e.state.point={open:e.state.open,high:e.state.high,low:e.state.low,close:e.state.close}}function ph(e){e.state.open=null,e.state.high=null,e.state.low=null}function q(e){e.state.points.push(e.state.output),e.state.count++,e.state.count>e.length-1&&(e.state.points.shift(),e.state.count--)}function ot(e){typeof e.state.output>"u"||(e.state.points.push(e.state.output),e.state.sum+=e.state.output,e.state.count++,e.state.count>e.length-1&&(e.state.sum-=e.state.points.shift(),e.state.count--))}function mh(e){e.state.lows.push(e.state.low),e.state.highs.push(e.state.high),e.state.count++,e.state.count>e.length-1&&(e.state.lows.shift(),e.state.highs.shift(),e.state.count--)}const I={avg_ohlc:{state:{open:null,high:null,low:null,close:null},next:Pt,update(e,t){let i=0,s=!1,n,h=0,r=0,o=0;e.open===null&&(s=!0,n=0);for(const l in t.sources)!t.sources[l].active||t.sources[l].open===null||(s&&(n+=t.sources[l].open),h+=t.sources[l].high,r+=t.sources[l].low,o+=t.sources[l].close,i++);return i?(s&&(e.open=n/i),e.high=Math.max(e.open,h/i),e.low=Math.min(e.open,r/i),e.close=o/i,{time:t.localTimestamp,open:e.open,high:e.high,low:e.low,close:e.close}):{time:t.localTimestamp}}},heikinashi:{args:[{instruction:"renderer.localTimestamp",injected:!0}],state:{open:null,high:null,low:null,close:null},next:xs,update(e,t,i){return e.high=i.high,e.low=i.low,e.open=i.open,e.close=(e.open+e.high+e.low+e.close)/4,typeof e.point<"u"?e.open=(e.point.open+e.point.close)/2:e.open=(e.open+e.close)/2,e.low=Math.min(e.open,e.low,e.close),e.high=Math.max(e.open,e.high,e.close),{time:t,open:e.open,high:e.high,low:e.low,close:e.close}}},avg_heikinashi:{state:{open:null,high:null,low:null,close:null},next:xs,update(e,t){let i=0;e.open=0,e.high=0,e.low=0,e.close=0;for(const s in t.sources)!t.sources[s].active||t.sources[s].open===null||(e.open+=t.sources[s].open,e.high+=t.sources[s].high,e.low+=t.sources[s].low,e.close+=t.sources[s].close,i++);return i||(i=1),e.high/=i,e.low/=i,e.open/=i,e.close=(e.open+e.high+e.low+e.close/i)/4,typeof e.point<"u"?e.open=(e.point.open+e.point.close)/2:e.open=(e.open+e.close)/2,e.low=Math.min(e.open,e.low,e.close),e.high=Math.max(e.open,e.high,e.close),{time:t.localTimestamp,open:e.open,high:e.high,low:e.low,close:e.close}}},avg_ohlc_with_gaps:{state:{open:null,high:null,low:null,close:null},next:ph,update(e,t){let i=0,s=0,n=0,h=0,r=0;for(const o in t.sources)!t.sources[o].active||t.sources[o].open===null||(s+=t.sources[o].open,n+=t.sources[o].high,h+=t.sources[o].low,r+=t.sources[o].close,i++);return i?(e.open=s/i,e.high=Math.max(e.high===null?-1/0:e.high,n/i),e.low=Math.min(e.low===null?1/0:e.low,h/i),e.close=r/i,{time:t.localTimestamp,open:e.open,high:e.high,low:e.low,close:e.close}):{time:t.localTimestamp}}},avg_close:{update(e,t){let i=0;e.close=0;for(const s in t.sources)!t.sources[s].active||t.sources[s].open===null||(e.close+=t.sources[s].close,i++);return i||(i=1),e.close/=i,e.close}},ohlc:{args:[{instruction:"renderer.localTimestamp",injected:!0}],next:Pt,update(e,t,i){return typeof e.open>"u"&&(e.open=i,e.high=i,e.low=i),e.high=Math.max(e.high,i),e.low=Math.min(e.low,i),e.close=i,{time:t,open:e.open,high:e.high,low:e.low,close:e.close}}},cum_ohlc:{args:[{instruction:"renderer.localTimestamp",injected:!0}],next:Pt,update(e,t,i){return typeof e.open>"u"?(e.open=i,e.high=i,e.low=i):i=e.open+i,e.high=Math.max(e.high,i),e.low=Math.min(e.low,i),e.close=i,{time:t,open:e.open,high:e.high,low:e.low,close:e.close}}},cum:{next:Pt,update(e,t){if(!isNaN(t))return typeof e.open>"u"&&(e.open=t),e.close=e.open+t,e.close}},pivot_high:{args:[{},{length:!0},{length:!0}],state:{points:[],count:0},next:q,update(e,t,i,s){e.output=t;let n=e.points[i];typeof n>"u"&&(n=t);const h=i+s;for(let r=0;r<=h;r++)if((r<h-1?e.points[r]:t)>n)return null;return n}},pivot_low:{args:[{},{length:!0},{length:!0}],state:{points:[],count:0},next:q,update(e,t,i,s){e.output=t;let n=e.points[i];typeof n>"u"&&(n=t);const h=i+s;for(let r=0;r<=h;r++)if((r<h-1?e.points[r]:t)<n)return null;return n}},highest:{args:[{},{length:!0}],state:{points:[],count:0},next:q,update(e,t,i){return e.output=t,e.count>1?Math.max.apply(null,e.points):t}},lowest:{args:[{},{length:!0}],state:{points:[],count:0},next:q,update(e,t,i){return e.output=t,e.count>1?Math.min.apply(null,e.points):t}},linreg:{args:[{},{length:!0}],state:{points:[],count:0},next:q,update(e,t,i){if(e.output=t,e.count<1)return null;let s=0,n=0,h=0,r=0,o=0,l=0;for(let d=0;d<=e.points.length;d++){const f=d===e.points.length?t:e.points[d];n=d+1,h+=n,r+=f,o+=n*n,l+=f*n,s++}const a=(s*l-h*r)/(s*o-h*h);return r/s-a*h/i+a+a*(s-1)}},avg:{update(e,t){let i=0,s=0;for(let n=0;n<t.length;n++)t[n]!==null&&(s+=t[n],i++);return s/i}},sum:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:ot,update(e,t){return e.output=t,e.sum+t}},sma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:ot,update(e,t){const i=(e.sum+t)/(e.count+1);return e.output=t,i}},cma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:ot,update(e,t){return e.output=(e.sum+t)/(e.count+1),e.output}},ema:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:ot,update(e,t,i){const s=2/(i+1);if(e.count){const n=e.points[e.points.length-1];e.output=(t-n)*s+n}else e.output=t;return e.output}},last:{args:[{},{length:!0}],state:{points:[],count:0},next:q,update(e,t){return e.output=t,e.count?e.points[0]:t}},rma:{args:[{},{length:!0}],state:{count:0,sum:0,points:[]},next:ot,update(e,t,i){const s=1/i;if(e.count){const n=e.points[e.points.length-1];e.output=s*t+(1-s)*n}else e.output=1;return e.output}},merge_overlapping_intervals:{args:[{},{},{}],state:{count:0,sum:0,points:[]},update(e,t,i,s){return t.length?t.sort((n,h)=>n.range[0]-h.range[0]).reduce((n,h,r)=>{const o=n.length-1;return r&&n[o].range[1]>=h.range[0]?(n[o].bottom=(n[o].bottom*n[o].strength+h.range[0]*h.strength)/(n[o].strength+h.strength),n[o].top=(n[o].top*n[o].strength+h.range[1]*h.strength)/(n[o].strength+h.strength),n[o].range=[Math.min(h.range[0],n[o].range[0]),Math.max(h.range[1],n[o].range[1])],n[o].ids.push(h.id),n[o].strength+=h.strength,n):(h.bottom=Math.min(h.range[0],h.range[1]),h.top=Math.max(h.range[0],h.range[1]),n.push({...h,ids:[h.id]}),n)},[]).reduce((n,h)=>(h.strength<(i||1)||(h.range=[h.bottom,h.top],n.push(h)),n),[]):[]}},stoch:{args:[!0,!0,!0,{length:!0}],state:{count:0,lows:[],highs:[]},next:mh,update(e,t,i,s){e.low=s;const n=e.count>0?Math.min(Math.min.apply(null,e.lows),s):s;e.high=i;const h=e.count>0?Math.max(Math.max.apply(null,e.highs),i):i;return e.output=100*(t-n)/(h-n||1),e.output}},na(e){return e||0},interpolate:{state:{paletteId:null,colorsRgb:null,ratio:null,output:null},update(e,t,...i){if(!e.paletteId||e.paletteId!==i.join("")){try{e.colorsRgb=i.map(s=>ie(s,null,!0))}catch{throw new Error(`interpolate(): failed to parse color codes
	${i.join(", ")}`)}e.paletteId=i.join("")}return e.ratio!==t&&(e.output=se(ee(t,...e.colorsRgb)),e.ratio=t),e.output}}};var Hs=(e=>(e[e.text=0]="text",e[e.number=1]="number",e[e.range=2]="range",e[e.list=3]="list",e[e.lineType=4]="lineType",e[e.lineStyle=5]="lineStyle",e[e.color=6]="color",e[e.checkbox=7]="checkbox",e[e.exchange=8]="exchange",e))(Hs||{});const k="vars",Js="fns",Qh=["vbuy","vsell","cbuy","csell","lbuy","lsell"],Gs={candlestick:"ohlc",bar:"ohlc",line:"number",histogram:"number",area:"number",cloudarea:"range",brokenarea:"range",baseline:"number"},gh=/^\/.+\/\w?$/,bh=Object.values(Hs);function qh(e,t){const{id:i,libraryId:s}=e,n=Ch(e.script,i,s,t);for(const h of n.functions)wh(h);for(const h of n.variables)Sh(h);return{output:n.output,functions:n.functions,variables:n.variables,references:n.references,markets:n.markets,sources:n.sources,options:n.options,plots:n.plots}}function vh(e,t){return e=e.replace(/([^.])?\b(indicatorId)\b/gi,`$1'${t}'`),e=e.replace(/([^.])?\b(bar)\b/gi,"$1renderer"),e=e.replace(/([^.]|^)\b(vbuy|vsell|cbuy|csell|lbuy|lsell)\b/gi,"$1renderer.bar.$2"),e=e.replace(/([^.]|^)\b(time)\b([^:])/gi,"$1renderer.localTimestamp$3"),e=e.replace(/renderer\.indicators\[[\w\d_\-'"` ]+\]\.series\[([\w\d_\-'"`.\][ ]+)\]/g,"renderer.series[series[$1].id]"),e}function wh(e){if(typeof I[e.name]&&typeof I[e.name].state=="object"){e.state={};for(const t in I[e.name].state)try{e.state[t]=JSON.parse(JSON.stringify(I[e.name].state[t]))}catch{e.state[t]=I[e.name].state[t]}return}e.state={}}function Sh(e){e.length>1?e.state=[0]:e.state=0}function Ch(e,t,i,s){const n=[],h=[],r=[],o={},l=[],a={},c=[],u=[];let d=e.replace(/\/\/.*/g,"");d=Th(d,a),d=Lh(d,l),d=vh(d,t),d=yh(d,u),d=Mh(d,h),d=Ph(d,o);for(let f=0;f<u.length;f++)d=d.replace(new RegExp("#STRING_"+f+"#","g"),u[f].replace(/\$/g,"$$$"));return d=Vh(d,n,r,i,s),d=Eh(d,c,r,t,s),d=xh(d),{output:d,functions:n,variables:h,plots:r,markets:o,references:c,options:a,sources:l}}function yh(e,t){const i=/'([^']*)'|"([^"]*)"|`([^`]*)`/;let s=null,n=0;do if(s=i.exec(e)){let o=t.indexOf(s[0]);o===-1&&(o=t.push(s[0])-1),e=e.slice(0,s.index)+"#STRING_"+o+"#"+e.slice(s.index+s[0].length)}while(s&&++n<1e3);const h=/\(/g;let r;n=0;do if(r=h.exec(e)){const o=et(e,r.index,/\(|{|\[/,/\)|}|\]/);if(o!==-1){const l=e.slice(r.index+1,o).replace(/\n/g," ");e=e.slice(0,r.index)+e.slice(r.index,r.index+1)+l.replace(/\n/g,"")+e.slice(o,o+1)+`
`+e.slice(o+1,e.length),h.lastIndex=o}}while(r&&++n<1e3);return e}function xh(e){const t=/\(|{|\[/g;let i,s=0;do if(i=t.exec(e)){const h=i[0]==="(",r=et(e,i.index,/\(|{|\[/,/\)|}|\]/),o=e.slice(i.index+1,r).replace(/\n/g," ");/if|for|else/.test(e.slice(i.index-2,2))&&(e=e.slice(0,i.index)+e.slice(i.index,i.index+1)+o+e.slice(r,r+1)+(h?`
`:"")+e.slice(r+1,e.length)),t.lastIndex=r}while(i&&++s<1e3);return e.trim().split(/\n/).join(`
`).replace(/\n\n/g,`
`)}function Mh(e,t){const i=/(?:^|\n)\s*((?:var )?[a-zA-Z0-9_]+)\(?(\d*)\)?\s*=\s*([^\n;,]*)?/;let s=null,n=0;const h=[];do if(s=i.exec(e)){let r=s[1];const o=/^var/.test(r);if(h.indexOf(r)!==-1||o){o&&(r=r.replace(/var\s*/,""),e=e.replace(s[0],`
var `+r+"="+s[3]),h.push(r)),e=e.replace(new RegExp("([^.$]|^)\\b("+r+")\\b(?!:)(?!\\()(?!\\$)","ig"),`$1${r}$`);continue}const l=+s[2]||1;e=e.replace(new RegExp("([^.]|^)\\b("+r+")\\b(?!:)","ig"),`$1${k}[${t.length}]`);const a={length:l};t.push(a),e=e.replace(new RegExp(`(${k}\\[${t.length-1}\\])\\(${a.length}\\)\\s*=\\s*`),"$1=")}while(s&&++n<1e3);return e=Rh(e,t),e}function _h(e,t,i,s,n){const h=t[1].replace(/^plot/,""),r=et(e,t.index+t[1].length),o=e.slice(t.index+t[1].length+1,r),l=t[1]+"("+o+")",a=Ot(o).filter(C=>C.length),c=Vi(a),u=Object.keys(n).concat(i.map(C=>C.id));let d;typeof c.id=="string"&&c.id.length?(d=c.id,delete c.id):i.length===0?d=s:d=ne(8),d=he(d,u,!1,"2");let p=`${`renderer.series['${d}']`} = `;const m=Gs[h];let b="renderer.localTimestamp";c.offset&&(b+=`+renderer.timeframe*${c.offset}`);const v=/{/.test(a[0])&&/}/.test(a[0]),w=/^[\w_$]+\$/.test(a[0]);if(!a.length)p="";else if(a.length===1&&(v||h!=="line"&&w))p+=a[0];else if(m==="ohlc")if(a.length===4)p+=`{ time: ${b}, open: ${a[0]}, high: ${a[1]}, low: ${a[2]}, close: ${a[3]} }`;else if(a.length===1)/^[A-Z_]+:\w+/.test(a[0])?p+=`${a[0]}.close === null ? { time: ${b} } : { time: ${b}, open: ${a[0]}.open, high: ${a[0]}.high, low: ${a[0]}.low, close: ${a[0]}.close }`:p+=a[0];else throw new Error(`Invalid input for function ${t[1]}, expected a ohlc object or 4 number`);else if(m==="range")if(a.length===2)p+=`{ time: ${b}, lowerValue: ${a[0]}, higherValue: ${a[1]} }`;else throw new Error(`Invalid input for function ${t[1]}, expected 2 arguments (lowerValue and higherValue)`);else if(m==="number")if(a.length===1)p+=`{ time: ${b}, value: ${a[0]} }`;else throw new Error(`Invalid input for function ${t[1]}, expected 1 value (number)`);return e=e.replace(l,p),i.push({id:d,type:Uh[h]||h,expectedInput:m,options:c}),{output:e,offset:p.length?t[0].length:0}}function Vi(e,t=0){const i={};for(let s=t;s<e.length;s++)try{const[,n,h]=e[s].match(/^(\w+)\s*=([\S\s]*)/);if(!n||!h.length)continue;let r=h.trim();try{r=JSON.parse(r)}catch{r=r.replace(/^'(.*)'$|^"(.*)"$/,"$1$2")}i[n.trim()]=r,e.splice(s,1),s--}catch{continue}return i}function Vh(e,t,i,s,n){const h=new RegExp("([a-zA-Z0_9_]+)\\(","g");let r=null,o=0;do if(r=h.exec(e)){const l=r[1];if(e[r.index-1]==="."){h.lastIndex=r.index+r[0].length;continue}if(Gs[l.replace(/^plot/,"")]){const w=_h(e,r,i,s,n);e=w.output,h.lastIndex=r.index+w.offset;continue}const a=I[l];if(!a){h.lastIndex=r.index+r[0].length;continue}const c={name:l,args:[]},u=r.index,d=et(e,u+r[1].length),f=Ot(e.slice(u+r[1].length+1,d)).filter(w=>w.length);if(typeof I[l]=="function"){e=`${e.slice(0,u)}utils.${l}(${f.join(",")})${e.slice(d+1,e.length)}`;continue}let p=0,m=(a.args?a.args.length:0)+f.length;for(let w=0;w<m;w++){const C=a.args?a.args[w]:null,S={...C||{}};if(C)if(C.injected){p++,c.args.push(S);continue}else a.args[w]&&m--;const x=f[w-p];typeof x<"u"&&(S.instruction=x),c.args.push(S)}const b=`utils.${l}.update`,v=`${b}(${Js}[${t.length}].state,${c.args.map(w=>w.instruction).join(",")})`;e=`${e.slice(0,u)}${v}${e.slice(d+1,e.length)}`,t.push(c),h.lastIndex=r.index+b.length}while(r&&++o<1e3);return e}function Th(e,t){const i=new RegExp("[\\s\\n]*(\\w[\\d\\w]+)[\\s\\n]*=[\\s\\n]*option\\(","g");let s=null,n=0;do if(s=i.exec(e)){const h=s.index,r=et(e,h+s[0].length-1),o=Vi(Ot(e.slice(h+s[0].length,r)).filter(l=>l.length));if(e=e.replace(e.slice(h,r+1),""),e=e.replace(new RegExp("([^.]|^)\\b("+s[1]+")\\b(?!:|=)","ig"),`$1options.${s[1]}`),o.type?o.type==="exchange"&&(o.rebuild=!0):o.type="number",o.default||(o.default=o.type==="text"?"":Math.max(o.min||0,0)),!bh.includes(o.type))throw new Error(`Unknown option type ${o.type}`);t[s[1]]=o,i.lastIndex-=s[0].length}while(s&&++n<1e3);return e}function Lh(e,t){const i=new RegExp("source\\(","g");let s=null,n=0;do if(s=i.exec(e)){const h=s.index,r=et(e,h+s[0].length-1),o=Ot(e.slice(h+s[0].length,r)).filter(c=>c.length);let l;o[0].indexOf("=")===-1&&(l=o.shift().replace(/\W/g,""));const a=Vi(o);e=e.replace(e.slice(h,r+1),`#SOURCE${t.length}#`),t.push({prop:l,filters:a})}while(s&&++n<1e3);return e}function Ph(e,t){const i=/\b([A-Z_]{3,}:[a-zA-Z0-9/_-]{5,})(:[\w]{4,})?\.?([a-z]{3,})?\b/g;let s=null,n=0;do if(s=i.exec(e)){const h=s[1]+(s[2]?s[2]:""),r=s[3];t[h]||(t[h]=[]),r&&t[h].indexOf(r)===-1&&t[h].push(r);const o=`renderer.sources['${h}']${r?"."+r:""}`;i.lastIndex=s.index+o.length,e=e.slice(0,s.index)+o+e.slice(s.index+s[0].length)}while(s&&++n<1e3);return e}function Eh(e,t,i,s,n){const h=new RegExp("\\$(\\w+[a-z_\\-0-9]+)\\b");let r=null,o=0;do if(r=h.exec(e)){const l=r[1];try{const[a,c]=zh(l,i,s,n);t.find(u=>u.indicatorId===a&&u.plotIndex===c)||t.push({indicatorId:a,serieId:l,plotIndex:c}),e=e.replace(new RegExp("\\$("+l+")\\b","ig"),`renderer.series['${l}']`)}catch{throw{message:`The serie "${l}" was not found in the current indicators`,status:"indicator-required",serieId:l}}}while(r&&++o<1e3);return e}function zh(e,t,i,s){let n,h;const r=t.find(o=>o.id===e||o.id.replace(/\W/g,"")===e.replace(/\W/g,""));if(r&&(n=i,h=t.indexOf(r)),!n&&s[e]&&({indicatorId:n,plotIndex:h}=s[e]),!n&&Object.values(s).map(o=>o.indicatorId).indexOf(e)!==-1&&(n=e,h=0),n)return[n,h]}function Rh(e,t){for(const i of t){const s=t.indexOf(i),n=new RegExp(`${k}\\[${s}\\](?:\\[(\\d+)\\])?`,"g");let h=null,r=0;do if(h=n.exec(e)){const o=h[1],l=h.index+h[0].length;if(typeof o>"u"){const a=e[l]==="[";e=e.substring(0,l)+".state"+(a?"":"[0]")+e.substring(l)}else{const a=e.substring(0,h.index),c=`${k}[${s}].state[Math.min(${k}[${s}].state.length-1,${o})]`,u=e.substring(h.index+h[0].length);e=`${a}${c}${u}`,n.lastIndex=a.length+c.length}i.length=Math.max(i.length,(+o||0)+1)}while(h&&++r<1e3);if(!i.length)throw new Error("Unexpected no length on var");i.length===1&&(e=e.replace(new RegExp(`${k}\\[${s}\\]\\.state\\[\\d+\\]`,"g"),`${k}[${s}].state`)),e=e.replace(new RegExp(`#${k}\\[${s}\\]\\.state\\[\\d+\\]`,"g"),`${k}[${s}].state`)}return e}function kh(e,t,i){const s=O.state.panes.marketsListeners;let n=e.output;const h=["open","high","low","close"];for(let r=0;r<e.sources.length;r++){const o=[],l=`#SOURCE${r}#`,a=e.sources[r].prop,c=Object.keys(e.sources[r].filters).reduce((u,d)=>{const f=e.sources[r].filters[d],[p,m]=f.split(".");return p==="options"&&m?u[d]=i[m]:u[d]=f,gh.test(u[d])&&(u[d]=new RegExp(u[d].slice(1,-1))),u},{});for(const u in t)t[u]!==!1&&(c.type&&s[u].type!==c.type||c.exchange&&s[u].exchange!==c.exchange||c.quote&&s[u].quote!==c.quote||c.name&&(c.name instanceof RegExp&&!c.name.test(s[u].local)||typeof c.name=="string"&&s[u].local!==c.name)||o.push(u));if(!o.length){n=n.replace(l,a?"0":`{
          timestamp: renderer.timestamp,
          localTimestamp: renderer.localTimestamp,
          sources: {}
        }`);continue}a?h.indexOf(a)!==-1?n=n.replace(l,`(() => {
              let count = 0;
              let sum = 0;
              ${o.map(u=>`if (renderer.sources['${u}'].${a}) {
                count++;
                sum += renderer.sources['${u}'].${a}
              }`).join(";")}
              return sum / count
            })()`):n=n.replace(l,`(${o.map(u=>`renderer.sources['${u}'].${a}`).join("+")})`):n=n.replace(l,`{
            timestamp: renderer.timestamp,
            localTimestamp: renderer.localTimestamp,
            sources: {
              ${o.map(u=>`'${u}': renderer.sources['${u}']`).join(",")}
            },
          }`)}return n}function Kh(e,t,i){let s=e.output;return e.sources.length&&(s=kh(e,t,i)),new Function("renderer",Js,k,"series","options","utils",'"use strict"; '+s)}function tr(e){const{functions:t,variables:i,plots:s}=JSON.parse(JSON.stringify(e.model));e.options.minLength=0;for(const h of t){h.length=0;for(let r=0;r<h.args.length;r++)if(!(typeof h.args[r].instruction>"u"||h.args[r].instruction===""))try{h.args[r].instruction=new Function("options",`'use strict'; return ${h.args[r].instruction}`)(e.options),h.args[r].length&&!isNaN(h.args[r].instruction)&&(h.length+=h.args[r].instruction)}catch{}e.options.minLength=Math.max(e.options.minLength,h.length)}const n=[];for(const h of s)n.push(Zs(e,h));return{canRender:e.options.minLength<=1,functions:t,variables:i,plotsOptions:n,minLength:e.options.minLength}}function Zs(e,t,i=null){const s={};for(const n in t.options)if(!(i&&i!==n))try{s[n]=new Function("options",`'use strict'; return ${t.options[n]}`)(e.options)}catch{s[n]=t.options[n]}return i?s[i]:s}const E={},ci={},Qs={crosshair:{vertLine:{color:"rgba(255, 255, 255, .5)",width:1,style:2,visible:!0,labelVisible:!0},horzLine:{color:"rgba(255, 255, 255, .5)",width:1,style:2,visible:!0,labelVisible:!0},mode:0},watermark:{color:"rgba(255,255,255, 0.1)",visible:!1,text:"",horzAlign:"center",vertAlign:"center",fontFamily:"Spline Sans Mono",fontStyle:"600"},layout:{background:{type:ui.Solid,color:"transparent"},textColor:"white",fontFamily:"Barlow Semi Condensed"},grid:{horzLines:{visible:!1},vertLines:{visible:!1}},timeScale:{barSpacing:4,minBarSpacing:0,rightOffset:12,lockVisibleTimeRangeOnResize:!1,borderVisible:!0,borderColor:"rgba(255, 255, 255, .2)",visible:!0,timeVisible:!0,secondsVisible:!0},rightPriceScale:{borderColor:"rgba(255, 255, 255, .2)",visible:!0,scaleMargins:{top:.1,bottom:.1}},leftPriceScale:{borderColor:"rgba(255, 255, 255, .2)",visible:!0,scaleMargins:{top:.1,bottom:.1}}},zt={crosshairMarkerVisible:!1,lastValueVisible:!1,priceLineVisible:!1,baseLineVisible:!1,priceFormat:{type:"price",minMove:"0.01",precision:2}},Fh={priceLineStyle:1,color:"white",lineWidth:1,lineStyle:0,lineType:0},Bh={priceLineColor:null,borderVisible:!1,upColor:"#c3a87a",downColor:"#e53935",borderUpColor:"#c3a87a",borderDownColor:"#e53935",wickUpColor:"rgba(223, 195, 148, .8)",wickDownColor:"rgba(224, 91, 95, .8)"},Ah={topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:1},Wh={color:"#c3a87a"},Oh={topColor:"rgba(21, 146, 230, 0.4)",bottomColor:"rgba(21, 146, 230, 0)",lineColor:"rgba(21, 146, 230, 1)",lineStyle:0,lineWidth:2},Nh={positiveColor:"rgba(76,175,80,0.1)",negativeColor:"rgba(255,82,82,0.1)",positiveLineColor:"#4CAF50",higherLineStyle:Rt.Simple,higherLineWidth:1,negativeLineColor:"#FF5252",lowerLineStyle:Rt.Simple,lowerLineWidth:1},Xh={color:"rgba(76,175,80,0.1)"},$h={thinBars:!1,upColor:"#a5d6a7",downColor:"#e57373",openVisible:!0},ir={...Qs,rightPriceScale:{mode:0},timeScale:{barSpacing:3,rightOffset:5,lockVisibleTimeRangeOnResize:!0,rightBarStaysOnScroll:!0,borderColor:"transparent",timeVisible:!0}},Uh={cloudarea:"cloud-area",brokenarea:"broken-area"},pi={line:Fh,area:Oh,candlestick:Bh,baseline:Ah,"cloud-area":Nh,"broken-area":Xh,bar:$h,histogram:Wh};function Ih(e){let t;if(e){const i=O.state.panes.panes[e].zoom||1,s=O.state.panes.panes[e].type==="chart"?1:.75;t=14*i*s}return t}function qs(e){const t=getComputedStyle(document.documentElement),i=t.getPropertyValue("--theme-color-100"),s=t.getPropertyValue("--theme-background-100");return{layout:{textColor:i,borderColor:s,fontSize:Ih(e)}}}function Yh(){const e=getComputedStyle(document.documentElement).getPropertyValue("--theme-color-o50"),t=getComputedStyle(document.documentElement).getPropertyValue("--theme-background-300");return{crosshair:{vertLine:{color:e,labelVisible:!0},horzLine:{color:e,labelVisible:!0,labelBackgroundColor:t}}}}function Dh(e){const t=O.state[e];return{watermark:{color:t.watermarkColor,visible:t.showWatermark}}}function jh(e){const t=getComputedStyle(document.documentElement).getPropertyValue("--theme-color-o20");if(!e)return{timeScale:{borderColor:t},rightPriceScale:{borderColor:t},leftPriceScale:{borderColor:t}};const i=O.state[e];return{timeScale:{visible:i.showTimeScale,borderColor:i.borderColor||t,borderVisible:i.showBorder},rightPriceScale:{visible:i.showRightScale,borderColor:i.borderColor||t,borderVisible:i.showBorder},leftPriceScale:{visible:i.showLeftScale,borderColor:i.borderColor||t,borderVisible:i.showBorder}}}function Hh(e){const t=O.state[e];return{grid:{vertLines:{color:t.verticalGridlinesColor,visible:t.showVerticalGridlines},horzLines:{color:t.horizontalGridlinesColor,visible:t.showHorizontalGridlines}}}}function sr(e,t){const s=O.state[e].barSpacing||3;return{timeScale:{barSpacing:s,rightOffset:Math.ceil(t*.05/s)}}}function er(e,t=""){return Object.values(e).reduce((i,s)=>(s.id!==t&&s.options&&s.options.priceScaleId&&!i[s.options.priceScaleId]&&(i[s.options.priceScaleId]=`${s.name} (${s.id.slice(0,8)}${s.id.length>8?"...":""})`),i),{[t]:"Own scale 📍",left:"Left ←",right:"Right →"})}function Jh(e,t){const i=Object.assign({},e);return Ms(i,qs(t),Yh(),jh(t))}function nr(e){return Ms(qs(),Jh(Qs),Dh(e),Hh(e))}function Ks(e,t,i){if(!i&&typeof E[e]<"u")return E[e];if(t){for(const s of t)if(typeof pi[s][e]<"u")return E[e]=pi[s][e],E[e]}return typeof zt[e]<"u"?(E[e]=zt[e],zt[e]):/length$/i.test(e)?(E[e]=14,E[e]):/color$/i.test(e)?(E[e]=re(),E[e]):/width$/i.test(e)?(E[e]=1,E[e]):null}function hr(e,t,i,s){if(!i&&typeof ci[e]<"u")return ci[e];typeof s>"u"&&(s=Ks(e,t,i));let n="text",h;try{h=JSON.parse(s)}catch{h=s}return typeof h=="boolean"||/^(show|toggle|set|use)[A-Z]/.test(e)?n="checkbox":/color/i.test(e)||/^rgba?/.test(h)||/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(h)?n="color":typeof h=="number"&&(n="number"),ci[e]=n,n}function rr(e,t,i,s){let n;typeof O.state[e].indicators[t].options[i]<"u"&&(n=O.state[e].indicators[t].options[i]);const h=Ks(i,s);return typeof n<"u"?n&&typeof n=="object"&&h&&typeof h=="object"?Object.assign({},h,n):n:typeof h<"u"?h:null}function or(e,t,i){i&&i.priceFormat&&(e.options.priceFormat={...e.options.priceFormat,...i.priceFormat});const s=Zs(e,t);return{...zt,...pi[t.type]||{},...e.options,...i&&i.scaleMargins?{scaleMargins:{top:i.scaleMargins.top,bottom:i.scaleMargins.bottom}}:{},...s}}export{Hs as A,Qh as D,Gs as S,Zh as Z,Ks as a,er as b,rr as c,pi as d,zt as e,jh as f,hr as g,Hh as h,nr as i,Jh as j,Qs as k,Dh as l,sr as m,qh as n,tr as o,Uh as p,Kh as q,or as r,I as s,ir as t,Ih as u};
