var P=Object.defineProperty;var k=(a,s,e)=>s in a?P(a,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[s]=e;var n=(a,s,e)=>(k(a,typeof s!="symbol"?s+"":s,e),e);import{C as v,t as C,V as S,n as _,ab as y,p as m,af as g,j as f,Q as w,Y as M,W as u,_ as b}from"./index.5c4cb14.js";import{P as D,a as x}from"./PaneHeader.5c4cb14.js";var $=Object.defineProperty,V=Object.getOwnPropertyDescriptor,O=(a,s,e,t)=>{for(var r=t>1?void 0:t?V(s,e):s,o=a.length-1,i;o>=0;o--)(i=a[o])&&(r=(t?i(s,e,r):i(r))||r);return t&&r&&$(s,e,r),r};let p=class extends S{constructor(){super(...arguments);n(this,"paneId")}get sortType(){return this.$store.state[this.paneId].sortType}get sortOrder(){return this.$store.state[this.paneId].sortOrder}selectSortType(e){e===this.sortType&&this.$store.commit(this.paneId+"/TOGGLE_SORT_ASC"),this.$store.commit(this.paneId+"/SET_SORT_TYPE",e)}};p=O([v({name:"PricesSortDropdown",components:{DropdownButton:C},props:{paneId:{type:String,required:!0},buttonClass:{type:String,default:"-text -arrow"}}})],p);var I=function(){var s=this,e=s._self._c;return s._self._setupProxy,e("dropdown-button",{attrs:{options:["none","price","volume","delta","change"]},on:{input:function(t){return s.selectSortType(t)}},model:{value:s.sortType,callback:function(t){s.sortType=t},expression:"sortType"}})},F=[],R=_(p,I,F,!1,null,null,null,null);const L=R.exports;var A=Object.defineProperty,E=Object.getOwnPropertyDescriptor,c=(a,s,e,t)=>{for(var r=t>1?void 0:t?E(s,e):s,o=a.length-1,i;o>=0;o--)(i=a[o])&&(r=(t?i(s,e,r):i(r))||r);return t&&r&&A(s,e,r),r};let h=class extends y(D){constructor(){super(...arguments);n(this,"mode","vertical");n(this,"pauseSort",!1);n(this,"showCryptosLogos",!1);n(this,"filteredMarkets",[]);n(this,"VITE_APP_BASE_PATH","/aggr/");n(this,"sortFunction");n(this,"markets");n(this,"lastResetTimestamp");n(this,"lastPeriodTickers");n(this,"periodMs");n(this,"resetTimeout")}onMarketChange(e,t){for(const r of t)e.indexOf(r)===-1&&this.removeMarketFromList(r);for(const r of e)if(t.indexOf(r)===-1){const[o,i]=m(r);this.addMarketToList({id:r,exchange:o,pair:i})}this.showCryptosLogos=this.hasMultipleLocals()}onPeriodChange(e){e>0?this.periodReset():this.clearPeriodReset()}onVolumeThresholdChange(e){this.toggleSort(!0),e?this.filterMarkets():this.filteredMarkets=this.markets}onShortSymbolsChange(e){for(const t of this.markets){if(e){const r=g(t.exchange,t.pair);if(r){t.local=this.getSymbol(r);continue}}t.local=t.pair}}onSortOrderChange(){this.cacheSortFunction()}onSortTypeChange(){this.cacheSortFunction()}get exchanges(){return this.$store.state.exchanges}get disableAnimations(){return this.$store.state.settings.disableAnimations}get showPairs(){return this.$store.state[this.paneId].showPairs}get showChange(){return this.$store.state[this.paneId].showChange}get showPrice(){return this.$store.state[this.paneId].showPrice}get showVolume(){return this.$store.state[this.paneId].showVolume}get showVolumeDelta(){return this.$store.state[this.paneId].showVolumeDelta}get animateSort(){return this.$store.state[this.paneId].animateSort}get sortType(){return this.$store.state[this.paneId].sortType}get sortOrder(){return this.$store.state[this.paneId].sortOrder}get period(){return this.$store.state[this.paneId].period}get shortSymbols(){return this.$store.state[this.paneId].shortSymbols}get avgPeriods(){return this.$store.state[this.paneId].avgPeriods}get volumeThreshold(){return this.$store.state[this.paneId].volumeThreshold}get transitionGroupName(){return this.animateSort?"flip-list":null}created(){this.cacheSortFunction(),this.refreshMarkets()}mounted(){f.on("tickers",this.updateMarkets),this.filterMarkets(!0)}beforeDestroy(){f.off("tickers",this.updateMarkets),this.resetTimeout&&clearTimeout(this.resetTimeout)}refreshMarkets(){this.markets=[],this.lastPeriodTickers={};const e=[];for(const t of this.pane.markets){const[r,o]=m(t),i=this.addMarketToList({id:t,pair:o,exchange:r});e.indexOf(i.local)===-1&&e.push(i.local)}this.showCryptosLogos=this.hasMultipleLocals(),this.filterMarkets()}updateMarkets(e){const t=this.showChange,r=this.avgPeriods,o=this.getPeriodWeight(r);for(const i of this.markets){const l=e[i.id];if(!l)continue;const d=this.lastPeriodTickers[i.id];if(d.price||(d.price=l.price),i.price=w(l.price,i.id),i.volume+=l.volume,i.volumeDelta+=l.volumeDelta,r?(i.avgVolume=i.volume*o+d.volume*(1-o),i.avgVolumeDelta=Math.round((i.volumeDelta*o+d.volumeDelta*(1-o))/i.avgVolume*100)):(i.avgVolume=i.volume,i.avgVolumeDelta=Math.round(i.volumeDelta/i.volume*100)),t&&l.price){const T=l.price-this.lastPeriodTickers[i.id].price;i.change=T/this.lastPeriodTickers[i.id].price*100,r?i.avgChange=i.change*o+d.change*(1-o):i.avgChange=i.change,i.status=i.avgChange>0?"-up":"-down"}else l.price===null?i.status="-pending":i.price>l.price?i.status="-down":i.price<l.price?i.status="-up":i.status="-neutral"}!this.pauseSort&&this.sortFunction!==null&&(this.filteredMarkets=this.filteredMarkets.sort(this.sortFunction))}removeMarketFromList(e){this.lastPeriodTickers[e]&&delete this.lastPeriodTickers[e];const t=this.markets.indexOf(this.markets.find(r=>r.id===e));t!==-1?this.markets.splice(t,1):console.warn(`[prices] unable to remove market from list after panes.markets change: market doesn't exists in list (${e})`)}addMarketToList(e){this.lastPeriodTickers[e.id]={price:0,change:0,volume:0,volumeDelta:0};const t=g(e.exchange,e.pair);if(t)return this.markets.push({...e,local:this.getSymbol(t),base:t.base.replace(/^1000+/,"").toLowerCase(),status:"-pending",price:null,change:0,avgChange:0,volume:0,avgVolume:0,volumeDelta:0,avgVolumeDelta:0}),t}cacheSortFunction(){const e=this.mode==="horizontal"?this.sortOrder>0?-1:1:this.sortOrder,t=this.sortType;if(!t||t==="none"){this.sortFunction=null;return}t==="price"?e===1?this.sortFunction=(r,o)=>r.price-o.price:this.sortFunction=(r,o)=>o.price-r.price:t==="change"?e===1?this.sortFunction=(r,o)=>r.avgChange-o.avgChange:this.sortFunction=(r,o)=>o.avgChange-r.avgChange:t==="volume"?e===1?this.sortFunction=(r,o)=>r.avgVolume-o.avgVolume:this.sortFunction=(r,o)=>o.avgVolume-r.avgVolume:t==="delta"&&(e===1?this.sortFunction=(r,o)=>r.avgVolumeDelta-o.avgVolumeDelta:this.sortFunction=(r,o)=>o.avgVolumeDelta-r.avgVolumeDelta),this.filteredMarkets=this.filteredMarkets.sort(this.sortFunction)}formatAmount(e){return M(e,0)}onResize(e,t){this.mode=e>t*3?"horizontal":"vertical"}getTimeToNextReset(){const e=Date.now(),t=this.period*1e3*60;return Math.ceil((e+1e4)/t)*t-e}scheduleNextPeriodReset(){this.resetTimeout&&clearTimeout(this.resetTimeout),this.resetTimeout=setTimeout(this.periodReset.bind(this),this.getTimeToNextReset())}periodReset(){if(this.period){if(this.periodMs=this.period*1e3*60,this.lastResetTimestamp=this.resetTimeout?Date.now():null,this.markets)for(const e of this.markets)this.lastPeriodTickers[e.id].price=+e.price,this.lastPeriodTickers[e.id].change=+e.change,this.lastPeriodTickers[e.id].volume=+e.volume,this.lastPeriodTickers[e.id].volumeDelta=+e.volumeDelta,e.volume=0,e.volumeDelta=0;this.scheduleNextPeriodReset()}}clearPeriodReset(){for(const e in this.lastPeriodTickers)this.lastPeriodTickers[e].price=this.lastPeriodTickers[e].volume=this.lastPeriodTickers[e].volumeDelta=0;this.resetTimeout&&(clearTimeout(this.resetTimeout),this.resetTimeout=null)}filterMarkets(e){const t=this.volumeThreshold;this.pauseSort||(t?(this.filteredMarkets=this.markets.filter(r=>r.avgVolume>=t),this.sortFunction&&(this.filteredMarkets=this.filteredMarkets.sort(this.sortFunction))):this.filteredMarkets=this.markets),e&&setTimeout(()=>{this.filterMarkets(!0)},Math.random()*1e4)}getPeriodWeight(e){return!e||!this.lastResetTimestamp?1:(Date.now()-this.lastResetTimestamp)/this.periodMs}toggleSort(e){this.pauseSort=!e}getSymbol(e){return this.shortSymbols?e.base.replace(/^1000+/,"").slice(0,8):e.pair}hasMultipleLocals(){if(!this.markets.length)return!1;const e=this.markets[0].base;for(const t of this.markets)if(e!==t.base)return!0;return!1}};c([u("pane.markets")],h.prototype,"onMarketChange",1);c([u("period",{immediate:!0})],h.prototype,"onPeriodChange",1);c([u("volumeThreshold")],h.prototype,"onVolumeThresholdChange",1);c([u("shortSymbols")],h.prototype,"onShortSymbolsChange",1);c([u("sortOrder")],h.prototype,"onSortOrderChange",1);c([u("sortType")],h.prototype,"onSortTypeChange",1);h=c([v({components:{PaneHeader:x,PricesSortDropdown:L},name:"Prices"})],h);var j=function(){var s=this,e=s._self._c;return s._self._setupProxy,e("div",{staticClass:"pane-prices",on:{mouseenter:function(t){return s.toggleSort(!1)},mouseleave:function(t){return s.toggleSort(!0)}}},[e("pane-header",{attrs:{paneId:s.paneId,settings:()=>b(()=>import("./PricesDialog.5c4cb14.js"),["PricesDialog.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","paneDialogMixin.5c4cb14.js","ToggableGroup.5c4cb14.js","ToggableGroup.5c4cb14.css","PaneHeader.5c4cb14.js","PricesDialog.5c4cb14.css"])}},[e("hr"),e("prices-sort-dropdown",{staticClass:"pane-overlay -text",attrs:{"pane-id":s.paneId}})],1),e("div",{staticClass:"markets-bar__wrapper hide-scrollbar"},[e(s.animateSort?"transition-group":"div",{tag:"component",staticClass:"markets-bar hide-scrollbar pane",class:[s.mode==="horizontal"&&"-horizontal"],attrs:{name:s.transitionGroupName,tag:"div"}},s._l(s.filteredMarkets,function(t){return e("div",{directives:[{name:"draggable-market",rawName:"v-draggable-market"}],key:t.id,staticClass:"market",class:t.status,attrs:{title:t.id,"data-market":t.id}},[e("div",{staticClass:"market__exchange",class:t.exchange,style:s.showCryptosLogos&&{backgroundImage:`url(${s.VITE_APP_BASE_PATH}img/logos/${t.base}.svg)`}}),s.showPairs?e("div",{staticClass:"market__pair"},[s._v(" "+s._s(t.local)+" ")]):s._e(),s.showPrice?e("div",{staticClass:"market__price"},[s._v(s._s(t.price))]):s._e(),s.showChange?e("div",{staticClass:"market__change"},[s._v(" "+s._s((t.avgChange>=0?"+":"")+t.avgChange.toFixed(2))+"% ")]):s._e(),s.showVolume?e("div",{staticClass:"market__volume"},[s._v(" "+s._s(s.formatAmount(t.avgVolume))+" ")]):s._e(),s.showVolumeDelta?e("div",{staticClass:"market__volume"},[s._v(" "+s._s(t.avgVolumeDelta)+"% ")]):s._e()])}),0)],1)],1)},z=[],N=_(h,j,z,!1,null,"9e0d7372",null,null);const W=N.exports,Q=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"}));export{L as P,Q as a};
