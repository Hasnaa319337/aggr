import{a1 as o,Q as a,d as n,O as i,_ as l,n as c}from"./index.5c4cb14.js";import{A as p}from"./AlertsList.5c4cb14.js";const u={name:"ChartContextMenu",components:{AlertsList:p},props:{value:{type:Object,default:null},paneId:{type:String,required:!0},timeframe:{type:String,required:!0},market:{type:String,required:!0},getPrice:{type:Function,default:null},price:{type:Number,default:null},timestamp:{type:Number,default:null},alert:{type:Object,default:null}},data:()=>({alertsDropdownTrigger:null,alertsDropdownSettingsTrigger:null}),computed:{timeframeForHuman(){return this.value?o(this.timeframe):null},alertsEnabled(){return this.$store.state.settings.alerts},showAlerts(){return this.$store.state[this.paneId].showAlerts},showAlertsLabel(){return this.$store.state[this.paneId].showAlertsLabel},priceFormatted(){return+a(this.price,this.market)},alertLabel(){return this.alert?this.alert.message?`${this.alert.message} @${a(this.alert.price,this.alert.market)}`:`${this.alert.market} @${a(this.alert.price,this.alert.market)}`:null}},methods:{toggleAlertsDropdown(s){this.alertsDropdownTrigger?this.alertsDropdownTrigger=null:this.alertsDropdownTrigger=s.currentTarget.parentElement},async toggleAlertsSettingsDropdown(s){await this.ensureAlerts()&&(this.alertsDropdownSettingsTrigger?this.alertsDropdownSettingsTrigger=null:this.alertsDropdownSettingsTrigger=s.currentTarget.parentElement)},async ensureAlerts(){if(!this.$store.state.settings.alerts){if(!await n.confirm({title:"Alerts are disabled",message:"Enable alerts ?",ok:"Yes please"}))return!1;this.$store.commit("settings/TOGGLE_ALERTS",!0)}return!0},async createAlert(){if(!await this.ensureAlerts())return;const s={price:this.price,market:this.market,timestamp:this.timestamp,active:!1};i.createAlert(s,this.getPrice(),!0)},removeAlert(){i.removeAlert(this.alert)},async editAlert(){const s=await n.openAsPromise((await l(()=>import("./CreateAlertDialog.5c4cb14.js"),["CreateAlertDialog.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","CreateAlertDialog.5c4cb14.css"])).default,{price:+a(this.alert.price,this.alert.market),input:this.alert.message,edit:!0});if(typeof s=="string"&&s!==this.alert.message){const t={...this.alert,price:this.alert.price,message:s};await i.moveAlert(this.alert.market,this.alert.price,t,this.getPrice())}}}};var d=function(){var t=this,e=t._self._c;return e("dropdown",{model:{value:t.value,callback:function(r){t.value=r},expression:"value"}},[e("button",{staticClass:"dropdown-item -arrow",on:{click:function(r){return t.$emit("cmd",["toggleTimeframeDropdown",r])}}},[t._v(" "+t._s(t.timeframeForHuman)+" ")]),e("button",{staticClass:"dropdown-item",on:{click:function(r){return t.$store.dispatch("app/showSearch")}}},[e("i",{staticClass:"icon-search"}),e("span",[t._v("Search")])]),e("button",{staticClass:"dropdown-item",on:{click:function(r){return t.$emit("cmd",["takeScreenshot",r])}}},[e("i",{staticClass:"icon-add-photo"}),e("span",[t._v("Snapshot")])]),e("button",{staticClass:"dropdown-item",on:{click:function(r){return t.$emit("cmd",["flipChart"])}}},[e("i",{staticClass:"icon-flip"}),e("span",[t._v("Flip")])]),t.price?[t.alert?[e("div",{staticClass:"dropdown-divider",attrs:{"data-label":`@${t.priceFormatted}`}}),e("button",{staticClass:"dropdown-item",on:{click:t.removeAlert}},[e("i",{staticClass:"icon-cross"}),e("span",[t._v("Remove")])]),e("button",{staticClass:"dropdown-item",on:{click:t.editAlert}},[e("i",{staticClass:"icon-edit"}),e("span",[t._v("Edit")])])]:[e("div",{staticClass:"dropdown-divider",attrs:{"data-label":"alerts"}}),e("button",{staticClass:"dropdown-item",on:{click:t.createAlert}},[e("i",{staticClass:"icon-plus"}),e("span",[t._v(t._s(t.priceFormatted))]),e("i",{staticClass:"icon-cog",on:{click:function(r){return r.stopPropagation(),t.toggleAlertsSettingsDropdown.apply(null,arguments)}}})])],e("dropdown",{on:{click:function(r){r.stopPropagation()}},model:{value:t.alertsDropdownTrigger,callback:function(r){t.alertsDropdownTrigger=r},expression:"alertsDropdownTrigger"}},[e("alerts-list",{attrs:{query:t.market,"with-options":""}})],1),e("dropdown",{on:{click:function(r){r.stopPropagation()}},model:{value:t.alertsDropdownSettingsTrigger,callback:function(r){t.alertsDropdownSettingsTrigger=r},expression:"alertsDropdownSettingsTrigger"}},[e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(r){r.stopPropagation()}}},[e("label",{staticClass:"checkbox-control -small"},[e("input",{staticClass:"form-control",attrs:{type:"checkbox"},domProps:{checked:t.showAlerts},on:{change:function(r){return t.$store.commit(`${t.paneId}/TOGGLE_ALERTS`)}}}),e("div"),e("span",[t._v("Visible")])])]),e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(r){r.stopPropagation()}}},[e("label",{staticClass:"checkbox-control -small"},[e("input",{staticClass:"form-control",attrs:{type:"checkbox",disabled:!t.showAlerts},domProps:{checked:t.showAlertsLabel},on:{change:function(r){return t.$store.commit(`${t.paneId}/TOGGLE_ALERTS_LABEL`)}}}),e("div"),e("span",[t._v("Label")])])]),e("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(r){return r.stopPropagation(),t.toggleAlertsDropdown.apply(null,arguments)}}},[t._v(" Manage "),e("i",{staticClass:"icon-more mr0"})])])]:t._e()],2)},m=[],g=c(u,d,m,!1,null,null,null,null);const w=g.exports;export{w as default};
