var _=Object.defineProperty;var v=(n,e,t)=>e in n?_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>(v(n,typeof e!="symbol"?e+"":e,t),t);import{C as w,T as A,B as C,V as k,j as h,w as m,X as x,Q as y,O as g,d as f,a5 as d,n as b}from"./index.5c4cb14.js";var T=Object.defineProperty,D=Object.getOwnPropertyDescriptor,$=(n,e,t,s)=>{for(var r=s>1?void 0:s?D(e,t):e,i=n.length-1,l;i>=0;i--)(l=n[i])&&(r=(s?l(e,t,r):l(r))||r);return s&&r&&T(e,t,r),r};let p=class extends k{constructor(){super(...arguments);o(this,"dropdownAlert",null);o(this,"alertDropdownTrigger",null);o(this,"indexes",[]);o(this,"sections",[]);o(this,"isLoading",!1);o(this,"market");o(this,"query")}get queryFilter(){return new RegExp(this.query,"i")}get alertsClick(){return this.$store.state.settings.alertsClick}get filteredIndexes(){return this.query?this.indexes.filter(t=>this.queryFilter.test(t.market)):this.indexes}async created(){if(await this.getAlerts(),this.filteredIndexes.length===1){const t=`alerts-${this.filteredIndexes[0].market}`;this.$store.state.settings.sections.indexOf(t)===-1&&this.$store.commit("settings/TOGGLE_SECTION",t)}h.on("alert",this.onAlert)}beforeDestroy(){h.off("alert",this.onAlert)}async getAlerts(){this.isLoading=!0;const t=await m.getAllAlerts();for(let s=0;s<t.length;s++)this.$set(this.indexes,s,t[s]);await x(100),this.isLoading=!1}formatPrice(t,s){return y(t,s)}togglePresetDropdown(t,s){this.alertDropdownTrigger?this.alertDropdownTrigger=null:(this.alertDropdownTrigger=t.currentTarget,this.dropdownAlert=s)}async removeAlert(t){this.isLoading=!0,await g.removeAlert(t),this.isLoading=!1}async createAlert(t){this.isLoading=!0,await g.createAlert(t),this.isLoading=!1}async checkStatus(t){this.isLoading=!0;const s=await g.toggleAlert(t.market,t.price,void 0,void 0,!0);if(this.isLoading=!1,s.alert)f.confirm({message:`Alert ${t.market} @<code>${t.price}</code> is still pending`,html:!0,ok:"Ok",cancel:null});else{const r=await f.confirm({title:"Not found",message:"Alert already triggered or expired",html:!0,ok:"Recreate",actions:[{label:"Remove",callback:()=>2}]});r?r===2?this.removeAlert(t):this.createAlert(t):await g.deactivateAlert(t)}}onAlert({price:t,market:s,type:r,newPrice:i,message:l}){let a=this.indexes.find(u=>u.market===s);if(!a)if(r===d.CREATED)this.$set(this.indexes,this.indexes.length,{market:s,alerts:[]}),a=this.indexes[this.indexes.length-1],this.sections.indexOf(`alerts-${this.sections}`)===-1&&this.sections.push(`alerts-${this.sections}`);else return;const c=a.alerts.findIndex(u=>u.price===t);c!==-1?r===d.DELETED?(a.alerts.splice(c,1),a.alerts.length||this.indexes.splice(this.indexes.indexOf(a),1)):r===d.UPDATED?this.$set(a.alerts[c],"price",i):r===d.TRIGGERED?this.$set(a.alerts[c],"triggered",!0):r===d.ACTIVATED?(this.$set(a.alerts[c],"active",!0),typeof l<"u"&&this.$set(a.alerts[c],"message",l)):r===d.DEACTIVATED&&this.$set(a.alerts[c],"active",!1):r===d.CREATED&&this.$set(a.alerts,a.alerts.length,{price:t,market:s})}async clearAlerts(t,s){if(!await f.confirm({message:`Remove all ${t.market} alerts`,ok:`Yes (${t.alerts.length})`}))return;s&&(s.loading=!0);const r=[...t.alerts];for(const i of r)await g.removeAlert(i);await m.saveAlerts({market:t.market,alerts:[]}),s&&(s.loading=!1)}};p=$([w({components:{ToggableSection:A,Btn:C},name:"Alerts",props:{query:{type:String,default:""},persistSections:{type:Boolean,default:!1},withOptions:{type:Boolean,default:!1}}})],p);var E=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"alerts-list hide-scrollbar",class:[e.withOptions&&"alerts-list--with-options"]},[e.withOptions?t("div",{staticClass:"alert-list__header dropdown-item"},[t("label",{staticClass:"checkbox-control -small w-100",on:{click:function(s){s.stopPropagation()},mousedown:function(s){s.preventDefault()}}},[t("input",{staticClass:"form-control",attrs:{type:"checkbox"},domProps:{checked:e.alertsClick},on:{change:function(s){return e.$store.commit("settings/TOGGLE_ALERTS_CLICK")}}}),t("span",[e._v("1 click")]),t("i",{directives:[{name:"tippy",rawName:"v-tippy"}],staticClass:"icon-info text-muted ml8",attrs:{title:"Place alerts faster ⚡️"}}),t("div",{staticClass:"mlauto"})])]):e._e(),!e.filteredIndexes.length&&!e.isLoading?t("div",{staticClass:"alerts-list__empty px8 text-danger"},[t("i",{staticClass:"icon-cross -small"}),e._v(" no alerts "),e.query?[e._v(' matching "'+e._s(e.query)+'" ')]:e._e()],2):e._e(),e._l(e.filteredIndexes,function(s,r){return t("ToggableSection",{key:s.market,staticClass:"alerts-list__section",attrs:{model:e.sections,id:e.persistSections&&`alerts-${s.market}`,"auto-close":"",small:""},scopedSlots:e._u([{key:"title",fn:function(){return[t("div",{directives:[{name:"draggable-market",rawName:"v-draggable-market"}],staticClass:"toggable-section__title",attrs:{"data-market":s.market}},[e._v(" "+e._s(s.market)+" "),s.alerts.length>1?t("span",{staticClass:"badge -invert ml8"},[e._v(e._s(s.alerts.length))]):e._e()])]},proxy:!0},{key:"control",fn:function(){return[t("Btn",{ref:"clearBtns",refInFor:!0,staticClass:"-text mr16",on:{click:function(i){return e.clearAlerts(s,e.$refs.clearBtns[r])}}},[t("i",{staticClass:"icon-trash"})])]},proxy:!0}],null,!0)},[s.alerts.length?t("table",{staticClass:"table alerts-list__table"},[t("tbody",e._l(s.alerts,function(i){return t("tr",{key:i.id,staticClass:"alerts-list-item",class:[i.triggered&&"alerts-list-item--triggered"]},[t("td",{staticClass:"table-input alerts-list-item__price"},[i.message?t("span",{directives:[{name:"tippy",rawName:"v-tippy",value:{followCursor:!0,distance:24},expression:"{ followCursor: true, distance: 24 }"}],attrs:{title:i.message}},[e._v(" "+e._s(e.formatPrice(i.price,i.market))+" ")]):t("span",[e._v(" "+e._s(e.formatPrice(i.price,i.market))+" ")])]),t("td",{staticClass:"alerts-list-item__status table-input text-nowrap text-right",class:[i.triggered&&"text-success"]},[i.triggered?[t("i",{staticClass:"icon-check"}),e._v(" Triggered ")]:i.active?[e._v("Active")]:[e._v("Inactive")]],2),i.triggered?t("td",{staticClass:"table-action -hover",on:{click:function(l){return l.stopPropagation(),e.removeAlert(i)}}},[t("button",{staticClass:"btn -text -small"},[t("i",{staticClass:"icon-cross"})])]):t("td",{staticClass:"table-action -hover",on:{click:function(l){return l.stopPropagation(),e.togglePresetDropdown(l,i)}}},[t("button",{staticClass:"btn -text -small"},[t("i",{staticClass:"icon-more"})])])])}),0)]):t("p",{staticClass:"text-danger pl8"},[e._v("No alerts")])])}),t("dropdown",{model:{value:e.alertDropdownTrigger,callback:function(s){e.alertDropdownTrigger=s},expression:"alertDropdownTrigger"}},[e.dropdownAlert&&!e.dropdownAlert.triggered?[t("Btn",{staticClass:"dropdown-item -cases",attrs:{type:"button",loading:e.isLoading},on:{click:function(s){s.stopPropagation(),e.checkStatus(e.dropdownAlert).then(()=>e.alertDropdownTrigger=null)}}},[t("i",{staticClass:"icon-search"}),t("span",[e._v("Check status")])]),t("div",{staticClass:"dropdown-divider"})]:e._e(),t("button",{staticClass:"dropdown-item",attrs:{type:"button"},on:{click:function(s){return e.removeAlert(e.dropdownAlert)}}},[t("i",{staticClass:"icon-cross"}),t("span",[e._v("Remove")])])],2)],2)},L=[],P=b(p,E,L,!1,null,"8b47237c",null,null);const R=P.exports;export{R as A};
