var C=Object.defineProperty;var y=(r,s,e)=>s in r?C(r,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[s]=e;var u=(r,s,e)=>(y(r,typeof s!="symbol"?s+"":s,e),e);import{ab as b,j as h,l as _,m as p,r as d,o as f,a2 as m,g as v,Y as g,C as k,n as I,_ as O}from"./index.5c4cb14.js";import{P,a as S}from"./PaneHeader.5c4cb14.js";var E=Object.defineProperty,$=Object.getOwnPropertyDescriptor,A=(r,s,e,t)=>{for(var i=t>1?void 0:t?$(s,e):s,o=r.length-1,n;o>=0;o--)(n=r[o])&&(i=(t?n(s,e,i):n(i))||i);return t&&i&&E(s,e,i),i};let c=class extends b(P){constructor(){super(...arguments);u(this,"steps",[]);u(this,"_populateCountersInterval");u(this,"_activeChunk");u(this,"_counters");u(this,"_feed",null)}get liquidationsOnly(){return this.$store.state[this.paneId].liquidationsOnly}get countersSteps(){return this.$store.state[this.paneId].steps}get countersCount(){return this.$store.state[this.paneId].count}get countersGranularity(){return this.$store.state[this.paneId].granularity}get activeSteps(){return this.steps.filter(e=>e.hasData)}created(){this._onStoreMutation=this.$store.subscribe(e=>{switch(e.type){case"settings/SET_BUY_COLOR":case"settings/SET_SELL_COLOR":this.generateColors();break;case"panes/SET_PANE_MARKETS":e.payload.id===this.paneId&&this.createCounters();break;case this.paneId+"/REPLACE_COUNTERS":case this.paneId+"/TOGGLE_LIQUIDATIONS_ONLY":case this.paneId+"/TOGGLE_COUNT":this.createCounters();break}}),this._populateCountersInterval=setInterval(this.populateCounters.bind(this),this.countersGranularity)}mounted(){this.createCounters(),this.generateColors()}beforeDestroy(){this._feed&&h.off(this._feed,this.onVolume),clearInterval(this._populateCountersInterval)}onVolume(e){const t={buy:e.vbuy,sell:e.vsell};if(this.liquidationsOnly?(t.buy=e.lbuy,t.sell=e.lsell):this.countersCount&&(t.buy=e.cbuy,t.sell=e.csell),t.buy||t.sell){this._activeChunk.timestamp||(this._activeChunk.timestamp=e.timestamp),this._activeChunk.buy+=t.buy,this._activeChunk.sell+=t.sell;for(let i=0;i<this.steps.length;i++)this.steps[i].buy+=t.buy,this.steps[i].sell+=t.sell}}clearCounters(){this._feed&&(console.debug(`[counters/${this.paneId}] unsubscribe from feed`,this._feed),h.off(this._feed,this.onVolume)),this._counters?(this._counters.splice(0,this._counters.length),this._activeChunk.timestamp=null,this._activeChunk.buy=this._activeChunk.sell=0,this.steps.splice(0,this.steps.length)):(this._counters=[],this._activeChunk={timestamp:null,buy:0,sell:0},this.steps=[])}generateColors(){const e=getComputedStyle(document.documentElement),t=_(e.getPropertyValue("--theme-buy-base"),p()),i=_(e.getPropertyValue("--theme-sell-base"),p()),o=this.$el;for(let n=0;n<this.steps.length;n++){const a=n*(.25/this.steps.length);o.style.setProperty(`--buy-color-${n+1}`,d(f(t,-a,a))),o.style.setProperty(`--sell-color-${n+1}`,d(f(i,-a,a)))}}createCounters(){this.clearCounters();for(const e of this.countersSteps){const t={duration:e,chunks:[]};this._counters.push(t);const i=this._counters.indexOf(t)===0;this.steps.push({duration:m(t.duration),buy:0,sell:0,hasData:i})}this._feed="bucket-"+v(this.pane.markets),console.debug(`[counters/${this.paneId}] subscribe to feed`,this._feed),this._feed.length?h.on(this._feed,this.onVolume):console.debug(`[counters/${this.paneId}] error feed empty...`)}populateCounters(){const e=Date.now();this._activeChunk.timestamp&&(this._counters[0].chunks.push({timestamp:this._activeChunk.timestamp,buy:this._activeChunk.buy,sell:this._activeChunk.sell}),this._activeChunk.timestamp=null,this._activeChunk.buy=0,this._activeChunk.sell=0);let t=[],i,o;for(let n=0;n<this._counters.length;n++){t.length&&(Array.prototype.push.apply(this._counters[n].chunks,t.splice(0,t.length)),this.steps[n].hasData||(this.steps[n].hasData=!0)),i=0,o=0;let a=0;for(let l=0;l<this._counters[n].chunks.length;l++)if(i+=this._counters[n].chunks[l].buy,o+=this._counters[n].chunks[l].sell,this._counters[n].chunks[l].timestamp>=e-this._counters[n].duration){a=l;break}a&&(t=this._counters[n].chunks.splice(0,a+1),this.steps[n].buy-=i,this.steps[n].sell-=o)}}formatAmount(e){return g(e)}};c=A([k({components:{PaneHeader:S},name:"Counters"})],c);var D=function(){var s=this,e=s._self._c;return s._self._setupProxy,e("div",{staticClass:"pane-counters"},[e("pane-header",{attrs:{paneId:s.paneId,settings:()=>O(()=>import("./CountersDialog.5c4cb14.js"),["CountersDialog.5c4cb14.js","index.5c4cb14.js","index.5c4cb14.css","paneDialogMixin.5c4cb14.js"])}}),e("div",{staticClass:"counters hide-scrollbar"},s._l(s.activeSteps,function(t,i){return e("div",{key:i,staticClass:"counter",attrs:{duration:t.duration}},[e("div",{staticClass:"counter__side -buy",style:{width:t.buy/(t.buy+t.sell)*100+"%"}},[s.countersCount?e("span",[s._v(s._s(t.buy))]):e("span",[s._v(s._s(s.formatAmount(t.buy)))])]),e("div",{staticClass:"counter__side -sell",style:{width:t.sell/(t.buy+t.sell)*100+"%"}},[s.countersCount?e("span",[s._v(s._s(t.sell))]):e("span",[s._v(s._s(s.formatAmount(t.sell)))])])])}),0)],1)},L=[],T=I(c,D,L,!1,null,null,null,null);const G=T.exports;export{G as default};
